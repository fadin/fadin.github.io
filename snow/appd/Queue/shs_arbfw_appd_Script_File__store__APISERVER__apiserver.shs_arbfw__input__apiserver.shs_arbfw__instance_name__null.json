{
	"Id": "7e3364f997c99376cfcc1a4d99d1e078bf700beb",
	"code": "shs_arbfw_appd_Script_File",
	"date": "2025-07-02T03:57:41.980Z",
	"name": "store",
	"remark": "W3siYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsIl9fY29uc3VtZXIiOiJcbiAgICAoZnVuY3Rpb24ocyl7XG5cdGdzLmluZm8ocy5hcGlfbmFtZSArICc6ICcgKyBzLnN5c19pZCk7XG5cdGlmKHMuc3lzX3Njb3BlLm5hbWUhPSdBcHBsaWNhdGlvbiBEZXNpZ25lcicpIHJldHVybjtcblxuICAgIHZhciBzYyA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3Njb3BlJyk7XG4gICAgc2MuZ2V0KCduYW1lJywgcy5zeXNfc2NvcGUubmFtZSk7XG4gICAgcy5zeXNfc2NvcGUgPSBzYy5zeXNfaWQudG9TdHJpbmcoKTtcblxuXHR2YXIgc2dyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0c2dyLmFkZFF1ZXJ5KCduYW1lJywgJz0nLCBzLm5hbWUpO1xuXHRzZ3IucXVlcnkoKTtcblx0aWYgKCFzZ3IubmV4dCgpKSBzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0T2JqZWN0LmtleXMocykuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gay5pbmRleE9mKCdfXycpIDwgMDtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0c2dyLnNldFZhbHVlKGssIHNba10pO1xuXHR9KTtcblx0c2dyLnVwZGF0ZSgpO1xuXHRcblx0dmFyIGVzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lc19sYXRlc3Rfc2NyaXB0Jyk7XG5cdGVzZ3IuYWRkUXVlcnkoJ2lkJywgc2dyLnN5c19pZCk7XG5cdGVzZ3IuYWRkUXVlcnkoJ3RhYmxlJywgJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRlc2dyLnF1ZXJ5KCk7XG5cdGlmKCFlc2dyLm5leHQoKSkgZXNnciA9IG5ldyBHbGlkZVJlY29yZChlc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0ZXNnci5zZXRWYWx1ZSgnaWQnLCBzZ3Iuc3lzX2lkKTtcblx0ZXNnci5zZXRWYWx1ZSgndGFibGUnLCAnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cdGVzZ3Iuc2V0VmFsdWUoJ3VzZV9lc19sYXRlc3QnLCB0cnVlKTtcblx0ZXNnci51cGRhdGUoKTtcblx0XG5cdGlmKCFzLmRlc2NyaXB0aW9uKSByZXR1cm47XG5cbiAgICB2YXIgb1RhYmxlID0gSlNPTi5wYXJzZShzLmRlc2NyaXB0aW9uKTtcblxuICAgIHZhciB0ID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG4gICAgdC5hZGRRdWVyeSgnbmFtZScsIG9UYWJsZS5uYW1lKTtcbiAgICB0LnNldExpbWl0KDEpO1xuICAgIHQucXVlcnkoKTtcbiAgICBpZih0Lm5leHQoKSl7XG4gICAgICAgIG9UYWJsZS5JZCA9IHQuc3lzX2lkLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgdmFyIHNjID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NvcGUnKTtcbiAgICBzYy5nZXQoJ3Njb3BlJywgJ3hfMTc5MDU5M19hcmJvYXJkJyk7XG5cbiAgICBpZih0LnN5c19zY29wZS5zY29wZT09J3hfMTc5MDU5M19hcmJvYXJkJyl7XG4gICAgICAgIHZhciBhY2xPcHMgPSB7cmVhZDogJ2ZpbmQnLCB3cml0ZTogJ3VwZGF0ZScsIGNyZWF0ZTogJ2luc2VydCcvKiwgZGVsZXRlOiAnJywgZXhlY3V0ZTogJycqL307XG4gICAgICAgIE9iamVjdC5rZXlzKGFjbE9wcykuZm9yRWFjaChmdW5jdGlvbihhayl7XG4gICAgICAgICAgICB2YXIgYWNsID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2VjdXJpdHlfYWNsJyk7XG4gICAgICAgICAgICB2YXIgb0FDTCA9IHthY3RpdmU6IHRydWUsIGFkbWluX292ZXJyaWRlczogZmFsc2UsIGFkdmFuY2VkOiB0cnVlLCBuYW1lOiBvVGFibGUubmFtZSsnLionLFxuICAgICAgICAgICAgICAgIHNjcmlwdDogJ2Fuc3dlciA9IG5ldyAnICsgcy5uYW1lICsgJygpLl9mcm9tR2xpZGVSZWNvcmQoY3VycmVudCkuXycgKyBhY2xPcHNbYWtdICsgJ0Fzc2VydCgpOycsXG4gICAgICAgICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2FsbG93JywgdHlwZTogJ3JlY29yZCcsIG9wZXJhdGlvbjogYWssXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdBbGxvdyAnICsgYWsgKyAnIGZvciBhbGwgZmllbGRzIGluICcgKyBvVGFibGUubGFiZWwgKyAnKCcgKyBvVGFibGUubmFtZSArICcpLCBpZiB0aGUgQUNMIHNjcmlwdCBhbnN3ZXJzIHRydWUuJ307XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ25hbWUnLCBvQUNMLm5hbWUpO1xuICAgICAgICAgICAgYWNsLmFkZFF1ZXJ5KCdvcGVyYXRpb24nLCBvQUNMLm9wZXJhdGlvbik7XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ3R5cGUnLCBvQUNMLnR5cGUpO1xuICAgICAgICAgICAgYWNsLnNldExpbWl0KDEpO1xuICAgICAgICAgICAgYWNsLnF1ZXJ5KCk7XG4gICAgICAgICAgICBpZighYWNsLm5leHQoKSkgYWNsID0gbmV3IEdsaWRlUmVjb3JkKGFjbC5nZXRUYWJsZU5hbWUoKSk7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvQUNMKS5mb3JFYWNoKGZ1bmN0aW9uKGspe2FjbC5zZXRWYWx1ZShrLCBvQUNMW2tdKTt9KTtcbiAgICAgICAgICAgIGFjbC51cGRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYnIgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHQnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ2NvbGxlY3Rpb24nLCBvVGFibGUubmFtZSk7XG4gICAgICAgIGJyLmFkZFF1ZXJ5KCdzeXNfc2NvcGUnLCBzYy5zeXNfaWQpO1xuICAgICAgICBici5hZGRRdWVyeSgnd2hlbicsICdiZWZvcmUnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ25hbWUnLCBvVGFibGUubGFiZWwgKyAnIGFzc2VydGlvbicpO1xuICAgICAgICBici5zZXRMaW1pdCgxKTtcbiAgICAgICAgYnIucXVlcnkoKTtcbiAgICAgICAgLy9ncy5pbmZvKFwiYnIgY291bnQ6IFwiICsgYnIuZ2V0Um93Q291bnQoKSArIFwiLCBxdWVyeTogXCIgKyBici5nZXRFbmNvZGVkUXVlcnkoKSk7XG4gICAgICAgIGlmKCFici5uZXh0KCkpIGJyID0gbmV3IEdsaWRlUmVjb3JkKGJyLmdldFRhYmxlTmFtZSgpKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGl2ZScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnY29sbGVjdGlvbicsIG9UYWJsZS5uYW1lKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3N5c19zY29wZScsIHNjLnN5c19pZCk7XG4gICAgICAgIGJyLnNldFZhbHVlKCd3aGVuJywgJ2JlZm9yZScpO1xuICAgICAgICBici5zZXRWYWx1ZSgnbmFtZScsIG9UYWJsZS5sYWJlbCArICcgYXNzZXJ0aW9uJyk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdkZXNjcmlwdGlvbicsICdSdWxlIGZvciAnICsgb1RhYmxlLmxhYmVsICsgJygnICsgb1RhYmxlLm5hbWUgKyAnKSwgdG8gYXNzZXJ0IG9wZXJhdGlvbiB2YWxpZGl0eS4nKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9pbnNlcnQnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl91cGRhdGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9kZWxldGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9xdWVyeScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWJvcnRfYWN0aW9uJywgZmFsc2UpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWRkX21lc3NhZ2UnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ21lc3NhZ2UnLCAnT3BlcmF0aW9uIGFib3J0ZWQ6IGFzc2VydGlvbiBmYWlsZWQnKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3NjcmlwdCcsICdjdXJyZW50LnNldEFib3J0QWN0aW9uKCFuZXcgJyArIHMubmFtZSArICcoKS5fZnJvbUdsaWRlUmVjb3JkKGN1cnJlbnQpW1wiX1wiICsgKHtpbnNlcnQ6IFwiaW5zZXJ0XCIsIHVwZGF0ZTogXCJ1cGRhdGVcIiwgcXVlcnk6IFwiZmluZFwiLCBkZWxldGU6IFwidXBkYXRlXCJ9KVtjdXJyZW50Lm9wZXJhdGlvbigpIHx8IFwiaW5zZXJ0XCJdICsgXCJBc3NlcnRcIl0oKSk7Jyk7XG4gICAgICAgIGJyLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBcbiAgICBpZih0LmlzVmFsaWRSZWNvcmQoKSkgcmV0dXJuO1xuXG4gICAgdCA9IG5ldyBHbGlkZVJlY29yZCh0LmdldFRhYmxlTmFtZSgpKTtcbiAgICB0LnNldE5ld0d1aWRWYWx1ZShvVGFibGUuSWQpO1xuICAgIFsnbmFtZScsICdsYWJlbCcsICdzeXNfbmFtZSddLmZvckVhY2goZnVuY3Rpb24oZil7dC5zZXRWYWx1ZShmLCBvVGFibGVbZl0pO30pO1xuICAgIHQuc3lzX3Njb3BlID0gc2Muc3lzX2lkO1xuICAgIGlmKG9UYWJsZS5zdXBlcl9jbGFzcykge1xuICAgICAgICB2YXIgc3VwZXJfY2xhc3MgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kYl9vYmplY3QnKTtcbiAgICAgICAgc3VwZXJfY2xhc3MuZ2V0KCduYW1lJywgb1RhYmxlLnN1cGVyX2NsYXNzKTtcbiAgICAgICAgaWYoc3VwZXJfY2xhc3MuaXNWYWxpZFJlY29yZCgpKSB0LnNldFZhbHVlKCdzdXBlcl9jbGFzcycsIHN1cGVyX2NsYXNzLnN5c19pZCk7XG4gICAgfVxuICAgIGdzLmluZm8oJ2NyZWF0aW5nIHRhYmxlOiAnICsgb1RhYmxlLm5hbWUgKyBcIiB4XzE3OTA1OTNfYXJib2FyZCAtIFwiICsgcy5zeXNfaWQpO1xuICAgIFxuICAgIHQuaW5zZXJ0KCk7XG4gICAgXG4gICAgb1RhYmxlLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjKXtcbiAgICAgICAgdmFyIGdyYyA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RpY3Rpb25hcnknKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYykuZm9yRWFjaChmdW5jdGlvbihmKXtncmMuc2V0VmFsdWUoZiwgY1tmXSk7fSk7XG4gICAgICAgIGdyYy5pbnNlcnQoKTtcbiAgICB9KTtcbiAgICBcblx0fSlcbiAgICAiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhbHVlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92YWx1ZSA9IHY7XG5cdFx0XHR0aGlzLl92YWx1ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YWx1ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5pbnN0YW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnN0YW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmFjdGlvbklucHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uSW5wdXQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbklucHV0ID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbklucHV0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmZsb3dJbnB1dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dJbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvd0lucHV0ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dJbnB1dF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93SW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUubWFwcGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hcHBpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hcHBpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWFwcGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYXBwaW5nO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICd2YXJpYWJsZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl92YWx1ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3ZhbHVlJyArICh0aGlzLl92YWx1ZV9jb29wIHx8ICc9JykgKyB0aGlzLnZhbHVlKCk7XG5cblx0XHRpZiAodGhpcy5faW5zdGFuY2UpIHJldCArPSAvKih0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmluc3RhbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2luc3RhbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uSW5wdXQpIHJldCArPSAvKih0aGlzLl9hY3Rpb25JbnB1dF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbklucHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbklucHV0LicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3dJbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2Zsb3dJbnB1dF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3dJbnB1dCgpLl90b0VRdWVyeShzUGF0aCArICdmbG93SW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fbWFwcGluZykgcmV0ICs9IC8qKHRoaXMuX21hcHBpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tYXBwaW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21hcHBpbmcuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHR2YXJpYWJsZTogb2JqLmdldFZhbHVlKFwidmFyaWFibGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHZhbHVlOiBvYmouZ2V0VmFsdWUoXCJ2YWx1ZVwiKSxcblxuXHRcdFx0XHRcdFx0aW5zdGFuY2U6IG9iai5nZXRWYWx1ZShcImluc3RhbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0YWN0aW9uSW5wdXQ6IG9iai5nZXRWYWx1ZShcImFjdGlvbklucHV0XCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93SW5wdXQ6IG9iai5nZXRWYWx1ZShcImZsb3dJbnB1dFwiKSxcblxuXHRcdFx0XHRcdFx0bWFwcGluZzogb2JqLmdldFZhbHVlKFwibWFwcGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai52YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoudmFyaWFibGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai52YWx1ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudmFsdWUoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai52YWx1ZSkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy52YWx1ZShvYmoudmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmluc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5pbnN0YW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbklucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb25JbnB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uSW5wdXQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93SW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3dJbnB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dJbnB1dCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hcHBpbmcobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm1hcHBpbmcpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVmFyaWFibGVfVmFsdWVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudmFyaWFibGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC52YWx1ZSA9IHRoaXMudmFsdWUoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQudmFsdWUpID09PSAnb2JqZWN0JykgcmV0LnZhbHVlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnZhbHVlKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2luc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5pbnN0YW5jZSkge1xuXHRcdFx0XHRyZXQuaW5zdGFuY2UgPSByZXQuaW5zdGFuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuaW5zdGFuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lmluc3RhbmNlKS5sZW5ndGgpIHJldC5pbnN0YW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbklucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb25JbnB1dCA9IHRoaXMuYWN0aW9uSW5wdXQoKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb25JbnB1dCkge1xuXHRcdFx0XHRyZXQuYWN0aW9uSW5wdXQgPSByZXQuYWN0aW9uSW5wdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uSW5wdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbklucHV0KS5sZW5ndGgpIHJldC5hY3Rpb25JbnB1dCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvd0lucHV0ID0gdGhpcy5mbG93SW5wdXQoKTtcblxuXHRcdFx0aWYgKHJldC5mbG93SW5wdXQpIHtcblx0XHRcdFx0cmV0LmZsb3dJbnB1dCA9IHJldC5mbG93SW5wdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvd0lucHV0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93SW5wdXQpLmxlbmd0aCkgcmV0LmZsb3dJbnB1dCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hcHBpbmcgPSB0aGlzLm1hcHBpbmcoKTtcblxuXHRcdFx0aWYgKHJldC5tYXBwaW5nKSB7XG5cdFx0XHRcdHJldC5tYXBwaW5nID0gcmV0Lm1hcHBpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubWFwcGluZykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWFwcGluZykubGVuZ3RoKSByZXQubWFwcGluZyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidmFyaWFibGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YWx1ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhbHVlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhbHVlKHRoaXMudmFsdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmluc3RhbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmluc3RhbmNlKHRoaXMuaW5zdGFuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25JbnB1dFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbklucHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbklucHV0KHRoaXMuYWN0aW9uSW5wdXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd0lucHV0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvd0lucHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dJbnB1dCh0aGlzLmZsb3dJbnB1dCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYXBwaW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFwcGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXBwaW5nKHRoaXMubWFwcGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFyaWFibGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2YXJpYWJsZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndmFyaWFibGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdmFsdWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdmFsdWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd2YWx1ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3ZhbHVlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd2YWx1ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2YWx1ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2luc3RhbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuaW5zdGFuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJpbnN0YW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwiaW5zdGFuY2VbaW5zdGFuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuaW5zdGFuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW5zdGFuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW5zdGFuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW5zdGFuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25JbnB1dF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbklucHV0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiYWN0aW9uSW5wdXQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIgKyBcImFjdGlvbklucHV0W2FjdGlvbklucHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbklucHV0KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbmlucHV0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uaW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbmlucHV0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbmlucHV0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dJbnB1dF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3dJbnB1dCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcImZsb3dJbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwiZmxvd0lucHV0W2Zsb3dJbnB1dF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93SW5wdXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvd2lucHV0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvd2lucHV0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93aW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvd2lucHV0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYXBwaW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFwcGluZygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcIm1hcHBpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIgKyBcIm1hcHBpbmdbbWFwcGluZ10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tYXBwaW5nKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hcHBpbmcnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYXBwaW5nJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYXBwaW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hcHBpbmcnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c192YXJpYWJsZV92YWx1ZScsIFsnKiddKVsnc3lzX3ZhcmlhYmxlX3ZhbHVlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfdmFyaWFibGVfdmFsdWUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0FnZW5kYV9JdGVtIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfQWdlbmRhX0l0ZW0iLCJuYW1lIjoic2hzX2FyYmZ3X0FnZW5kYV9JdGVtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19BZ2VuZGFfSXRlbVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmFnZW5kYSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFnZW5kYSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWdlbmRhID0gdjtcblx0XHRcdHRoaXMuX2FnZW5kYV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hZ2VuZGE7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ucmVxdWlyZW1lbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnQgPSB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnQ7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYWdlbmRhKSByZXQgKz0gLyoodGhpcy5fYWdlbmRhX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWdlbmRhKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FnZW5kYS4nKTtcblxuXHRcdGlmICh0aGlzLl9yZXF1aXJlbWVudCkgcmV0ICs9IC8qKHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVxdWlyZW1lbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVxdWlyZW1lbnQuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGFnZW5kYTogb2JqLmdldFZhbHVlKFwiYWdlbmRhXCIpLFxuXG5cdFx0XHRcdFx0XHRyZXF1aXJlbWVudDogb2JqLmdldFZhbHVlKFwicmVxdWlyZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hZ2VuZGEpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFnZW5kYShuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChvYmouYWdlbmRhKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlcXVpcmVtZW50KG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJBZ2VuZGFfSXRlbVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlXG5cblx0XHRcdCYmXG5cdFx0XHQoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5faW5zZXJ0QXNzZXJ0KCk6IFwiICsgXCJFeGNlcHRpb24gaW4gX2luc2VydEFzc2VydDo6KCk6IFwiICsgZXguZ2V0TWVzc2FnZSgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkodGhpcykpO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZVxuXG5cdFx0XHQmJlxuXHRcdFx0KChmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3N0b3JlQXNzZXJ0KCk6IFwiICsgXCJFeGNlcHRpb24gaW4gX3N0b3JlQXNzZXJ0OjooKTogXCIgKyBleC5nZXRNZXNzYWdlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KSh0aGlzKSk7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWdlbmRhKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hZ2VuZGEgPSB0aGlzLmFnZW5kYSgpO1xuXG5cdFx0XHRpZiAocmV0LmFnZW5kYSkge1xuXHRcdFx0XHRyZXQuYWdlbmRhID0gcmV0LmFnZW5kYS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hZ2VuZGEpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFnZW5kYSkubGVuZ3RoKSByZXQuYWdlbmRhID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlcXVpcmVtZW50ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnJlcXVpcmVtZW50KSB7XG5cdFx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHJldC5yZXF1aXJlbWVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZXF1aXJlbWVudCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVxdWlyZW1lbnQpLmxlbmd0aCkgcmV0LnJlcXVpcmVtZW50ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hZ2VuZGEoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhKHRoaXMuYWdlbmRhKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWdlbmRhXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWdlbmRhKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFnZW5kYSh0aGlzLmFnZW5kYSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZXF1aXJlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlcXVpcmVtZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50KHRoaXMucmVxdWlyZW1lbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FnZW5kYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FnZW5kYV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFnZW5kYSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFnZW5kYSBJdGVtXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcImFnZW5kYSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIiArIFwiYWdlbmRhW2FnZW5kYV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hZ2VuZGEoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWdlbmRhJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWdlbmRhJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhZ2VuZGEnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWdlbmRhJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFnZW5kYSBJdGVtXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInJlcXVpcmVtZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiICsgXCJyZXF1aXJlbWVudFtyZXF1aXJlbWVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1aXJlbWVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZXF1aXJlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZXF1aXJlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZXF1aXJlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc3ViZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YmZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3N1YmZsb3cgPSB2O1xuXHRcdFx0dGhpcy5fc3ViZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJmbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndWlfaWQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbW1lbnQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdwYXJlbnRfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9zdWJmbG93KSByZXQgKz0gLyoodGhpcy5fc3ViZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnc3ViZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMuaW5zdGFuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3ZhcmlhYmxlX3ZhbHVlLmluc3RhbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHR1aV9pZDogb2JqLmdldFZhbHVlKFwidWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0Y29tbWVudDogb2JqLmdldFZhbHVlKFwiY29tbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0cGFyZW50X3VpX2lkOiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRfdWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRzdWJmbG93OiBvYmouZ2V0VmFsdWUoXCJzdWJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai51aV9pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoudWlfaWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmNvbW1lbnQpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5jb21tZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfdWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF91aV9pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3ViZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3ViZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLnN1YmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5zdGFuY2VcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnVpX2lkID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5jb21tZW50KSA9PT0gJ29iamVjdCcpIHJldC5jb21tZW50ID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfdWlfaWQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF91aV9pZCkge1xuXHRcdFx0XHRyZXQucGFyZW50X3VpX2lkID0gcmV0LnBhcmVudF91aV9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfdWlfaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudF91aV9pZCkubGVuZ3RoKSByZXQucGFyZW50X3VpX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN1YmZsb3cgPSB0aGlzLnN1YmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5zdWJmbG93KSB7XG5cdFx0XHRcdHJldC5zdWJmbG93ID0gcmV0LnN1YmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3ViZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3ViZmxvdykubGVuZ3RoKSByZXQuc3ViZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ1aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfdWlfaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3ViZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN1YmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3ViZmxvdyh0aGlzLnN1YmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd1aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd1aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb21tZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb21tZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb21tZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInBhcmVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJwYXJlbnRbcGFyZW50X3VpX2lkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnRfdWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGFyZW50X3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudF91aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdWJmbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3ViZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJzdWJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIgKyBcInN1YmZsb3dbc3ViZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zdWJmbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N1YmZsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N1YmZsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1YmZsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3ViZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIm9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5pbnN0YW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnN0YW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Lk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQubW9kZWxfdGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tb2RlbF90YWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdlbGVtZW50JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFiZWwnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYXR0cmlidXRlcycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2luc3RhbmNlKSByZXQgKz0gLyoodGhpcy5faW5zdGFuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5pbnN0YW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdpbnN0YW5jZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRhdHRyaWJ1dGVzOiBvYmouZ2V0VmFsdWUoXCJhdHRyaWJ1dGVzXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF90eXBlOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF90eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGluc3RhbmNlOiBvYmouZ2V0VmFsdWUoXCJpbnN0YW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVsZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXR0cmlidXRlcykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYXR0cmlidXRlcykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmF0dHJpYnV0ZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmluc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5pbnN0YW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5zdGFuY2VfSW5wdXRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmF0dHJpYnV0ZXMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hdHRyaWJ1dGVzKSA9PT0gJ29iamVjdCcpIHJldC5hdHRyaWJ1dGVzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmF0dHJpYnV0ZXMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfdHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2luc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5pbnN0YW5jZSkge1xuXHRcdFx0XHRyZXQuaW5zdGFuY2UgPSByZXQuaW5zdGFuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuaW5zdGFuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lmluc3RhbmNlKS5sZW5ndGgpIHJldC5pbnN0YW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWF4X2xlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXhfbGVuZ3RoID0gdGhpcy5tYXhfbGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfaWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfaWQgPSB0aGlzLm1vZGVsX2lkKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfdGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfdGFibGUgPSB0aGlzLm1vZGVsX3RhYmxlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmluc3RhbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmluc3RhbmNlKHRoaXMuaW5zdGFuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhdHRyaWJ1dGVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX3R5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW5zdGFuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5pbnN0YW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnN0YW5jZSh0aGlzLmluc3RhbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhdHRyaWJ1dGVzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnRlcm5hbF90eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZSBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2luc3RhbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuaW5zdGFuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwiaW5zdGFuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiaW5zdGFuY2VbaW5zdGFuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuaW5zdGFuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW5zdGFuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5wYXJlbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwYXJlbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3BhcmVudCA9IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuYWN0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3Rpb24gPSB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbl9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndWlfaWQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbW1lbnQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdwYXJlbnRfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb24pIHJldCArPSAvKih0aGlzLl9hY3Rpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hY3Rpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uX3R5cGUuJyk7XG5cblx0XHQodGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfdmFyaWFibGVfdmFsdWUuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHR1aV9pZDogb2JqLmdldFZhbHVlKFwidWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0Y29tbWVudDogb2JqLmdldFZhbHVlKFwiY29tbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0cGFyZW50X3VpX2lkOiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRfdWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb25fdHlwZTogb2JqLmdldFZhbHVlKFwiYWN0aW9uX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnVpX2lkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai51aV9pZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29tbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouY29tbWVudCkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmNvbW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF91aV9pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGFyZW50KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X3VpX2lkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl90eXBlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9JbnN0YW5jZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnVpX2lkID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5jb21tZW50KSA9PT0gJ29iamVjdCcpIHJldC5jb21tZW50ID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfdWlfaWQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF91aV9pZCkge1xuXHRcdFx0XHRyZXQucGFyZW50X3VpX2lkID0gcmV0LnBhcmVudF91aV9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfdWlfaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudF91aV9pZCkubGVuZ3RoKSByZXQucGFyZW50X3VpX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uX3R5cGUgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbl90eXBlKSB7XG5cdFx0XHRcdHJldC5hY3Rpb25fdHlwZSA9IHJldC5hY3Rpb25fdHlwZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb25fdHlwZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uX3R5cGUpLmxlbmd0aCkgcmV0LmFjdGlvbl90eXBlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInVpX2lkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb21tZW50XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBhcmVudF91aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25fdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb24odGhpcy5hY3Rpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3VpX2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwicGFyZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF91aV9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGFyZW50X3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudF91aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uX3R5cGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbl90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbl90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb25fdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb25fdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyhvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWxcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnBsdXJhbCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBsdXJhbCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGx1cmFsID0gdjtcblx0XHRcdHRoaXMuX3BsdXJhbF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wbHVyYWw7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwubGFuZ3VhZ2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYW5ndWFnZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbGFuZ3VhZ2UgPSB2O1xuXHRcdFx0dGhpcy5fbGFuZ3VhZ2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbGFuZ3VhZ2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuaW5wdXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5faW5wdXQgPSB2O1xuXHRcdFx0dGhpcy5faW5wdXRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwub3V0cHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3V0cHV0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vdXRwdXQgPSB2O1xuXHRcdFx0dGhpcy5fb3V0cHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX291dHB1dDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC52YXJpYWJsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhcmlhYmxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92YXJpYWJsZSA9IHY7XG5cdFx0XHR0aGlzLl92YXJpYWJsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YXJpYWJsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5jb2x1bW4gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2x1bW4odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbiA9IHY7XG5cdFx0XHR0aGlzLl9jb2x1bW5fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdlbGVtZW50JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGx1cmFsKSByZXQgKz0gJ14nICsgc1BhdGggKyAncGx1cmFsJyArICh0aGlzLl9wbHVyYWxfY29vcCB8fCAnPScpICsgdGhpcy5wbHVyYWwoKTtcblxuXHRcdGlmICh0aGlzLl9sYW5ndWFnZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhbmd1YWdlJyArICh0aGlzLl9sYW5ndWFnZV9jb29wIHx8ICc9JykgKyB0aGlzLmxhbmd1YWdlKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9pbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2lucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuaW5wdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnaW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fb3V0cHV0KSByZXQgKz0gLyoodGhpcy5fb3V0cHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMub3V0cHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ291dHB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl92YXJpYWJsZSkgcmV0ICs9IC8qKHRoaXMuX3ZhcmlhYmxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudmFyaWFibGUoKS5fdG9FUXVlcnkoc1BhdGggKyAndmFyaWFibGUuJyk7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uKSByZXQgKz0gLyoodGhpcy5fY29sdW1uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuY29sdW1uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2NvbHVtbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRwbHVyYWw6IG9iai5nZXRWYWx1ZShcInBsdXJhbFwiKSxcblxuXHRcdFx0XHRcdFx0bGFuZ3VhZ2U6IG9iai5nZXRWYWx1ZShcImxhbmd1YWdlXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0aW5wdXQ6IG9iai5nZXRWYWx1ZShcImlucHV0XCIpLFxuXG5cdFx0XHRcdFx0XHRvdXRwdXQ6IG9iai5nZXRWYWx1ZShcIm91dHB1dFwiKSxcblxuXHRcdFx0XHRcdFx0dmFyaWFibGU6IG9iai5nZXRWYWx1ZShcInZhcmlhYmxlXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2x1bW46IG9iai5nZXRWYWx1ZShcImNvbHVtblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoubGFiZWwpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGx1cmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wbHVyYWwob2JqLnBsdXJhbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmxhbmd1YWdlKG9iai5sYW5ndWFnZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuaW5wdXQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5pbnB1dCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm91dHB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3V0cHV0KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLm91dHB1dCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52YXJpYWJsZShuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnZhcmlhYmxlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2x1bW4obmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLmNvbHVtbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGaWVsZF9MYWJlbFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbGVtZW50ID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQubGFiZWwpID09PSAnb2JqZWN0JykgcmV0LmxhYmVsID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmxhYmVsKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGx1cmFsID0gdGhpcy5wbHVyYWwoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmxhbmd1YWdlID0gdGhpcy5sYW5ndWFnZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5faW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmlucHV0ID0gdGhpcy5pbnB1dCgpO1xuXG5cdFx0XHRpZiAocmV0LmlucHV0KSB7XG5cdFx0XHRcdHJldC5pbnB1dCA9IHJldC5pbnB1dC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnB1dCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5wdXQpLmxlbmd0aCkgcmV0LmlucHV0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3V0cHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vdXRwdXQgPSB0aGlzLm91dHB1dCgpO1xuXG5cdFx0XHRpZiAocmV0Lm91dHB1dCkge1xuXHRcdFx0XHRyZXQub3V0cHV0ID0gcmV0Lm91dHB1dC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5vdXRwdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm91dHB1dCkubGVuZ3RoKSByZXQub3V0cHV0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFyaWFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZhcmlhYmxlID0gdGhpcy52YXJpYWJsZSgpO1xuXG5cdFx0XHRpZiAocmV0LnZhcmlhYmxlKSB7XG5cdFx0XHRcdHJldC52YXJpYWJsZSA9IHJldC52YXJpYWJsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC52YXJpYWJsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudmFyaWFibGUpLmxlbmd0aCkgcmV0LnZhcmlhYmxlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2x1bW4gPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAocmV0LmNvbHVtbikge1xuXHRcdFx0XHRyZXQuY29sdW1uID0gcmV0LmNvbHVtbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5jb2x1bW4pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmNvbHVtbikubGVuZ3RoKSByZXQuY29sdW1uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5sYW5ndWFnZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sYW5ndWFnZSh0aGlzLmxhbmd1YWdlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGx1cmFsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGx1cmFsKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBsdXJhbCh0aGlzLnBsdXJhbCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhbmd1YWdlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubGFuZ3VhZ2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGFuZ3VhZ2UodGhpcy5sYW5ndWFnZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW5wdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5pbnB1dCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnB1dCh0aGlzLmlucHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm91dHB1dFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm91dHB1dCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vdXRwdXQodGhpcy5vdXRwdXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidmFyaWFibGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy52YXJpYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52YXJpYWJsZSh0aGlzLnZhcmlhYmxlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvbHVtblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvbHVtbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2x1bW4odGhpcy5jb2x1bW4oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2RvY3VtZW50YXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VsZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGx1cmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGx1cmFsX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3BsdXJhbF9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGx1cmFsKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwbHVyYWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbHVyYWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BsdXJhbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwbHVyYWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9sYW5ndWFnZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9sYW5ndWFnZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubGFuZ3VhZ2UoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhbmd1YWdlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFuZ3VhZ2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhbmd1YWdlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhbmd1YWdlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5faW5wdXRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5pbnB1dCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImlucHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJpbnB1dFtpbnB1dF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnB1dCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnB1dCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2lucHV0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnB1dCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vdXRwdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vdXRwdXRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vdXRwdXQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJvdXRwdXQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIgKyBcIm91dHB1dFtvdXRwdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3V0cHV0KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ291dHB1dCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ291dHB1dCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3V0cHV0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ291dHB1dCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3ZhcmlhYmxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudmFyaWFibGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ2YXJpYWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwidmFyaWFibGVbdmFyaWFibGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudmFyaWFibGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFyaWFibGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2YXJpYWJsZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndmFyaWFibGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29sdW1uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29sdW1uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwiY29sdW1uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJjb2x1bW5bY29sdW1uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbHVtbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2x1bW4nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2x1bW4nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvbHVtbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2x1bW4nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RvY3VtZW50YXRpb24nLCBbJyonXSlbJ3N5c19kb2N1bWVudGF0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZG9jdW1lbnRhdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RvY3VtZW50YXRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RvY3VtZW50YXRpb24nLCBbJyonXSlbJ3N5c19kb2N1bWVudGF0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubG9naWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbG9naWMgPSB2O1xuXHRcdFx0dGhpcy5fbG9naWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9naWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VkVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9yZWZlcmVuY2VkX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5yZWZlcmVuY2VkVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJ4dloybGpYMFpzYjNkZlNXNXdkWFJmVTJOeWFYQjBjMXR5WldabGNtVnVZMlZrWDNSaFlteGxQVndpZTN0cFpIMTlYQ0pkWFM1d1lYSmxiblJmUVdOMGFXOXVYMGx1YzNSaGJtTmxjeWsvSjNONWMxOW9kV0pmWVdOMGFXOXVYMmx1YzNSaGJtTmxKem9uYzNselgyaDFZbDltYkc5M1gyeHZaMmxqSno0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnB1dF9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzY3JpcHQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2xvZ2ljKSByZXQgKz0gLyoodGhpcy5fbG9naWNfY29vcCB8fCAnPScpICsgKi8gdGhpcy5sb2dpYygpLl90b0VRdWVyeShzUGF0aCArICdpbnN0YW5jZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGlucHV0X25hbWU6IG9iai5nZXRWYWx1ZShcImlucHV0X25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0c2NyaXB0OiBvYmouZ2V0VmFsdWUoXCJzY3JpcHRcIiksXG5cblx0XHRcdFx0XHRcdGluc3RhbmNlOiBvYmouZ2V0VmFsdWUoXCJpbnN0YW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnB1dF9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5pbnB1dF9uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY3JpcHQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnNjcmlwdCkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnNjcmlwdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmxvZ2ljKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnB1dF9TY3JpcHRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW5wdXRfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zY3JpcHQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5zY3JpcHQpID09PSAnb2JqZWN0JykgcmV0LnNjcmlwdCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zY3JpcHQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbG9naWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5sb2dpYygpO1xuXG5cdFx0XHRpZiAocmV0Lmluc3RhbmNlKSB7XG5cdFx0XHRcdHJldC5pbnN0YW5jZSA9IHJldC5pbnN0YW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VkX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZWRfdGFibGUgPSB0aGlzLnJlZmVyZW5jZWRfdGFibGUoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlucHV0X25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjcmlwdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycsIFsnKiddKVsnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2lucHV0X3NjcmlwdHMnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2lucHV0X25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnB1dF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnB1dF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2lucHV0X25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2NyaXB0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2NyaXB0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY3JpcHQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2NyaXB0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2xvZ2ljKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbG9naWNfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5sb2dpYygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXQgU2NyaXB0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcImxvZ2ljIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiICsgXCJsb2dpY1tpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5sb2dpYygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnN0YW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJywgWycqJ10pWydzeXNfaHViX2lucHV0X3NjcmlwdHMnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSIsIm5hbWUiOiJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubWVldGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lZXRpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lZXRpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmFnZW5kYV9BZ2VuZGFfSXRlbXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhZ2VuZGFfQWdlbmRhX0l0ZW1zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWdlbmRhX0FnZW5kYV9JdGVtcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHQodGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbS5hZ2VuZGEsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0bWVldGluZzogb2JqLmdldFZhbHVlKFwibWVldGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lZXRpbmcobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ19BZ2VuZGFcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWVldGluZyA9IHRoaXMubWVldGluZygpO1xuXG5cdFx0XHRpZiAocmV0Lm1lZXRpbmcpIHtcblx0XHRcdFx0cmV0Lm1lZXRpbmcgPSByZXQubWVldGluZy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZWV0aW5nKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tZWV0aW5nKS5sZW5ndGgpIHJldC5tZWV0aW5nID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFnZW5kYV9BZ2VuZGFfSXRlbXMgPSB0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZyh0aGlzLm1lZXRpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZWV0aW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZyBBZ2VuZGFcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwibWVldGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIiArIFwibWVldGluZ1ttZWV0aW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lZXRpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVldGluZycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lZXRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lZXRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVldGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwib2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWdlbmRhX0FnZW5kYV9JdGVtcykpIHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcyhvYmouYWdlbmRhX0FnZW5kYV9JdGVtcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfTWVldGluZ19NaW51dGUiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX01pbnV0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLm1lZXRpbmcgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tZWV0aW5nID0gdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVldGluZztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9tZWV0aW5nKSByZXQgKz0gLyoodGhpcy5fbWVldGluZ19jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lZXRpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWVldGluZy4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0bWVldGluZzogb2JqLmdldFZhbHVlKFwibWVldGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lZXRpbmcobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nX01pbnV0ZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWVldGluZykge1xuXHRcdFx0XHRyZXQubWVldGluZyA9IHJldC5tZWV0aW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZyh0aGlzLm1lZXRpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZWV0aW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZyBNaW51dGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwibWVldGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIiArIFwibWVldGluZ1ttZWV0aW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lZXRpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVldGluZycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lZXRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lZXRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVldGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpY1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGVmaW5pdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlZmluaXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWZpbml0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnBhcmVudF9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50X0Zsb3dfSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfQWN0aW9uX0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpY19GbG93X0lucHV0X1NjcmlwdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndWlfaWQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbW1lbnQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdwYXJlbnRfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0aWYgKHRoaXMuX2RlZmluaXRpb24pIHJldCArPSAvKih0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVmaW5pdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdsb2dpY19kZWZpbml0aW9uLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfaW5wdXRfc2NyaXB0cy5pbnN0YW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0dWlfaWQ6IG9iai5nZXRWYWx1ZShcInVpX2lkXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdGNvbW1lbnQ6IG9iai5nZXRWYWx1ZShcImNvbW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdHBhcmVudF91aV9pZDogb2JqLmdldFZhbHVlKFwicGFyZW50X3VpX2lkXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdGxvZ2ljX2RlZmluaXRpb246IG9iai5nZXRWYWx1ZShcImxvZ2ljX2RlZmluaXRpb25cIiksXG5cblx0XHRcdFx0XHRcdGJsb2NrOiBvYmouZ2V0VmFsdWUoXCJibG9ja1wiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai51aV9pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoudWlfaWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmNvbW1lbnQpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5jb21tZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfdWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF91aV9pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sb2dpY19kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWZpbml0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoubG9naWNfZGVmaW5pdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBhcmVudF9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0xvZ2ljXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC51aV9pZCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb21tZW50ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuY29tbWVudCkgPT09ICdvYmplY3QnKSByZXQuY29tbWVudCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5jb21tZW50KSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGFyZW50X3VpX2lkID0gdGhpcy5wYXJlbnQoKTtcblxuXHRcdFx0aWYgKHJldC5wYXJlbnRfdWlfaWQpIHtcblx0XHRcdFx0cmV0LnBhcmVudF91aV9pZCA9IHJldC5wYXJlbnRfdWlfaWQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucGFyZW50X3VpX2lkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wYXJlbnRfdWlfaWQpLmxlbmd0aCkgcmV0LnBhcmVudF91aV9pZCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxvZ2ljX2RlZmluaXRpb24gPSB0aGlzLmRlZmluaXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5sb2dpY19kZWZpbml0aW9uKSB7XG5cdFx0XHRcdHJldC5sb2dpY19kZWZpbml0aW9uID0gcmV0LmxvZ2ljX2RlZmluaXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubG9naWNfZGVmaW5pdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubG9naWNfZGVmaW5pdGlvbikubGVuZ3RoKSByZXQubG9naWNfZGVmaW5pdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHJldC5ibG9jaykge1xuXHRcdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfRmxvd19Mb2dpY3MgPSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudF9GbG93X0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ1aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfdWlfaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsb2dpY19kZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19sb2dpYycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd1aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndWlfaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29tbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF91aV9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwYXJlbnRfdWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnRfdWlfaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBMb2dpY1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJkZWZpbml0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIgKyBcImRlZmluaXRpb25bbG9naWNfZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZpbml0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xvZ2ljX2RlZmluaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xvZ2ljX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xvZ2ljX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbG9naWNfZGVmaW5pdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19sb2dpYycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWMnLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpYyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5wYXJlbnRfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpKSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcyhvYmoucGFyZW50X0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzKSkgdGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykpIHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMpKSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyhvYmoubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfbG9naWMnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWMnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1BsYW4iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAncGxhbl9pZCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncGxhbicgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0cGxhbl9pZDogb2JqLmdldFZhbHVlKFwicGxhbl9pZFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRwbGFuOiBvYmouZ2V0VmFsdWUoXCJwbGFuXCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYW5faWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnBsYW5faWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYW4pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnBsYW4pKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5wbGFuKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1BsYW5cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wbGFuX2lkID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBsYW4gPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5wbGFuKSA9PT0gJ29iamVjdCcpIHJldC5wbGFuID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnBsYW4pKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGxhbl9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGxhblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19zdWJmbG93X3BsYW4nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGxhbl9pZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbGFuX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwbGFuX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BsYW5faWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGxhbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbGFuJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwbGFuJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BsYW4nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBQbGFuXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nLCBbJyonXSlbJ3N5c19mbG93X3N1YmZsb3dfcGxhbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X3N1YmZsb3dfcGxhbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3ViZmxvd19wbGFuJywgWycqJ10pWydzeXNfZmxvd19zdWJmbG93X3BsYW4nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nLCBbJyonXSlbJ3N5c19mbG93X3N1YmZsb3dfcGxhbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJuYW1lIjoic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnBlcnNvbkRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBlcnNvbkRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGVyc29uRGF5ID0gdjtcblx0XHRcdHRoaXMuX3BlcnNvbkRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wZXJzb25EYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmVmZm9ydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVmZm9ydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWZmb3J0ID0gdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGVyc29uRGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncGVyc29uRGF5JyArICh0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPScpICsgdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdGlmICh0aGlzLl9lZmZvcnQpIHJldCArPSAvKih0aGlzLl9lZmZvcnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lZmZvcnQoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWZmb3J0LicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlcXVpcmVtZW50KSByZXQgKz0gLyoodGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZXF1aXJlbWVudCgpLl90b0VRdWVyeShzUGF0aCArICdyZXF1aXJlbWVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cGVyc29uRGF5OiBvYmouZ2V0VmFsdWUoXCJwZXJzb25EYXlcIiksXG5cblx0XHRcdFx0XHRcdGVmZm9ydDogb2JqLmdldFZhbHVlKFwiZWZmb3J0XCIpLFxuXG5cdFx0XHRcdFx0XHRyZXF1aXJlbWVudDogb2JqLmdldFZhbHVlKFwicmVxdWlyZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdHJvbGU6IG9iai5nZXRWYWx1ZShcInJvbGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGVyc29uRGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wZXJzb25EYXkob2JqLnBlcnNvbkRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWZmb3J0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lZmZvcnQobmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KG9iai5lZmZvcnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVxdWlyZW1lbnQobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucm9sZShuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkVmZm9ydF9Fc3RpbWF0ZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BlcnNvbkRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGVyc29uRGF5ID0gdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWZmb3J0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lZmZvcnQgPSB0aGlzLmVmZm9ydCgpO1xuXG5cdFx0XHRpZiAocmV0LmVmZm9ydCkge1xuXHRcdFx0XHRyZXQuZWZmb3J0ID0gcmV0LmVmZm9ydC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5lZmZvcnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmVmZm9ydCkubGVuZ3RoKSByZXQuZWZmb3J0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlcXVpcmVtZW50ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnJlcXVpcmVtZW50KSB7XG5cdFx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHJldC5yZXF1aXJlbWVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZXF1aXJlbWVudCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVxdWlyZW1lbnQpLmxlbmd0aCkgcmV0LnJlcXVpcmVtZW50ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucm9sZSA9IHRoaXMucm9sZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJvbGUpIHtcblx0XHRcdFx0cmV0LnJvbGUgPSByZXQucm9sZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yb2xlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yb2xlKS5sZW5ndGgpIHJldC5yb2xlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwZXJzb25EYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wZXJzb25EYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGVyc29uRGF5KHRoaXMucGVyc29uRGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWZmb3J0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZWZmb3J0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVmZm9ydCh0aGlzLmVmZm9ydCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZXF1aXJlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlcXVpcmVtZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50KHRoaXMucmVxdWlyZW1lbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicm9sZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJvbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZSh0aGlzLnJvbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BlcnNvbmRheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwZXJzb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BlcnNvbmRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwZXJzb25kYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWZmb3J0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZWZmb3J0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZWZmb3J0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRWZmb3J0IEVzdGltYXRlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJlZmZvcnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJlZmZvcnRbZWZmb3J0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVmZm9ydCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlZmZvcnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWZmb3J0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlZmZvcnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWZmb3J0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwicmVxdWlyZW1lbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJyZXF1aXJlbWVudFtyZXF1aXJlbWVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1aXJlbWVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZXF1aXJlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZXF1aXJlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVxdWlyZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JvbGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yb2xlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRWZmb3J0IEVzdGltYXRlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJyb2xlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwicm9sZVtyb2xlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJvbGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncm9sZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyb2xlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyb2xlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JvbGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZyIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X01lZXRpbmciLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfTWVldGluZyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0YXJ0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhcnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5zdGFydCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3N0YXJ0ID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0YXJ0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZW5kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuZW5kKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZW5kID0gdjtcblx0XHRcdHRoaXMuX2VuZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zdGFydGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhcnRlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLnN0YXJ0ZWQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydGVkID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0ZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnRlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmVuZGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5lbmRlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2VuZGVkID0gdjtcblx0XHRcdHRoaXMuX2VuZGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuc2VyaWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VyaWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZXJpZXMgPSB2O1xuXHRcdFx0dGhpcy5fc2VyaWVzX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Nlcmllcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm9yZ2FuaXplciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZ2FuaXplcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JnYW5pemVyID0gdjtcblx0XHRcdHRoaXMuX29yZ2FuaXplcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmdhbml6ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5tb2RlcmF0b3IgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb2RlcmF0b3IodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21vZGVyYXRvciA9IHY7XG5cdFx0XHR0aGlzLl9tb2RlcmF0b3JfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZXJhdG9yO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcucHJvamVjdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2plY3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3Byb2plY3QgPSB2O1xuXHRcdFx0dGhpcy5fcHJvamVjdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5kZWNpc2lvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWNpc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZ19NZWV0aW5nX0FnZW5kYXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nX01lZXRpbmdfQWdlbmRhcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1lZXRpbmdfTWVldGluZ19NaW51dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZ19NZWV0aW5nX01pbnV0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX01lZXRpbmdfTWludXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nX01lZXRpbmdfTWludXRlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zdGFydCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXJ0JyArICh0aGlzLl9zdGFydF9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXJ0KCk7XG5cblx0XHRpZiAodGhpcy5fZW5kKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kJyArICh0aGlzLl9lbmRfY29vcCB8fCAnPScpICsgdGhpcy5lbmQoKTtcblxuXHRcdGlmICh0aGlzLl9zdGFydGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3RhcnRlZCcgKyAodGhpcy5fc3RhcnRlZF9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXJ0ZWQoKTtcblxuXHRcdGlmICh0aGlzLl9lbmRlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZGVkJyArICh0aGlzLl9lbmRlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuZGVkKCk7XG5cblx0XHRpZiAodGhpcy5fc2VyaWVzKSByZXQgKz0gLyoodGhpcy5fc2VyaWVzX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2VyaWVzKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Nlcmllcy4nKTtcblxuXHRcdGlmICh0aGlzLl9vcmdhbml6ZXIpIHJldCArPSAvKih0aGlzLl9vcmdhbml6ZXJfY29vcCB8fCAnPScpICsgKi8gdGhpcy5vcmdhbml6ZXIoKS5fdG9FUXVlcnkoc1BhdGggKyAnb3JnYW5pemVyLicpO1xuXG5cdFx0aWYgKHRoaXMuX21vZGVyYXRvcikgcmV0ICs9IC8qKHRoaXMuX21vZGVyYXRvcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1vZGVyYXRvcigpLl90b0VRdWVyeShzUGF0aCArICdtb2RlcmF0b3IuJyk7XG5cblx0XHRpZiAodGhpcy5fcHJvamVjdCkgcmV0ICs9IC8qKHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wcm9qZWN0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Byb2plY3QuJyk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX2RlY2lzaW9uKSByZXQgKz0gLyoodGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZWNpc2lvbigpLl90b0VRdWVyeShzUGF0aCArICdkZWNpc2lvbi4nKTtcblxuXHRcdCh0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYS5tZWV0aW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUubWVldGluZyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydDogb2JqLmdldFZhbHVlKFwic3RhcnRcIiksXG5cblx0XHRcdFx0XHRcdGVuZDogb2JqLmdldFZhbHVlKFwiZW5kXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydGVkOiBvYmouZ2V0VmFsdWUoXCJzdGFydGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmRlZDogb2JqLmdldFZhbHVlKFwiZW5kZWRcIiksXG5cblx0XHRcdFx0XHRcdHNlcmllczogb2JqLmdldFZhbHVlKFwic2VyaWVzXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmdhbml6ZXI6IG9iai5nZXRWYWx1ZShcIm9yZ2FuaXplclwiKSxcblxuXHRcdFx0XHRcdFx0bW9kZXJhdG9yOiBvYmouZ2V0VmFsdWUoXCJtb2RlcmF0b3JcIiksXG5cblx0XHRcdFx0XHRcdHByb2plY3Q6IG9iai5nZXRWYWx1ZShcInByb2plY3RcIiksXG5cblx0XHRcdFx0XHRcdGJvYXJkOiBvYmouZ2V0VmFsdWUoXCJib2FyZFwiKSxcblxuXHRcdFx0XHRcdFx0ZGVjaXNpb246IG9iai5nZXRWYWx1ZShcImRlY2lzaW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RhcnQob2JqLnN0YXJ0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuZChvYmouZW5kKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGFydGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGFydGVkKG9iai5zdGFydGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5kZWQob2JqLmVuZGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNlcmllcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvYmouc2VyaWVzKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmdhbml6ZXIobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoub3JnYW5pemVyKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kZXJhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tb2RlcmF0b3IobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kZXJhdG9yKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvamVjdChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai5wcm9qZWN0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWNpc2lvbihuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RhcnQgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRcdGlmIChyZXQuc3RhcnQgJiYgdHlwZW9mKHJldC5zdGFydC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydCA9IHJldC5zdGFydC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmQgPSB0aGlzLmVuZCgpO1xuXG5cdFx0XHRpZiAocmV0LmVuZCAmJiB0eXBlb2YocmV0LmVuZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmQgPSByZXQuZW5kLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdGFydGVkID0gdGhpcy5zdGFydGVkKCk7XG5cblx0XHRcdGlmIChyZXQuc3RhcnRlZCAmJiB0eXBlb2YocmV0LnN0YXJ0ZWQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnRlZCA9IHJldC5zdGFydGVkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5kZWQgPSB0aGlzLmVuZGVkKCk7XG5cblx0XHRcdGlmIChyZXQuZW5kZWQgJiYgdHlwZW9mKHJldC5lbmRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmRlZCA9IHJldC5lbmRlZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zZXJpZXMgPSB0aGlzLnNlcmllcygpO1xuXG5cdFx0XHRpZiAocmV0LnNlcmllcykge1xuXHRcdFx0XHRyZXQuc2VyaWVzID0gcmV0LnNlcmllcy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zZXJpZXMpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNlcmllcykubGVuZ3RoKSByZXQuc2VyaWVzID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmdhbml6ZXIgPSB0aGlzLm9yZ2FuaXplcigpO1xuXG5cdFx0XHRpZiAocmV0Lm9yZ2FuaXplcikge1xuXHRcdFx0XHRyZXQub3JnYW5pemVyID0gcmV0Lm9yZ2FuaXplci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5vcmdhbml6ZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm9yZ2FuaXplcikubGVuZ3RoKSByZXQub3JnYW5pemVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kZXJhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb2RlcmF0b3IgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1vZGVyYXRvcikge1xuXHRcdFx0XHRyZXQubW9kZXJhdG9yID0gcmV0Lm1vZGVyYXRvci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tb2RlcmF0b3IpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1vZGVyYXRvcikubGVuZ3RoKSByZXQubW9kZXJhdG9yID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJvamVjdCA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0XHRpZiAocmV0LnByb2plY3QpIHtcblx0XHRcdFx0cmV0LnByb2plY3QgPSByZXQucHJvamVjdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wcm9qZWN0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wcm9qZWN0KS5sZW5ndGgpIHJldC5wcm9qZWN0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJvYXJkID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAocmV0LmJvYXJkKSB7XG5cdFx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ib2FyZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYm9hcmQpLmxlbmd0aCkgcmV0LmJvYXJkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlY2lzaW9uID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRcdHJldC5kZWNpc2lvbiA9IHJldC5kZWNpc2lvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWNpc2lvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVjaXNpb24pLmxlbmd0aCkgcmV0LmRlY2lzaW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyA9IHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmdfTWVldGluZ19NaW51dGVzID0gdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXJ0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RhcnQodGhpcy5zdGFydCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmQodGhpcy5lbmQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnRlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydGVkKHRoaXMuc3RhcnRlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5kZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5kZWQodGhpcy5lbmRlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNlcmllc1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlcmllcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZXJpZXModGhpcy5zZXJpZXMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JnYW5pemVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JnYW5pemVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcih0aGlzLm9yZ2FuaXplcigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb2RlcmF0b3JcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb2RlcmF0b3IoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZXJhdG9yKHRoaXMubW9kZXJhdG9yKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInByb2plY3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9qZWN0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3QodGhpcy5wcm9qZWN0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJvYXJkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYm9hcmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYm9hcmQodGhpcy5ib2FyZCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWNpc2lvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlY2lzaW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uKHRoaXMuZGVjaXNpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGFydF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0YXJ0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5kX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5kJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGFydGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGFydGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXJ0ZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuZGVkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmRlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5kZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2VyaWVzX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInNlcmllcyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJzZXJpZXNbc2VyaWVzXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNlcmllcygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzZXJpZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NlcmllcycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2VyaWVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NlcmllcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmdhbml6ZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmdhbml6ZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwib3JnYW5pemVyIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcIm9yZ2FuaXplcltvcmdhbml6ZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3JnYW5pemVyKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZ2FuaXplcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JnYW5pemVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmdhbml6ZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JnYW5pemVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vZGVyYXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vZGVyYXRvcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJtb2RlcmF0b3IgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwibW9kZXJhdG9yW21vZGVyYXRvcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2RlcmF0b3IoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9kZXJhdG9yJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb2RlcmF0b3InKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vZGVyYXRvcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2RlcmF0b3InLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInByb2plY3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwicHJvamVjdFtwcm9qZWN0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnByb2plY3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncHJvamVjdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJib2FyZCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJib2FyZFtib2FyZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ib2FyZCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdib2FyZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2JvYXJkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2JvYXJkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJkZWNpc2lvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJkZWNpc2lvbltkZWNpc2lvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWNpc2lvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWNpc2lvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlY2lzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHRpZiAoX29iai5zdGFydCAmJiB0eXBlb2YoX29iai5zdGFydC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouc3RhcnQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLnN0YXJ0KTtcblxuXHRcdFx0aWYgKF9vYmouZW5kICYmIHR5cGVvZihfb2JqLmVuZC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZW5kID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5lbmQpO1xuXG5cdFx0XHRpZiAoX29iai5zdGFydGVkICYmIHR5cGVvZihfb2JqLnN0YXJ0ZWQuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLnN0YXJ0ZWQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLnN0YXJ0ZWQpO1xuXG5cdFx0XHRpZiAoX29iai5lbmRlZCAmJiB0eXBlb2YoX29iai5lbmRlZC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZW5kZWQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmVuZGVkKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMpKSB0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKSkgdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcyhvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm1heF9sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbWF4X2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm1vZGVsX3RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuYXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfYXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2F0dHJpYnV0ZXMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF90eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3ZhcmlhYmxlX3ZhbHVlLmFjdGlvbklucHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0YXR0cmlidXRlczogb2JqLmdldFZhbHVlKFwiYXR0cmlidXRlc1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmF0dHJpYnV0ZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5hdHRyaWJ1dGVzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnRlcm5hbF90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG9iai5pbnRlcm5hbF90eXBlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9JbnB1dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmF0dHJpYnV0ZXMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hdHRyaWJ1dGVzKSA9PT0gJ29iamVjdCcpIHJldC5hdHRyaWJ1dGVzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmF0dHJpYnV0ZXMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfdHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXhfbGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1heF9sZW5ndGggPSB0aGlzLm1heF9sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF9pZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF9pZCA9IHRoaXMubW9kZWxfaWQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF90YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF90YWJsZSA9IHRoaXMubW9kZWxfdGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl9pbnB1dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhYmVsJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXR0cmlidXRlcycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5wdXQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl9pbnB1dCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25faW5wdXQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfT3V0cHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfT3V0cHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfVmFyaWFibGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfUGxhbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X1BsYW5zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19QbGFucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfUGxhbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfUGxhbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbF9jYWNoZScgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3BhcmVudF9mbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19pbnB1dC5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfb3V0cHV0LnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3ZhcmlhYmxlLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2xvZ2ljLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZS5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5wdXQuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19mbG93X3N1YmZsb3dfcGxhbi5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2Zsb3dfZGF0YV92YXIuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZyb21GbG93XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZnJvbUZsb3cocGF5bG9hZFtcImZsb3dcIl0sICk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF9uYW1lOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF9uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsX2NhY2hlOiBvYmouZ2V0VmFsdWUoXCJsYWJlbF9jYWNoZVwiKSxcblxuXHRcdFx0XHRcdFx0cGFyZW50X2Zsb3c6IG9iai5nZXRWYWx1ZShcInBhcmVudF9mbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRibG9jazogb2JqLmdldFZhbHVlKFwiYmxvY2tcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouaW50ZXJuYWxfbmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWxfY2FjaGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmxhYmVsX2NhY2hlKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoubGFiZWxfY2FjaGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X2Zsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19QbGFucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19TbmFwc2hvdFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbF9jYWNoZSA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmxhYmVsX2NhY2hlKSA9PT0gJ29iamVjdCcpIHJldC5sYWJlbF9jYWNoZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5sYWJlbF9jYWNoZSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF9mbG93KSB7XG5cdFx0XHRcdHJldC5wYXJlbnRfZmxvdyA9IHJldC5wYXJlbnRfZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucGFyZW50X2Zsb3cpLmxlbmd0aCkgcmV0LnBhcmVudF9mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJsb2NrID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ibG9jaykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYmxvY2spLmxlbmd0aCkgcmV0LmJsb2NrID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19JbnB1dHMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19PdXRwdXRzID0gdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzID0gdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19Mb2dpY3MgPSB0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyA9IHRoaXMuc25hcHNob3RfRmxvd19JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfQWN0aW9uX0lucHV0cyA9IHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19QbGFucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X1BsYW5zID0gdGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnRlcm5hbF9uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbF9jYWNoZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfc25hcHNob3QnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF9uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWxfY2FjaGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsX2NhY2hlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbF9jYWNoZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbF9jYWNoZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W3BhcmVudF9mbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF9mbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXJlbnRfZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnRfZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19JbnB1dHMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKG9iai5zbmFwc2hvdF9GbG93X0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19PdXRwdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cykpIHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyhvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19Mb2dpY3MpKSB0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKG9iai5zbmFwc2hvdF9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcykpIHRoaXMuc25hcHNob3RfRmxvd19JbnN0YW5jZXMob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSkgdGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X1BsYW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X1BsYW5zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcykpIHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyhvYmouc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyb21GbG93KF9fZXZlbnQsIGZsb3cpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGZsb3cgPSBldkpTT04uZmxvdztcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gZXZKU09OO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZ2V0UGFyYW1ldGVyKSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YoZmxvdykgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcignZmxvdycpKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0ZmxvdyA9IHRoaXMuZ2V0UGFyYW1ldGVyKCdmbG93Jyk7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5pbnB1dF9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnB1dF9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9pbnB1dF9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnB1dF9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubWF4X2xlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tYXhfbGVuZ3RoID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiAoe1xuXHRcdFx0XHRcdFx0XCJTdHJpbmdcIjogMjU1LFxuXHRcdFx0XHRcdFx0XCJUZXh0XCI6IDQwMDAsXG5cdFx0XHRcdFx0fSlbdGhpcy50eXBlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubW9kZWxfdGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tb2RlbF90YWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lm1vZGVsX2lkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfaWQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5hdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdEF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2F0dHJpYnV0ZXMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF90eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19kb2N1bWVudGF0aW9uLmlucHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfdmFyaWFibGVfdmFsdWUuZmxvd0lucHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0YXR0cmlidXRlczogb2JqLmdldFZhbHVlKFwiYXR0cmlidXRlc1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmF0dHJpYnV0ZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5hdHRyaWJ1dGVzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnRlcm5hbF90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG9iai5pbnRlcm5hbF90eXBlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5wdXRfRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLmlucHV0X0ZpZWxkX0xhYmVscykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5wdXRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmF0dHJpYnV0ZXMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hdHRyaWJ1dGVzKSA9PT0gJ29iamVjdCcpIHJldC5hdHRyaWJ1dGVzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmF0dHJpYnV0ZXMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfdHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmlucHV0X0ZpZWxkX0xhYmVscyA9IHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX3RhYmxlID0gdGhpcy5tb2RlbF90YWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX2lkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX2lkID0gdGhpcy5tb2RlbF9pZCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhdHRyaWJ1dGVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX3R5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2lucHV0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhdHRyaWJ1dGVzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnRlcm5hbF90eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2lucHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfaW5wdXQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X2lucHV0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2lucHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLmlucHV0X0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5wdXRfRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmlucHV0X0ZpZWxkX0xhYmVscykpIHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKG9iai5pbnB1dF9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfaW5wdXQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2lucHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfaW5wdXQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQub3V0cHV0X0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG91dHB1dF9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9vdXRwdXRfRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fb3V0cHV0X0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3V0cHV0X0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnRiMlJsYkY5cFpDSmRmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm1vZGVsX2lkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfaWQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm1vZGVsX3RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2F0dHJpYnV0ZXMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF90eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZG9jdW1lbnRhdGlvbi5vdXRwdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRhdHRyaWJ1dGVzOiBvYmouZ2V0VmFsdWUoXCJhdHRyaWJ1dGVzXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF90eXBlOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF90eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmF0dHJpYnV0ZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5hdHRyaWJ1dGVzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnRlcm5hbF90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG9iai5pbnRlcm5hbF90eXBlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3V0cHV0X0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvYmoub3V0cHV0X0ZpZWxkX0xhYmVscykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfT3V0cHV0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmF0dHJpYnV0ZXMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hdHRyaWJ1dGVzKSA9PT0gJ29iamVjdCcpIHJldC5hdHRyaWJ1dGVzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmF0dHJpYnV0ZXMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfdHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vdXRwdXRfRmllbGRfTGFiZWxzID0gdGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXhfbGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1heF9sZW5ndGggPSB0aGlzLm1heF9sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF9pZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF9pZCA9IHRoaXMubW9kZWxfaWQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF90YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF90YWJsZSA9IHRoaXMubW9kZWxfdGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19vdXRwdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19vdXRwdXQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VsZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdsYWJlbCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2F0dHJpYnV0ZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IE91dHB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IE91dHB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgT3V0cHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfb3V0cHV0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X291dHB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X291dHB1dCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIm9iai5vdXRwdXRfRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5vdXRwdXRfRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMpKSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfb3V0cHV0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19vdXRwdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19vdXRwdXQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnZhcmlhYmxlX0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhcmlhYmxlX0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3ZhcmlhYmxlX0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3ZhcmlhYmxlX0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmFyaWFibGVfRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnRiMlJsYkY5cFpDSmRmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm1heF9sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbWF4X2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm1vZGVsX2lkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfaWQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5tb2RlbF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuYXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfYXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VsZW1lbnQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdhdHRyaWJ1dGVzJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaW50ZXJuYWxfdHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHRoaXMudmFyaWFibGVfRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZG9jdW1lbnRhdGlvbi52YXJpYWJsZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZWxlbWVudDogb2JqLmdldFZhbHVlKFwiZWxlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGF0dHJpYnV0ZXM6IG9iai5nZXRWYWx1ZShcImF0dHJpYnV0ZXNcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX3R5cGU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZWxlbWVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmxhYmVsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hdHRyaWJ1dGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5hdHRyaWJ1dGVzKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouYXR0cmlidXRlcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmouaW50ZXJuYWxfdHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1ZhcmlhYmxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbGVtZW50ID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubGFiZWwgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hdHRyaWJ1dGVzID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXR0cmlidXRlcykgPT09ICdvYmplY3QnKSByZXQuYXR0cmlidXRlcyA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5hdHRyaWJ1dGVzKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmludGVybmFsX3R5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmIChyZXQucmVmZXJlbmNlKSB7XG5cdFx0XHRcdHJldC5yZWZlcmVuY2UgPSByZXQucmVmZXJlbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc25hcHNob3QgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmIChyZXQuc25hcHNob3QpIHtcblx0XHRcdFx0cmV0LnNuYXBzaG90ID0gcmV0LnNuYXBzaG90Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNuYXBzaG90KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zbmFwc2hvdCkubGVuZ3RoKSByZXQuc25hcHNob3QgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52YXJpYWJsZV9GaWVsZF9MYWJlbHMgPSB0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWF4X2xlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXhfbGVuZ3RoID0gdGhpcy5tYXhfbGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfaWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfaWQgPSB0aGlzLm1vZGVsX2lkKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfdGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfdGFibGUgPSB0aGlzLm1vZGVsX3RhYmxlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd192YXJpYWJsZScsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2F0dHJpYnV0ZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXR0cmlidXRlcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgVmFyaWFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfdmFyaWFibGUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJywgWycqJ10pWydzeXNfaHViX2Zsb3dfdmFyaWFibGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzKSkgdGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd192YXJpYWJsZScsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm1heF9sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbWF4X2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm1vZGVsX3RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuYXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfYXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2F0dHJpYnV0ZXMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF90eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0YXR0cmlidXRlczogb2JqLmdldFZhbHVlKFwiYXR0cmlidXRlc1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVsZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXR0cmlidXRlcykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYXR0cmlidXRlcykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmF0dHJpYnV0ZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19EYXRhX1ZhcmlhYmxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXR0cmlidXRlcyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmF0dHJpYnV0ZXMpID09PSAnb2JqZWN0JykgcmV0LmF0dHJpYnV0ZXMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuYXR0cmlidXRlcykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF90eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXhfbGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1heF9sZW5ndGggPSB0aGlzLm1heF9sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF9pZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF9pZCA9IHRoaXMubW9kZWxfaWQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF90YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF90YWJsZSA9IHRoaXMubW9kZWxfdGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhdHRyaWJ1dGVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX3R5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX3ZhcicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV92YXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19mbG93X2RhdGFfdmFyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VsZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdsYWJlbCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhdHRyaWJ1dGVzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXR0cmlidXRlcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBEYXRhIFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgRGF0YSBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgRGF0YSBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2Zsb3dfZGF0YV92YXInKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfdmFyJywgWycqJ10pWydzeXNfZmxvd19kYXRhX3ZhciddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfZGF0YV92YXInKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1JlcXVpcmVtZW50IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfUmVxdWlyZW1lbnQiLCJuYW1lIjoic2hzX2FyYmZ3X1JlcXVpcmVtZW50Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1JlcXVpcmVtZW50IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19SZXF1aXJlbWVudFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnByb2plY3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9qZWN0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wcm9qZWN0ID0gdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvamVjdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5jYXBhYmlsaXR5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2FwYWJpbGl0eSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eSA9IHY7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NhcGFiaWxpdHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50X0FnZW5kYV9JdGVtcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wcm9qZWN0KSByZXQgKz0gLyoodGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2plY3QoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvamVjdC4nKTtcblxuXHRcdGlmICh0aGlzLl9jYXBhYmlsaXR5KSByZXQgKz0gLyoodGhpcy5fY2FwYWJpbGl0eV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmNhcGFiaWxpdHkoKS5fdG9FUXVlcnkoc1BhdGggKyAnY2FwYWJpbGl0eS4nKTtcblxuXHRcdCh0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZS5yZXF1aXJlbWVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbS5yZXF1aXJlbWVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRwcm9qZWN0OiBvYmouZ2V0VmFsdWUoXCJwcm9qZWN0XCIpLFxuXG5cdFx0XHRcdFx0XHRjYXBhYmlsaXR5OiBvYmouZ2V0VmFsdWUoXCJjYXBhYmlsaXR5XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvamVjdChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai5wcm9qZWN0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY2FwYWJpbGl0eSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY2FwYWJpbGl0eShuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KG9iai5jYXBhYmlsaXR5KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMobmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMobmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlJlcXVpcmVtZW50XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnByb2plY3QgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdFx0aWYgKHJldC5wcm9qZWN0KSB7XG5cdFx0XHRcdHJldC5wcm9qZWN0ID0gcmV0LnByb2plY3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucHJvamVjdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucHJvamVjdCkubGVuZ3RoKSByZXQucHJvamVjdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNhcGFiaWxpdHkgPSB0aGlzLmNhcGFiaWxpdHkoKTtcblxuXHRcdFx0aWYgKHJldC5jYXBhYmlsaXR5KSB7XG5cdFx0XHRcdHJldC5jYXBhYmlsaXR5ID0gcmV0LmNhcGFiaWxpdHkuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuY2FwYWJpbGl0eSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuY2FwYWJpbGl0eSkubGVuZ3RoKSByZXQuY2FwYWJpbGl0eSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzID0gdGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zID0gdGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvamVjdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2plY3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdCh0aGlzLnByb2plY3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY2FwYWJpbGl0eVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNhcGFiaWxpdHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2FwYWJpbGl0eSh0aGlzLmNhcGFiaWxpdHkoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wcm9qZWN0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlJlcXVpcmVtZW50XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInByb2plY3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIgKyBcInByb2plY3RbcHJvamVjdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9qZWN0KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2plY3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Byb2plY3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2FwYWJpbGl0eSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NhcGFiaWxpdHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jYXBhYmlsaXR5KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUmVxdWlyZW1lbnRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwiY2FwYWJpbGl0eSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIiArIFwiY2FwYWJpbGl0eVtjYXBhYmlsaXR5XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmNhcGFiaWxpdHkoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY2FwYWJpbGl0eScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NhcGFiaWxpdHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NhcGFiaWxpdHknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY2FwYWJpbGl0eScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwib2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyhvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIm9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMpKSB0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyhvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmNvbHVtbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uID0gdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3Vic2NyaXB0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3Vic2NyaXB0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb24gPSB2O1xuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4pIHJldCArPSAvKih0aGlzLl9jb2x1bW5fY29vcCB8fCAnPScpICsgKi8gdGhpcy5jb2x1bW4oKS5fdG9FUXVlcnkoc1BhdGggKyAnY29sdW1uLicpO1xuXG5cdFx0aWYgKHRoaXMuX3N1YnNjcmlwdGlvbikgcmV0ICs9IC8qKHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YnNjcmlwdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzdWJzY3JpcHRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2x1bW46IG9iai5nZXRWYWx1ZShcImNvbHVtblwiKSxcblxuXHRcdFx0XHRcdFx0c3Vic2NyaXB0aW9uOiBvYmouZ2V0VmFsdWUoXCJzdWJzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29sdW1uKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW4pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN1YnNjcmlwdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zdWJzY3JpcHRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU3Vic2NyaXB0aW9uX1RyaWdnZXJcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2x1bW4gPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAocmV0LmNvbHVtbikge1xuXHRcdFx0XHRyZXQuY29sdW1uID0gcmV0LmNvbHVtbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5jb2x1bW4pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmNvbHVtbikubGVuZ3RoKSByZXQuY29sdW1uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3Vic2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdWJzY3JpcHRpb24gPSB0aGlzLnN1YnNjcmlwdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN1YnNjcmlwdGlvbikge1xuXHRcdFx0XHRyZXQuc3Vic2NyaXB0aW9uID0gcmV0LnN1YnNjcmlwdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zdWJzY3JpcHRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN1YnNjcmlwdGlvbikubGVuZ3RoKSByZXQuc3Vic2NyaXB0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29sdW1uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29sdW1uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbih0aGlzLmNvbHVtbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdWJzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdWJzY3JpcHRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3Vic2NyaXB0aW9uKHRoaXMuc3Vic2NyaXB0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2x1bW4pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2x1bW5fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTdWJzY3JpcHRpb24gVHJpZ2dlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJjb2x1bW4gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcImNvbHVtbltjb2x1bW5dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY29sdW1uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbHVtbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbHVtbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29sdW1uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdWJzY3JpcHRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdWJzY3JpcHRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTdWJzY3JpcHRpb24gVHJpZ2dlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJzdWJzY3JpcHRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcInN1YnNjcmlwdGlvbltzdWJzY3JpcHRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc3Vic2NyaXB0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N1YnNjcmlwdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N1YnNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3Vic2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1YnNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU3Vic2NyaXB0aW9uX1RyaWdnZXInLCBbJyonXSlbJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmdcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuc291cmNlX3R5cGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c291cmNlVHlwZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3NvdXJjZV90eXBlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN5c19odWJfZmxvd1wiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuc291cmNlVHlwZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaWMzbHpYMmgxWWw5bWJHOTNJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVwb3J0aW5nJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdzb3VyY2UuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRyZXBvcnRpbmc6IG9iai5nZXRWYWx1ZShcInJlcG9ydGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0c291cmNlOiBvYmouZ2V0VmFsdWUoXCJzb3VyY2VcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcG9ydGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoucmVwb3J0aW5nKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc291cmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc291cmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfU2V0dGluZ1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlcG9ydGluZyA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc291cmNlID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuc291cmNlKSB7XG5cdFx0XHRcdHJldC5zb3VyY2UgPSByZXQuc291cmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNvdXJjZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc291cmNlKS5sZW5ndGgpIHJldC5zb3VyY2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNvdXJjZV90eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNvdXJjZV90eXBlID0gdGhpcy5zb3VyY2VfdHlwZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlcG9ydGluZ1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNvdXJjZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVwb3J0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcG9ydGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVwb3J0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlcG9ydGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgU2V0dGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIgKyBcImZsb3dbc291cmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc291cmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NvdXJjZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc291cmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NvdXJjZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnLCBbJyonXSlbJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3ciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3ciLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvdyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3cgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc2VjdXJpdHlDb250cm9sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VjdXJpdHlDb250cm9sKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2wgPSB2O1xuXHRcdFx0dGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlY3VyaXR5Q29udHJvbDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0Zsb3dfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfRmxvd19JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19PdXRwdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X091dHB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X091dHB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnN1YmZsb3dfRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdWJmbG93X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc3ViZmxvd19GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0FjdGlvbl9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19TZXR0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TZXR0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NldHRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X1NuYXBzaG90cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1NuYXBzaG90c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY2FsbGFibGVfYnlfY2xpZW50X2FwaSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjbGllbnRDYWxsYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2NhbGxhYmxlX2J5X2NsaWVudF9hcGkgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuY2xpZW50Q2FsbGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVoWTJ4elB5ZDBjblZsSnpvblptRnNjMlVuS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBDUmxlR2x6ZEhNb2UzdGZYMzE5TG1GamJITXBQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5zeXNfcG9saWN5IEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBvbGljeSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3N5c19wb2xpY3kgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cucG9saWN5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelB5ZHdjbTkwWldOMFpXUW5PaWNuS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBDUmxlR2x6ZEhNb2UzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhNcFB5ZHdjbTkwWldOMFpXUW5PaWNuUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc3RhdHVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXR1cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3N0YXR1cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdGF0dXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6UHlkd2RXSnNhWE5vWldRbk9pZGtjbUZtZENjcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKR1Y0YVhOMGN5aDdlMTlmZlgwdVpteHZkMTlHYkc5M1gxTnVZWEJ6YUc5MGN5ay9KM0IxWW14cGMyaGxaQ2M2SjJSeVlXWjBKejQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy50eXBlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl90eXBlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN1YmZsb3dcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy50eXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNWaVpteHZkeUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmxhdGVzdF9zbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYXN0U25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYXRlc3Rfc25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubGFzdFNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelAzdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSeld6QmRMa2xrT2ljbktUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQSHQ3WDE5OWZTNW1iRzkzWDBac2IzZGZVMjVoY0hOb2IzUnpXekJkTGtsa1BqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm1hc3Rlcl9zbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYWluU25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tYXN0ZXJfc25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubWFpblNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1c1lYUmxjM1JmYzI1aGNITm9iM1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OGUzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhOYk1GMHVTV1ErUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcImJyb3dzZXJBY3RpdmF0ZWRJbj1jaHJvbWUsaW50ZWdyYXRpb25BY3RpdmF0ZWRJbj1zdGFuZGFsb25lLGxhYmVsQ2FjaGVDbGVhblVwRXhlY3V0ZWQ9dHJ1ZSx0aW1lRnJvbUNyZWF0ZVRvQWN0aXZhdGU9Mzk3MDAwLHZpZXdBY3RpdmF0ZWRJbj1uYXR1cmFsTGFuZ3VhZ2VcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5hdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pWW5KdmQzTmxja0ZqZEdsMllYUmxaRWx1UFdOb2NtOXRaU3hwYm5SbFozSmhkR2x2YmtGamRHbDJZWFJsWkVsdVBYTjBZVzVrWVd4dmJtVXNiR0ZpWld4RFlXTm9aVU5zWldGdVZYQkZlR1ZqZFhSbFpEMTBjblZsTEhScGJXVkdjbTl0UTNKbFlYUmxWRzlCWTNScGRtRjBaVDB6T1Rjd01EQXNkbWxsZDBGamRHbDJZWFJsWkVsdVBXNWhkSFZ5WVd4TVlXNW5kV0ZuWlNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5sYWJlbF9jYWNoZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYWJlbENhY2hlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbGFiZWxfY2FjaGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+IGA8PCRhcHBlbmQoJGFwcGVuZCgqKi5wYXJlbnRfRmxvd19JbnN0YW5jZXNbbGFiZWxfY2FjaGU9J3t7aWR9fSddLntcIm5hbWVcIjogdWlfaWQmXCIuXCImc3ViZmxvdy5pbnRlcm5hbF9uYW1lLCBcInJlZmVyZW5jZV9kaXNwbGF5XCI6ICcke3RoaXMuRW50aXR5Q2xhc3MuTmFtZX0nLCBcImxhYmVsXCI6IG9yZGVyJicgLSAnJnN1YmZsb3cubmFtZSYnXFx1Mjc5Yicmc3ViZmxvdy5uYW1lLCBcImJhc2VfdHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJhdHRyaWJ1dGVzXCI6IHtcImVsZW1lbnRfbWFwcGluZ19wcm92aWRlclwiOiAnY29tLmdsaWRlLmZsb3dfZGVzaWduLmFjdGlvbi5kYXRhLkZsb3dEZXNpZ25WYXJpYWJsZU1hcHBlcicsIFwidWlUeXBlXCI6IGludGVybmFsX3R5cGUsIFwidWlVbmlxdWVJZFwiOiBJZH19WyRdLFxuXG4kLmZsb3dfRmxvd19WYXJpYWJsZXMue1wibmFtZVwiOiAnZmxvd192YXJpYWJsZS4nJmVsZW1lbnQsIFwicmVmZXJlbmNlX2Rpc3BsYXlcIjogJ2xhYmVsJ1xuLCBcImxhYmVsXCI6ICdGbG93IFZhcmlhYmxlc1xcdTI3OWInJmVsZW1lbnQsIFwiYmFzZV90eXBlXCI6IGludGVybmFsX3R5cGUsXG5cInR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJhdHRyaWJ1dGVzXCI6IHtcbiAgICBcImVsZW1lbnRfbWFwcGluZ19wcm92aWRlclwiOiAnY29tLmdsaWRlLmZsb3dfZGVzaWduLmFjdGlvbi5kYXRhLkZsb3dEZXNpZ25WYXJpYWJsZU1hcHBlcicsXG4gICAgXCJ1aVR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJ1aVVuaXF1ZUlkXCI6IElkXG59XG59KVxuLFxuJC5mbG93X0Zsb3dfSW5wdXRzLntcIm5hbWVcIjogJ3N1YmZsb3cuJyZlbGVtZW50LCBcInJlZmVyZW5jZV9kaXNwbGF5XCI6ICdsYWJlbCdcbiwgXCJsYWJlbFwiOiAnSW5wdXRcXHUyNzliJyZlbGVtZW50LCBcImJhc2VfdHlwZVwiOiBpbnRlcm5hbF90eXBlLFxuXCJ0eXBlXCI6IGludGVybmFsX3R5cGUsIFwiYXR0cmlidXRlc1wiOiB7XG4gICAgXCJlbGVtZW50X21hcHBpbmdfcHJvdmlkZXJcIjogJ2NvbS5nbGlkZS5mbG93X2Rlc2lnbi5hY3Rpb24uZGF0YS5GbG93RGVzaWduVmFyaWFibGVNYXBwZXInLFxuICAgIFwidWlUeXBlXCI6IGludGVybmFsX3R5cGUsIFwidWlVbmlxdWVJZFwiOiBJZFxufX0pPj5gO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmxhYmVsQ2FjaGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z1lEdzhKR0Z3Y0dWdVpDZ2tZWEJ3Wlc1a0tDb3FMbkJoY21WdWRGOUdiRzkzWDBsdWMzUmhibU5sYzF0c1lXSmxiRjlqWVdOb1pUMG5lM3RwWkgxOUoxMHVlMXdpYm1GdFpWd2lPaUIxYVY5cFpDWmNJaTVjSWlaemRXSm1iRzkzTG1sdWRHVnlibUZzWDI1aGJXVXNJRndpY21WbVpYSmxibU5sWDJScGMzQnNZWGxjSWpvZ0oxeGNKSHQwYUdsekxrVnVkR2wwZVVOc1lYTnpMazVoYldWOUp5d2dYQ0pzWVdKbGJGd2lPaUJ2Y21SbGNpWW5JQzBnSnlaemRXSm1iRzkzTG01aGJXVW1KMXhjWEZ4MU1qYzVZaWNtYzNWaVpteHZkeTV1WVcxbExDQmNJbUpoYzJWZmRIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW5SNWNHVmNJam9nYVc1MFpYSnVZV3hmZEhsd1pTd2dYQ0poZEhSeWFXSjFkR1Z6WENJNklIdGNJbVZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNsd2lPaUFuWTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpY3NJRndpZFdsVWVYQmxYQ0k2SUdsdWRHVnlibUZzWDNSNWNHVXNJRndpZFdsVmJtbHhkV1ZKWkZ3aU9pQkpaSDE5V3lSZExGeHVYRzRrTG1ac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhNdWUxd2libUZ0WlZ3aU9pQW5abXh2ZDE5MllYSnBZV0pzWlM0bkptVnNaVzFsYm5Rc0lGd2ljbVZtWlhKbGJtTmxYMlJwYzNCc1lYbGNJam9nSjJ4aFltVnNKMXh1TENCY0lteGhZbVZzWENJNklDZEdiRzkzSUZaaGNtbGhZbXhsYzF4Y1hGeDFNamM1WWljbVpXeGxiV1Z1ZEN3Z1hDSmlZWE5sWDNSNWNHVmNJam9nYVc1MFpYSnVZV3hmZEhsd1pTeGNibHdpZEhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJbUYwZEhKcFluVjBaWE5jSWpvZ2UxeHVJQ0FnSUZ3aVpXeGxiV1Z1ZEY5dFlYQndhVzVuWDNCeWIzWnBaR1Z5WENJNklDZGpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5Snl4Y2JpQWdJQ0JjSW5WcFZIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW5WcFZXNXBjWFZsU1dSY0lqb2dTV1JjYm4xY2JuMHBYRzRzWEc0a0xtWnNiM2RmUm14dmQxOUpibkIxZEhNdWUxd2libUZ0WlZ3aU9pQW5jM1ZpWm14dmR5NG5KbVZzWlcxbGJuUXNJRndpY21WbVpYSmxibU5sWDJScGMzQnNZWGxjSWpvZ0oyeGhZbVZzSjF4dUxDQmNJbXhoWW1Wc1hDSTZJQ2RKYm5CMWRGeGNYRngxTWpjNVlpY21aV3hsYldWdWRDd2dYQ0ppWVhObFgzUjVjR1ZjSWpvZ2FXNTBaWEp1WVd4ZmRIbHdaU3hjYmx3aWRIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW1GMGRISnBZblYwWlhOY0lqb2dlMXh1SUNBZ0lGd2laV3hsYldWdWRGOXRZWEJ3YVc1blgzQnliM1pwWkdWeVhDSTZJQ2RqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUp5eGNiaUFnSUNCY0luVnBWSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0luVnBWVzVwY1hWbFNXUmNJam9nU1dSY2JuMTlLVDQrWUNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHRpZiAodGhpcy5fc2VjdXJpdHlDb250cm9sKSByZXQgKz0gLyoodGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2VjdXJpdHlDb250cm9sKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjbHMuJyk7XG5cblx0XHQodGhpcy5mbG93X0Zsb3dfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfaW5wdXQuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19vdXRwdXQuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3ZhcmlhYmxlLmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19sb2dpYy5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlLnN1YmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5wdXQuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X1NldHRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZy5zb3VyY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19zbmFwc2hvdC5wYXJlbnRfZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZmxvd19kYXRhX3Zhci5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF9uYW1lOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF9uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRhY2xzOiBvYmouZ2V0VmFsdWUoXCJhY2xzXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouaW50ZXJuYWxfbmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJsb2NrKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2spKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY2xzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zZWN1cml0eUNvbnRyb2wobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG9iai5hY2xzKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfT3V0cHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfTG9naWNzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0FjdGlvbl9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X1NldHRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X1NldHRpbmdzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfU2V0dGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X1NuYXBzaG90cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF9uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJsb2NrID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ibG9jaykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYmxvY2spLmxlbmd0aCkgcmV0LmJsb2NrID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VjdXJpdHlDb250cm9sKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY2xzID0gdGhpcy5zZWN1cml0eUNvbnRyb2woKTtcblxuXHRcdFx0aWYgKHJldC5hY2xzKSB7XG5cdFx0XHRcdHJldC5hY2xzID0gcmV0LmFjbHMuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWNscykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWNscykubGVuZ3RoKSByZXQuYWNscyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfSW5wdXRzID0gdGhpcy5mbG93X0Zsb3dfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfT3V0cHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfT3V0cHV0cyA9IHRoaXMuZmxvd19GbG93X091dHB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X1ZhcmlhYmxlcyA9IHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfTG9naWNzID0gdGhpcy5mbG93X0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN1YmZsb3dfRmxvd19JbnN0YW5jZXMgPSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0FjdGlvbl9JbnB1dHMgPSB0aGlzLmZsb3dfQWN0aW9uX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X1NldHRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19TZXR0aW5ncyA9IHRoaXMuZmxvd19GbG93X1NldHRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19TbmFwc2hvdHMgPSB0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSB0aGlzLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY2FsbGFibGVfYnlfY2xpZW50X2FwaSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jYWxsYWJsZV9ieV9jbGllbnRfYXBpID0gdGhpcy5jYWxsYWJsZV9ieV9jbGllbnRfYXBpKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc3lzX3BvbGljeSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfcG9saWN5ID0gdGhpcy5zeXNfcG9saWN5KCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc3RhdHVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXR1cyA9IHRoaXMuc3RhdHVzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubGF0ZXN0X3NuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxhdGVzdF9zbmFwc2hvdCA9IHRoaXMubGF0ZXN0X3NuYXBzaG90KCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWFzdGVyX3NuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hc3Rlcl9zbmFwc2hvdCA9IHRoaXMubWFzdGVyX3NuYXBzaG90KCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubGFiZWxfY2FjaGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGFiZWxfY2FjaGUgPSB0aGlzLmxhYmVsX2NhY2hlKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJsb2NrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYmxvY2soKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2sodGhpcy5ibG9jaygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY2xzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VjdXJpdHlDb250cm9sKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlY3VyaXR5Q29udHJvbCh0aGlzLnNlY3VyaXR5Q29udHJvbCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvdycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ludGVybmFsX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYmxvY2snKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlY3VyaXR5Q29udHJvbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NlY3VyaXR5Q29udHJvbF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNlY3VyaXR5Q29udHJvbCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJzZWN1cml0eUNvbnRyb2wgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIiArIFwic2VjdXJpdHlDb250cm9sW2FjbHNdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc2VjdXJpdHlDb250cm9sKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjbHMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjbHMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjbHMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWNscycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3cnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfSW5wdXRzKSkgdGhpcy5mbG93X0Zsb3dfSW5wdXRzKG9iai5mbG93X0Zsb3dfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X091dHB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19PdXRwdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19PdXRwdXRzKSkgdGhpcy5mbG93X0Zsb3dfT3V0cHV0cyhvYmouZmxvd19GbG93X091dHB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKG9iai5mbG93X0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfTG9naWNzKSkgdGhpcy5mbG93X0Zsb3dfTG9naWNzKG9iai5mbG93X0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouc3ViZmxvd19GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKSkgdGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19BY3Rpb25fSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0FjdGlvbl9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19BY3Rpb25fSW5wdXRzKSkgdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMob2JqLmZsb3dfQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X1NldHRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfU2V0dGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X1NldHRpbmdzKSkgdGhpcy5mbG93X0Zsb3dfU2V0dGluZ3Mob2JqLmZsb3dfRmxvd19TZXR0aW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X1NuYXBzaG90czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X1NuYXBzaG90cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfU25hcHNob3RzKSkgdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKG9iai5mbG93X0Zsb3dfU25hcHNob3RzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSkgdGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvdycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zY2hlbWEgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzY2hlbWEodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NjaGVtYSA9IHY7XG5cdFx0XHR0aGlzLl9zY2hlbWFfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NoZW1hO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnRhYmxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RhYmxlID0gdjtcblx0XHRcdHRoaXMuX3RhYmxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RhYmxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnByb2ZpbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9maWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wcm9maWxlID0gdjtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvZmlsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3N1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3NjaGVtYSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NjaGVtYScgKyAodGhpcy5fc2NoZW1hX2Nvb3AgfHwgJz0nKSArIHRoaXMuc2NoZW1hKCk7XG5cblx0XHRpZiAodGhpcy5fdGFibGUpIHJldCArPSAvKih0aGlzLl90YWJsZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnRhYmxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RhYmxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2ZpbGUpIHJldCArPSAvKih0aGlzLl9wcm9maWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucHJvZmlsZSgpLl90b0VRdWVyeShzUGF0aCArICdwcm9maWxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTdWJzY3JpcHRpb25fVHJpZ2dlci5zdWJzY3JpcHRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHNjaGVtYTogb2JqLmdldFZhbHVlKFwic2NoZW1hXCIpLFxuXG5cdFx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRcdHByb2ZpbGU6IG9iai5nZXRWYWx1ZShcInByb2ZpbGVcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNjaGVtYShTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnNjaGVtYSkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5zY2hlbWEob2JqLnNjaGVtYSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnRhYmxlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvZmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvZmlsZShuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnByb2ZpbGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTYXZlX1N1YnNjcmlwdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNjaGVtYSA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnNjaGVtYSkgPT09ICdvYmplY3QnKSByZXQuc2NoZW1hID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNjaGVtYSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGFibGUgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmIChyZXQudGFibGUpIHtcblx0XHRcdFx0cmV0LnRhYmxlID0gcmV0LnRhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRhYmxlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50YWJsZSkubGVuZ3RoKSByZXQudGFibGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9maWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9maWxlID0gdGhpcy5wcm9maWxlKCk7XG5cblx0XHRcdGlmIChyZXQucHJvZmlsZSkge1xuXHRcdFx0XHRyZXQucHJvZmlsZSA9IHJldC5wcm9maWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2ZpbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2ZpbGUpLmxlbmd0aCkgcmV0LnByb2ZpbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSB0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjaGVtYVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNjaGVtYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY2hlbWEodGhpcy5zY2hlbWEoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0YWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvZmlsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2ZpbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvZmlsZSh0aGlzLnByb2ZpbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2NoZW1hKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2NoZW1hX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3NjaGVtYV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzY2hlbWEnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY2hlbWEnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NjaGVtYScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzY2hlbWEnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90YWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2F2ZSBTdWJzY3JpcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGFibGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcInRhYmxlW3RhYmxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRhYmxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RhYmxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGFibGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RhYmxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2ZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wcm9maWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucHJvZmlsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNhdmUgU3Vic2NyaXB0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInByb2ZpbGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcInByb2ZpbGVbcHJvZmlsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9maWxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2ZpbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9maWxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcm9maWxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Byb2ZpbGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2F2ZSBTdWJzY3JpcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1NhdmVfU3Vic2NyaXB0aW9uJywgWycqJ10pWydTYXZlX1N1YnNjcmlwdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKSB0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuZWxlbWVudE1hcHBpbmcgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbGVtZW50TWFwcGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWxlbWVudE1hcHBpbmcgPSB2O1xuXHRcdFx0dGhpcy5fZWxlbWVudE1hcHBpbmdfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWxlbWVudE1hcHBpbmc7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC50cmFuc2Zvcm0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0cmFuc2Zvcm0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RyYW5zZm9ybSA9IHY7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHJhbnNmb3JtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQucGFyZW50X1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50X1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X1BpbGxfQ29tcG91bmRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRfUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJ1aV9pZFwiLCBcImF0dGFjaGVkX3RvXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkluVnBYMmxrSWl3aVlYUjBZV05vWldSZmRHOGlYWDA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnVpX2lkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdFVJZCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3VpX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLlVJZCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeDdlMTlmZlgwdVNXUStQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmF0dGFjaGVkX3RvIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGF0dGFjaGVkVG8oKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRhY2hlZF90byA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5hdHRhY2hlZFRvKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER3cUtrQWtabHRmWDNSNWNHVWdhVzRnV3lkemVYTmZhSFZpWDJac2IzY25MQ0FuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEoxMGdZVzVrSUh0N2JuSjlmVjB1SkdZdWUzdGZYMzE5TGlSbVd5MHhYUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAncHJlc2NyaXB0aW9uJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3RyYW5zZm9ybV9jb21wb3NpdGlvbnMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdzb3VyY2VfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9lbGVtZW50TWFwcGluZykgcmV0ICs9IC8qKHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZWxlbWVudE1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWxlbWVudE1hcHBpbmcuJyk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybV9kZWZpbml0aW9uX2lkLicpO1xuXG5cdFx0KHRoaXMucGFyZW50X1BpbGxfQ29tcG91bmRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3BpbGxfY29tcG91bmQuc291cmNlX3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdHByZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwicHJlc2NyaXB0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHR0cmFuc2Zvcm1fY29tcG9zaXRpb25zOiBvYmouZ2V0VmFsdWUoXCJ0cmFuc2Zvcm1fY29tcG9zaXRpb25zXCIpLFxuXG5cdFx0XHRcdFx0XHRzb3VyY2VfdWlfaWQ6IG9iai5nZXRWYWx1ZShcInNvdXJjZV91aV9pZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnRNYXBwaW5nOiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50TWFwcGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0dHJhbnNmb3JtX2RlZmluaXRpb25faWQ6IG9iai5nZXRWYWx1ZShcInRyYW5zZm9ybV9kZWZpbml0aW9uX2lkXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJlc2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5wcmVzY3JpcHRpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai50cmFuc2Zvcm1fY29tcG9zaXRpb25zKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zb3VyY2VfdWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLnNvdXJjZV91aV9pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnRNYXBwaW5nKG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai5lbGVtZW50TWFwcGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50cmFuc2Zvcm0obmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQob2JqLnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucGFyZW50X1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUGlsbF9Db21wb3VuZFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnByZXNjcmlwdGlvbiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRyYW5zZm9ybV9jb21wb3NpdGlvbnMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm1fY29tcG9zaXRpb25zKSA9PT0gJ29iamVjdCcpIHJldC50cmFuc2Zvcm1fY29tcG9zaXRpb25zID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zb3VyY2VfdWlfaWQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnNvdXJjZV91aV9pZCkge1xuXHRcdFx0XHRyZXQuc291cmNlX3VpX2lkID0gcmV0LnNvdXJjZV91aV9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zb3VyY2VfdWlfaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNvdXJjZV91aV9pZCkubGVuZ3RoKSByZXQuc291cmNlX3VpX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VsZW1lbnRNYXBwaW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbGVtZW50TWFwcGluZyA9IHRoaXMuZWxlbWVudE1hcHBpbmcoKTtcblxuXHRcdFx0aWYgKHJldC5lbGVtZW50TWFwcGluZykge1xuXHRcdFx0XHRyZXQuZWxlbWVudE1hcHBpbmcgPSByZXQuZWxlbWVudE1hcHBpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZWxlbWVudE1hcHBpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmVsZW1lbnRNYXBwaW5nKS5sZW5ndGgpIHJldC5lbGVtZW50TWFwcGluZyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHJhbnNmb3JtX2RlZmluaXRpb25faWQgPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0XHRpZiAocmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkKSB7XG5cdFx0XHRcdHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCA9IHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHJhbnNmb3JtX2RlZmluaXRpb25faWQpLmxlbmd0aCkgcmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50X1BpbGxfQ29tcG91bmRzID0gdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnVpX2lkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnVpX2lkID0gdGhpcy51aV9pZCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dGFjaGVkX3RvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dGFjaGVkX3RvID0gdGhpcy5hdHRhY2hlZF90bygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcmVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHJhbnNmb3JtX2NvbXBvc2l0aW9uc1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzb3VyY2VfdWlfaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudE1hcHBpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbGVtZW50TWFwcGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbGVtZW50TWFwcGluZyh0aGlzLmVsZW1lbnRNYXBwaW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRyYW5zZm9ybV9kZWZpbml0aW9uX2lkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHJhbnNmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybSh0aGlzLnRyYW5zZm9ybSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcmVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3ByZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ByZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RyYW5zZm9ybV9jb21wb3NpdGlvbnMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RyYW5zZm9ybV9jb21wb3NpdGlvbnMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RyYW5zZm9ybV9jb21wb3NpdGlvbnMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHJhbnNmb3JtX2NvbXBvc2l0aW9ucycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wYXJlbnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wYXJlbnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQaWxsIENvbXBvdW5kXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwicGFyZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcInBhcmVudFtzb3VyY2VfdWlfaWRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucGFyZW50KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NvdXJjZV91aV9pZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc291cmNlX3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzb3VyY2VfdWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc291cmNlX3VpX2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbGVtZW50TWFwcGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVsZW1lbnRNYXBwaW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcImVsZW1lbnRNYXBwaW5nIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImVsZW1lbnRNYXBwaW5nW2VsZW1lbnRNYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVsZW1lbnRNYXBwaW5nKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VsZW1lbnRtYXBwaW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50bWFwcGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudG1hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudG1hcHBpbmcnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHJhbnNmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRyYW5zZm9ybSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiICsgXCJ0cmFuc2Zvcm1bdHJhbnNmb3JtX2RlZmluaXRpb25faWRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudHJhbnNmb3JtKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RyYW5zZm9ybV9kZWZpbml0aW9uX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHJhbnNmb3JtX2RlZmluaXRpb25faWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHJhbnNmb3JtX2RlZmluaXRpb25faWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcsIFsnKiddKVsnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kcykpIHRoaXMucGFyZW50X1BpbGxfQ29tcG91bmRzKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcsIFsnKiddKVsnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5vcGVyYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcGVyYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29wZXJhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9vcGVyYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3BlcmF0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5zZWN1cml0eUNvbnRyb2xfRmxvd3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzZWN1cml0eUNvbnRyb2xfRmxvd3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2xfRmxvd3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2xfRmxvd3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlY3VyaXR5Q29udHJvbF9GbG93cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbmRpdGlvbicgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdkZXNjcmlwdGlvbicgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHRpZiAodGhpcy5fb3BlcmF0aW9uKSByZXQgKz0gLyoodGhpcy5fb3BlcmF0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMub3BlcmF0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ29wZXJhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3cuYWNscyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRjb25kaXRpb246IG9iai5nZXRWYWx1ZShcImNvbmRpdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0ZGVzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcImRlc2NyaXB0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcGVyYXRpb246IG9iai5nZXRWYWx1ZShcIm9wZXJhdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb25kaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmNvbmRpdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmRlc2NyaXB0aW9uKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouZGVzY3JpcHRpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcGVyYXRpb24obmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLm9wZXJhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdXJpdHlfQ29udHJvbFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbmRpdGlvbiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LmRlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmRlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHJldC50eXBlKSB7XG5cdFx0XHRcdHJldC50eXBlID0gcmV0LnR5cGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQudHlwZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHlwZSkubGVuZ3RoKSByZXQudHlwZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29wZXJhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3BlcmF0aW9uID0gdGhpcy5vcGVyYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5vcGVyYXRpb24pIHtcblx0XHRcdFx0cmV0Lm9wZXJhdGlvbiA9IHJldC5vcGVyYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQub3BlcmF0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5vcGVyYXRpb24pLmxlbmd0aCkgcmV0Lm9wZXJhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZWN1cml0eUNvbnRyb2xfRmxvd3MgPSB0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMub3BlcmF0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9wZXJhdGlvbih0aGlzLm9wZXJhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29uZGl0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2NyaXB0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9wZXJhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9wZXJhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcGVyYXRpb24odGhpcy5vcGVyYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X2FjbCcsIFsnKiddKVsnc3lzX3NlY3VyaXR5X2FjbCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NlY3VyaXR5X2FjbCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb25kaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbmRpdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29uZGl0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbmRpdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVzY3JpcHRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgQ29udHJvbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInR5cGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIiArIFwidHlwZVt0eXBlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29wZXJhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29wZXJhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9wZXJhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNlY3VyaXR5IENvbnRyb2xcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJvcGVyYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIiArIFwib3BlcmF0aW9uW29wZXJhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5vcGVyYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3BlcmF0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcGVyYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29wZXJhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcGVyYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgQ29udHJvbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zZWN1cml0eV9hY2wnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X2FjbCcsIFsnKiddKVsnc3lzX3NlY3VyaXR5X2FjbCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIm9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNlY3VyaXR5Q29udHJvbF9GbG93cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpKSB0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cyhvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zZWN1cml0eV9hY2wnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X2FjbCcsIFsnKiddKVsnc3lzX3NlY3VyaXR5X2FjbCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1RlYW1fTWVtYmVyIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJuYW1lIjoic2hzX2FyYmZ3X1RlYW1fTWVtYmVyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19UZWFtX01lbWJlclwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnRlYW0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90ZWFtID0gdjtcblx0XHRcdHRoaXMuX3RlYW1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5tZW1iZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lbWJlciA9IHY7XG5cdFx0XHR0aGlzLl9tZW1iZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnJvbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yb2xlID0gdjtcblx0XHRcdHRoaXMuX3JvbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZTtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90ZWFtKSByZXQgKz0gLyoodGhpcy5fdGVhbV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnRlYW0oKS5fdG9FUXVlcnkoc1BhdGggKyAndGVhbS4nKTtcblxuXHRcdGlmICh0aGlzLl9tZW1iZXIpIHJldCArPSAvKih0aGlzLl9tZW1iZXJfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZW1iZXIoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWVtYmVyLicpO1xuXG5cdFx0aWYgKHRoaXMuX3JvbGUpIHJldCArPSAvKih0aGlzLl9yb2xlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucm9sZSgpLl90b0VRdWVyeShzUGF0aCArICdyb2xlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0ZWFtOiBvYmouZ2V0VmFsdWUoXCJ0ZWFtXCIpLFxuXG5cdFx0XHRcdFx0XHRtZW1iZXI6IG9iai5nZXRWYWx1ZShcIm1lbWJlclwiKSxcblxuXHRcdFx0XHRcdFx0cm9sZTogb2JqLmdldFZhbHVlKFwicm9sZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRlYW0obmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVtYmVyKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJvbGUobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUZWFtX01lbWJlclwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50ZWFtID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmIChyZXQudGVhbSkge1xuXHRcdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRlYW0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRlYW0pLmxlbmd0aCkgcmV0LnRlYW0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1lbWJlciA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmIChyZXQubWVtYmVyKSB7XG5cdFx0XHRcdHJldC5tZW1iZXIgPSByZXQubWVtYmVyLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lbWJlcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWVtYmVyKS5sZW5ndGgpIHJldC5tZW1iZXIgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yb2xlID0gdGhpcy5yb2xlKCk7XG5cblx0XHRcdGlmIChyZXQucm9sZSkge1xuXHRcdFx0XHRyZXQucm9sZSA9IHJldC5yb2xlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJvbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJvbGUpLmxlbmd0aCkgcmV0LnJvbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGVhbVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRlYW0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbSh0aGlzLnRlYW0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWVtYmVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVtYmVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcih0aGlzLm1lbWJlcigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyb2xlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucm9sZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yb2xlKHRoaXMucm9sZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RlYW1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwidGVhbVt0ZWFtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRlYW0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RlYW0nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RlYW0nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGVhbScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tZW1iZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUZWFtIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIgKyBcIm1lbWJlclttZW1iZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVtYmVyKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lbWJlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lbWJlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21lbWJlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcm9sZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUZWFtIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJyb2xlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJyb2xlW3JvbGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucm9sZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyb2xlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyb2xlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0NvbHVtbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQ29sdW1uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0NvbHVtbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0NvbHVtbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0NvbHVtblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4udHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi50YWJsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90YWJsZSA9IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uY29sdW1uX0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbl9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jb2x1bW5fRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fY29sdW1uX0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uX0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm5hbWVcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p1WVcxbElsMTlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZGlzcGxheSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkaXNwbGF5KCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfZGlzcGxheSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gdHlwZW9mKHRoaXMudGFibGUoKSkgPT09IFwib2JqZWN0XCIgJiYgdGhpcy50YWJsZSgpLnRhYmxlX0NvbHVtbnMoKS5maW5kKGMgPT4gYy50eXBlKCkgPT0gJ1N0cmluZycpID09IHRoaXM7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5kaXNwbGF5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdkSGx3Wlc5bUtIUm9hWE11ZEdGaWJHVW9LU2tnUFQwOUlGd2liMkpxWldOMFhDSWdKaVlnZEdocGN5NTBZV0pzWlNncExuUmhZbXhsWDBOdmJIVnRibk1vS1M1bWFXNWtLR01nUFQ0Z1l5NTBlWEJsS0NrZ1BUMGdKMU4wY21sdVp5Y3BJRDA5SUhSb2FYTWlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbHVtbl9sYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdjb21tZW50cycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl90YWJsZSkgcmV0ICs9IC8qKHRoaXMuX3RhYmxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGFibGUoKS5fdG9FUXVlcnkoc1BhdGggKyAnbmFtZS4nKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0KHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU3Vic2NyaXB0aW9uX1RyaWdnZXIuY29sdW1uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZG9jdW1lbnRhdGlvbi5jb2x1bW4sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0Y29sdW1uX2xhYmVsOiBvYmouZ2V0VmFsdWUoXCJjb2x1bW5fbGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGNvbW1lbnRzOiBvYmouZ2V0VmFsdWUoXCJjb21tZW50c1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW5fbGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmNvbHVtbl9sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29tbWVudHMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmNvbW1lbnRzKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouY29tbWVudHMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLm5hbWUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyhuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY29sdW1uX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ29sdW1uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbHVtbl9sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnRzID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuY29tbWVudHMpID09PSAnb2JqZWN0JykgcmV0LmNvbW1lbnRzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnRzKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmludGVybmFsX3R5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMudGFibGUoKTtcblxuXHRcdFx0aWYgKHJldC5uYW1lKSB7XG5cdFx0XHRcdHJldC5uYW1lID0gcmV0Lm5hbWUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubmFtZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubmFtZSkubGVuZ3RoKSByZXQubmFtZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzID0gdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbl9GaWVsZF9MYWJlbHMgPSB0aGlzLmNvbHVtbl9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRpc3BsYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlzcGxheSA9IHRoaXMuZGlzcGxheSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2x1bW5fbGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudHNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RpY3Rpb25hcnknLCBbJyonXSlbJ3N5c19kaWN0aW9uYXJ5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGljdGlvbmFyeScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uX2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbHVtbl9sYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29sdW1uX2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbl9sYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbW1lbnRzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbW1lbnRzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb21tZW50cycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50cycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90YWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0YWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIgKyBcInRhYmxlW25hbWVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGFibGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGljdGlvbmFyeScsIFsnKiddKVsnc3lzX2RpY3Rpb25hcnknXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSkgdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJvYmouY29sdW1uX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY29sdW1uX0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSkgdGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKG9iai5jb2x1bW5fRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJuYW1lIjoic2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmRlc2lnbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlc2lnbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVzaWduID0gdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmVkaXRvciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVkaXRvcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWRpdG9yID0gdjtcblx0XHRcdHRoaXMuX2VkaXRvcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZGl0b3I7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVzaWduKSByZXQgKz0gLyoodGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVzaWduKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Rlc2lnbi4nKTtcblxuXHRcdGlmICh0aGlzLl9lZGl0b3IpIHJldCArPSAvKih0aGlzLl9lZGl0b3JfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lZGl0b3IoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWRpdG9yLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNpZ246IG9iai5nZXRWYWx1ZShcImRlc2lnblwiKSxcblxuXHRcdFx0XHRcdFx0ZWRpdG9yOiBvYmouZ2V0VmFsdWUoXCJlZGl0b3JcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZXNpZ24obmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZGl0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVkaXRvcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5lZGl0b3IpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVmVyc2lvbl9IaXN0b3J5XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZXNpZ24gPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlc2lnbikge1xuXHRcdFx0XHRyZXQuZGVzaWduID0gcmV0LmRlc2lnbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZXNpZ24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlc2lnbikubGVuZ3RoKSByZXQuZGVzaWduID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWRpdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lZGl0b3IgPSB0aGlzLmVkaXRvcigpO1xuXG5cdFx0XHRpZiAocmV0LmVkaXRvcikge1xuXHRcdFx0XHRyZXQuZWRpdG9yID0gcmV0LmVkaXRvci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5lZGl0b3IpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmVkaXRvcikubGVuZ3RoKSByZXQuZWRpdG9yID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNpZ25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZXNpZ24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduKHRoaXMuZGVzaWduKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVkaXRvclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVkaXRvcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZGl0b3IodGhpcy5lZGl0b3IoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZXNpZ25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWZXJzaW9uIEhpc3RvcnlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcImRlc2lnbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIgKyBcImRlc2lnbltkZXNpZ25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVzaWduKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2lnbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWRpdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZWRpdG9yX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZWRpdG9yKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmVyc2lvbiBIaXN0b3J5XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJlZGl0b3IgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiICsgXCJlZGl0b3JbZWRpdG9yXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVkaXRvcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlZGl0b3InKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWRpdG9yJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlZGl0b3InKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWRpdG9yJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5kZXNpZ24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Rlc2lnbiA9IHY7XG5cdFx0XHR0aGlzLl9kZXNpZ25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVzaWduO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24udHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Rlc2lnbikgcmV0ICs9IC8qKHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlc2lnbigpLl90b0VRdWVyeShzUGF0aCArICdkZXNpZ24uJyk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRlc2lnbjogb2JqLmdldFZhbHVlKFwiZGVzaWduXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUobmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX1NlY3Rpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVzaWduID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdFx0aWYgKHJldC5kZXNpZ24pIHtcblx0XHRcdFx0cmV0LmRlc2lnbiA9IHJldC5kZXNpZ24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzaWduKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZXNpZ24pLmxlbmd0aCkgcmV0LmRlc2lnbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHJldC50eXBlKSB7XG5cdFx0XHRcdHJldC50eXBlID0gcmV0LnR5cGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQudHlwZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHlwZSkubGVuZ3RoKSByZXQudHlwZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2lnblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlc2lnbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ24odGhpcy5kZXNpZ24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gU2VjdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcImRlc2lnbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiICsgXCJkZXNpZ25bZGVzaWduXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlc2lnbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNpZ24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVzaWduJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2lnbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTZWN0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidHlwZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiICsgXCJ0eXBlW3R5cGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudHlwZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyIsIm5hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yYWdlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmFnZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RvcmFnZSA9IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2U7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHRpZiAodGhpcy5fc3RvcmFnZSkgcmV0ICs9IC8qKHRoaXMuX3N0b3JhZ2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zdG9yYWdlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N0b3JhZ2UuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHR5cGU6IG9iai5nZXRWYWx1ZShcInR5cGVcIiksXG5cblx0XHRcdFx0XHRcdHN0b3JhZ2U6IG9iai5nZXRWYWx1ZShcInN0b3JhZ2VcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdG9yYWdlKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQob2JqLnN0b3JhZ2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAocmV0LnR5cGUpIHtcblx0XHRcdFx0cmV0LnR5cGUgPSByZXQudHlwZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50eXBlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50eXBlKS5sZW5ndGgpIHJldC50eXBlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RvcmFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RvcmFnZSA9IHRoaXMuc3RvcmFnZSgpO1xuXG5cdFx0XHRpZiAocmV0LnN0b3JhZ2UpIHtcblx0XHRcdFx0cmV0LnN0b3JhZ2UgPSByZXQuc3RvcmFnZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zdG9yYWdlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zdG9yYWdlKS5sZW5ndGgpIHJldC5zdG9yYWdlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdG9yYWdlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RvcmFnZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdG9yYWdlKHRoaXMuc3RvcmFnZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNvbHV0aW9uIFN0b3JhZ2UgTWFwcGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidHlwZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIgKyBcInR5cGVbdHlwZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50eXBlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0b3JhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdG9yYWdlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RvcmFnZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNvbHV0aW9uIFN0b3JhZ2UgTWFwcGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwic3RvcmFnZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIgKyBcInN0b3JhZ2Vbc3RvcmFnZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zdG9yYWdlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0b3JhZ2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3RvcmFnZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RvcmFnZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdG9yYWdlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfQm9hcmRfTWVtYmVyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0JvYXJkX01lbWJlciBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRfTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuc3RhcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RhcnQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydCA9IHY7XG5cdFx0XHR0aGlzLl9zdGFydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdGFydDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZW5kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm1lbWJlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVtYmVyID0gdjtcblx0XHRcdHRoaXMuX21lbWJlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXI7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc3RhcnQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydCcgKyAodGhpcy5fc3RhcnRfY29vcCB8fCAnPScpICsgdGhpcy5zdGFydCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZCcgKyAodGhpcy5fZW5kX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kKCk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX21lbWJlcikgcmV0ICs9IC8qKHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lbWJlcigpLl90b0VRdWVyeShzUGF0aCArICdtZW1iZXIuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHN0YXJ0OiBvYmouZ2V0VmFsdWUoXCJzdGFydFwiKSxcblxuXHRcdFx0XHRcdFx0ZW5kOiBvYmouZ2V0VmFsdWUoXCJlbmRcIiksXG5cblx0XHRcdFx0XHRcdGJvYXJkOiBvYmouZ2V0VmFsdWUoXCJib2FyZFwiKSxcblxuXHRcdFx0XHRcdFx0bWVtYmVyOiBvYmouZ2V0VmFsdWUoXCJtZW1iZXJcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXJ0KG9iai5zdGFydCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmQob2JqLmVuZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVtYmVyKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJCb2FyZF9NZW1iZXJcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RhcnQgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRcdGlmIChyZXQuc3RhcnQgJiYgdHlwZW9mKHJldC5zdGFydC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydCA9IHJldC5zdGFydC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmQgPSB0aGlzLmVuZCgpO1xuXG5cdFx0XHRpZiAocmV0LmVuZCAmJiB0eXBlb2YocmV0LmVuZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmQgPSByZXQuZW5kLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYm9hcmQgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRcdGlmIChyZXQuYm9hcmQpIHtcblx0XHRcdFx0cmV0LmJvYXJkID0gcmV0LmJvYXJkLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJvYXJkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ib2FyZCkubGVuZ3RoKSByZXQuYm9hcmQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1lbWJlciA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmIChyZXQubWVtYmVyKSB7XG5cdFx0XHRcdHJldC5tZW1iZXIgPSByZXQubWVtYmVyLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lbWJlcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWVtYmVyKS5sZW5ndGgpIHJldC5tZW1iZXIgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXJ0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RhcnQodGhpcy5zdGFydCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmQodGhpcy5lbmQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJib2FyZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJvYXJkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJvYXJkKHRoaXMuYm9hcmQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWVtYmVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVtYmVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcih0aGlzLm1lbWJlcigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3RhcnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5kX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9ib2FyZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQm9hcmQgTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJib2FyZCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIgKyBcImJvYXJkW2JvYXJkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJvYXJkKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2JvYXJkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2JvYXJkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdib2FyZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdib2FyZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tZW1iZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJCb2FyZCBNZW1iZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcIm1lbWJlciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIgKyBcIm1lbWJlclttZW1iZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVtYmVyKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lbWJlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lbWJlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZW1iZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHRpZiAoX29iai5zdGFydCAmJiB0eXBlb2YoX29iai5zdGFydC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouc3RhcnQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLnN0YXJ0KTtcblxuXHRcdFx0aWYgKF9vYmouZW5kICYmIHR5cGVvZihfb2JqLmVuZC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZW5kID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5lbmQpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfQ2FwYWJpbGl0eSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJuYW1lIjoic2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfQ2FwYWJpbGl0eSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQ2FwYWJpbGl0eVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5Lm1vZHVsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZHVsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9kdWxlID0gdjtcblx0XHRcdHRoaXMuX21vZHVsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2R1bGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY2FwYWJpbGl0eV9SZXF1aXJlbWVudHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbW9kdWxlKSByZXQgKz0gLyoodGhpcy5fbW9kdWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubW9kdWxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21vZHVsZS4nKTtcblxuXHRcdCh0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudC5jYXBhYmlsaXR5LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdG1vZHVsZTogb2JqLmdldFZhbHVlKFwibW9kdWxlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vZHVsZShuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ2FwYWJpbGl0eVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kdWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb2R1bGUgPSB0aGlzLm1vZHVsZSgpO1xuXG5cdFx0XHRpZiAocmV0Lm1vZHVsZSkge1xuXHRcdFx0XHRyZXQubW9kdWxlID0gcmV0Lm1vZHVsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tb2R1bGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1vZHVsZSkubGVuZ3RoKSByZXQubW9kdWxlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyA9IHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb2R1bGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb2R1bGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kdWxlKHRoaXMubW9kdWxlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vZHVsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vZHVsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vZHVsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkNhcGFiaWxpdHlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJtb2R1bGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIiArIFwibW9kdWxlW21vZHVsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2R1bGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9kdWxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb2R1bGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vZHVsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2R1bGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKSkgdGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyhvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Qcm9qZWN0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfUHJvamVjdCIsIm5hbWUiOiJzaHNfYXJiZndfUHJvamVjdCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Qcm9qZWN0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Qcm9qZWN0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QudGVhbSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RlYW0gPSB2O1xuXHRcdFx0dGhpcy5fdGVhbV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYnVkZ2V0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YnVkZ2V0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9idWRnZXQgPSB2O1xuXHRcdFx0dGhpcy5fYnVkZ2V0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdF9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9qZWN0X01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcHJvamVjdF9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3RfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdGVhbSkgcmV0ICs9IC8qKHRoaXMuX3RlYW1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50ZWFtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RlYW0uJyk7XG5cblx0XHRpZiAodGhpcy5fYnVkZ2V0KSByZXQgKz0gLyoodGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYnVkZ2V0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2J1ZGdldC4nKTtcblxuXHRcdCh0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudC5wcm9qZWN0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wcm9qZWN0X01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nLnByb2plY3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJhY3R1YWxDb3N0XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuYWN0dWFsQ29zdChwYXlsb2FkW1widGlsbERhdGVcIl0sICk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dGVhbTogb2JqLmdldFZhbHVlKFwidGVhbVwiKSxcblxuXHRcdFx0XHRcdFx0YnVkZ2V0OiBvYmouZ2V0VmFsdWUoXCJidWRnZXRcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRlYW0obmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJ1ZGdldCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYnVkZ2V0KG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cyhuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3RfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X01lZXRpbmdzKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3RfTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQcm9qZWN0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50ZWFtID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmIChyZXQudGVhbSkge1xuXHRcdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRlYW0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRlYW0pLmxlbmd0aCkgcmV0LnRlYW0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9idWRnZXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJ1ZGdldCA9IHRoaXMuYnVkZ2V0KCk7XG5cblx0XHRcdGlmIChyZXQuYnVkZ2V0KSB7XG5cdFx0XHRcdHJldC5idWRnZXQgPSByZXQuYnVkZ2V0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJ1ZGdldCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYnVkZ2V0KS5sZW5ndGgpIHJldC5idWRnZXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3RfUmVxdWlyZW1lbnRzID0gdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucHJvamVjdF9NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0X01lZXRpbmdzID0gdGhpcy5wcm9qZWN0X01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUHJvamVjdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGVhbVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRlYW0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbSh0aGlzLnRlYW0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYnVkZ2V0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYnVkZ2V0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJ1ZGdldCh0aGlzLmJ1ZGdldCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGVhbV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRlYW0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQcm9qZWN0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiICsgXCJ0ZWFtW3RlYW1dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGVhbSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0ZWFtJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYnVkZ2V0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUHJvamVjdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcImJ1ZGdldCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiICsgXCJidWRnZXRbYnVkZ2V0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJ1ZGdldCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdidWRnZXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2J1ZGdldCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYnVkZ2V0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2J1ZGdldCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIm9iai5wcm9qZWN0X1JlcXVpcmVtZW50czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKSB0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKG9iai5wcm9qZWN0X1JlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJvYmoucHJvamVjdF9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvamVjdF9NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wcm9qZWN0X01lZXRpbmdzKSkgdGhpcy5wcm9qZWN0X01lZXRpbmdzKG9iai5wcm9qZWN0X01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYWN0dWFsQ29zdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdHVhbENvc3QoX19ldmVudCwgdGlsbERhdGUpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi50aWxsRGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRpbGxEYXRlID0gZXZKU09OLnRpbGxEYXRlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmFjdHVhbENvc3QoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gZXZKU09OO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5nZXRQYXJhbWV0ZXIpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZih0aWxsRGF0ZSkgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcigndGlsbERhdGUnKSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRpbGxEYXRlID0gdGhpcy5nZXRQYXJhbWV0ZXIoJ3RpbGxEYXRlJyk7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuc2NyaXB0RmlsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjcmlwdEZpbGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NjcmlwdEZpbGUgPSB2O1xuXHRcdFx0dGhpcy5fc2NyaXB0RmlsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zY3JpcHRGaWxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnRhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3lzX3NjcmlwdF9pbmNsdWRlXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnRhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNselgzTmpjbWx3ZEY5cGJtTnNkV1JsSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3VzZV9lc19sYXRlc3QnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc2NyaXB0RmlsZSkgcmV0ICs9IC8qKHRoaXMuX3NjcmlwdEZpbGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zY3JpcHRGaWxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2lkLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0dXNlX2VzX2xhdGVzdDogb2JqLmdldFZhbHVlKFwidXNlX2VzX2xhdGVzdFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0aWQ6IG9iai5nZXRWYWx1ZShcImlkXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnVzZV9lc19sYXRlc3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLnVzZV9lc19sYXRlc3QpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2NyaXB0RmlsZShuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KG9iai5pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTY3JpcHRfQ29tcGF0aWJpbGl0eVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudXNlX2VzX2xhdGVzdCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY3JpcHRGaWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pZCA9IHRoaXMuc2NyaXB0RmlsZSgpO1xuXG5cdFx0XHRpZiAocmV0LmlkKSB7XG5cdFx0XHRcdHJldC5pZCA9IHJldC5pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaWQpLmxlbmd0aCkgcmV0LmlkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy50YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50YWJsZSA9IHRoaXMudGFibGUoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc2NyaXB0RmlsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY3JpcHRGaWxlKHRoaXMuc2NyaXB0RmlsZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInVzZV9lc19sYXRlc3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2NyaXB0RmlsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY3JpcHRGaWxlKHRoaXMuc2NyaXB0RmlsZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZXNfbGF0ZXN0X3NjcmlwdCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3VzZV9lc19sYXRlc3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd1c2VfZXNfbGF0ZXN0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd1c2VfZXNfbGF0ZXN0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3VzZV9lc19sYXRlc3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2NyaXB0RmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NjcmlwdEZpbGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zY3JpcHRGaWxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2NyaXB0IENvbXBhdGliaWxpdHlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwic2NyaXB0RmlsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIiArIFwic2NyaXB0RmlsZVtpZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zY3JpcHRGaWxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lc19sYXRlc3Rfc2NyaXB0JywgWycqJ10pWydzeXNfZXNfbGF0ZXN0X3NjcmlwdCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZXNfbGF0ZXN0X3NjcmlwdCcsIFsnKiddKVsnc3lzX2VzX2xhdGVzdF9zY3JpcHQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lc19sYXRlc3Rfc2NyaXB0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lc19sYXRlc3Rfc2NyaXB0JywgWycqJ10pWydzeXNfZXNfbGF0ZXN0X3NjcmlwdCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX1N0ZXBcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIFN0ZXBcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfc3RlcF9pbnN0YW5jZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9TdGVwX0lucHV0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb24odGhpcy5hY3Rpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBTdGVwIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnLCBbJyonXSlbJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4IiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXhcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXgucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5kZXNpZ24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Rlc2lnbiA9IHY7XG5cdFx0XHR0aGlzLl9kZXNpZ25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVzaWduO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Rlc2lnbikgcmV0ICs9IC8qKHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlc2lnbigpLl90b0VRdWVyeShzUGF0aCArICdkZXNpZ24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRlc2lnbjogb2JqLmdldFZhbHVlKFwiZGVzaWduXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZXNpZ24obmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fQXBwZW5kaXhcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZXNpZ24gPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlc2lnbikge1xuXHRcdFx0XHRyZXQuZGVzaWduID0gcmV0LmRlc2lnbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZXNpZ24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlc2lnbikubGVuZ3RoKSByZXQuZGVzaWduID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2lnblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlc2lnbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ24odGhpcy5kZXNpZ24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNvbHV0aW9uIEFwcGVuZGl4XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcImRlc2lnbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzaWduJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVzaWduJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVzaWduJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIiwibmFtZSI6InNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19EZWNpc2lvbl9PcHRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5kZWNpc2lvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWNpc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZWNpc2lvbikgcmV0ICs9IC8qKHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVjaXNpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVjaXNpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRlY2lzaW9uOiBvYmouZ2V0VmFsdWUoXCJkZWNpc2lvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGVjaXNpb24obmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRlY2lzaW9uX09wdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZWNpc2lvbiA9IHRoaXMuZGVjaXNpb24oKTtcblxuXHRcdFx0aWYgKHJldC5kZWNpc2lvbikge1xuXHRcdFx0XHRyZXQuZGVjaXNpb24gPSByZXQuZGVjaXNpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZGVjaXNpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlY2lzaW9uKS5sZW5ndGgpIHJldC5kZWNpc2lvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uKHRoaXMuZGVjaXNpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWNpc2lvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlY2lzaW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uKHRoaXMuZGVjaXNpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVjaXNpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJEZWNpc2lvbiBPcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcImRlY2lzaW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIiArIFwiZGVjaXNpb25bZGVjaXNpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVjaXNpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVjaXNpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlY2lzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfTWVldGluZ19TZXJpZXMiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX1Nlcmllc1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZyZXF1ZW5jeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZnJlcXVlbmN5ID0gdjtcblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcmVxdWVuY3k7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc2VyaWVzX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VyaWVzX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zZXJpZXNfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZnJlcXVlbmN5KSByZXQgKz0gLyoodGhpcy5fZnJlcXVlbmN5X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZnJlcXVlbmN5KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2ZyZXF1ZW5jeS4nKTtcblxuXHRcdCh0aGlzLnNlcmllc19NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZy5zZXJpZXMsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZnJlcXVlbmN5OiBvYmouZ2V0VmFsdWUoXCJmcmVxdWVuY3lcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mcmVxdWVuY3kpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZyZXF1ZW5jeShuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQob2JqLmZyZXF1ZW5jeSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNlcmllc19NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNlcmllc19NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5zZXJpZXNfTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nX1Nlcmllc1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mcmVxdWVuY3kpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZyZXF1ZW5jeSA9IHRoaXMuZnJlcXVlbmN5KCk7XG5cblx0XHRcdGlmIChyZXQuZnJlcXVlbmN5KSB7XG5cdFx0XHRcdHJldC5mcmVxdWVuY3kgPSByZXQuZnJlcXVlbmN5Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZyZXF1ZW5jeSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZnJlcXVlbmN5KS5sZW5ndGgpIHJldC5mcmVxdWVuY3kgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNlcmllc19NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZXJpZXNfTWVldGluZ3MgPSB0aGlzLnNlcmllc19NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmcmVxdWVuY3lcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mcmVxdWVuY3koKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZnJlcXVlbmN5KHRoaXMuZnJlcXVlbmN5KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mcmVxdWVuY3kpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mcmVxdWVuY3lfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mcmVxdWVuY3koKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nIFNlcmllc1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJmcmVxdWVuY3kgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIgKyBcImZyZXF1ZW5jeVtmcmVxdWVuY3ldIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZnJlcXVlbmN5KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ZyZXF1ZW5jeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ZyZXF1ZW5jeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZnJlcXVlbmN5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ZyZXF1ZW5jeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwib2JqLnNlcmllc19NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc2VyaWVzX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNlcmllc19NZWV0aW5ncykpIHRoaXMuc2VyaWVzX01lZXRpbmdzKG9iai5zZXJpZXNfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01vZHVsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X01vZHVsZSIsIm5hbWUiOiJzaHNfYXJiZndfTW9kdWxlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01vZHVsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTW9kdWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucGxhdGZvcm0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbGF0Zm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGxhdGZvcm0gPSB2O1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGxhdGZvcm07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm1vZHVsZV9DYXBhYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZHVsZV9DYXBhYmlsaXR5cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kdWxlX0NhcGFiaWxpdHlzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BsYXRmb3JtKSByZXQgKz0gLyoodGhpcy5fcGxhdGZvcm1fY29vcCB8fCAnPScpICsgKi8gdGhpcy5wbGF0Zm9ybSgpLl90b0VRdWVyeShzUGF0aCArICdwbGF0Zm9ybS4nKTtcblxuXHRcdCh0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eS5tb2R1bGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cGxhdGZvcm06IG9iai5nZXRWYWx1ZShcInBsYXRmb3JtXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYXRmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wbGF0Zm9ybShuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvYmoucGxhdGZvcm0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMobmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmoubW9kdWxlX0NhcGFiaWxpdHlzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTW9kdWxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGxhdGZvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBsYXRmb3JtID0gdGhpcy5wbGF0Zm9ybSgpO1xuXG5cdFx0XHRpZiAocmV0LnBsYXRmb3JtKSB7XG5cdFx0XHRcdHJldC5wbGF0Zm9ybSA9IHJldC5wbGF0Zm9ybS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wbGF0Zm9ybSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucGxhdGZvcm0pLmxlbmd0aCkgcmV0LnBsYXRmb3JtID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kdWxlX0NhcGFiaWxpdHlzID0gdGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Nb2R1bGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBsYXRmb3JtXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGxhdGZvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGxhdGZvcm0odGhpcy5wbGF0Zm9ybSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsYXRmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGxhdGZvcm1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wbGF0Zm9ybSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1vZHVsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwicGxhdGZvcm0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiICsgXCJwbGF0Zm9ybVtwbGF0Zm9ybV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wbGF0Zm9ybSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwbGF0Zm9ybScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbGF0Zm9ybScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGxhdGZvcm0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwib2JqLm1vZHVsZV9DYXBhYmlsaXR5czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubW9kdWxlX0NhcGFiaWxpdHlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ19fZW5jb2RlZFF1ZXJ5JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRfX2VuY29kZWRRdWVyeTogb2JqLmdldFZhbHVlKFwiX19lbmNvZGVkUXVlcnlcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouX19lbmNvZGVkUXVlcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLl9fZW5jb2RlZFF1ZXJ5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUm9sbGJhY2tfQ29udGV4dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuX19lbmNvZGVkUXVlcnkgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJfX2VuY29kZWRRdWVyeVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19yb2xsYmFja19jb250ZXh0JywgWycqJ10pWydzeXNfcm9sbGJhY2tfY29udGV4dCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3JvbGxiYWNrX2NvbnRleHQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdfX2VuY29kZWRxdWVyeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnX19lbmNvZGVkcXVlcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ19fZW5jb2RlZHF1ZXJ5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ19fZW5jb2RlZHF1ZXJ5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlJvbGxiYWNrIENvbnRleHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19yb2xsYmFja19jb250ZXh0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19yb2xsYmFja19jb250ZXh0JywgWycqJ10pWydzeXNfcm9sbGJhY2tfY29udGV4dCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3JvbGxiYWNrX2NvbnRleHQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYXBpX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NjcmlwdCcgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdCh0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZXNfbGF0ZXN0X3NjcmlwdC5pZCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0YXBpX25hbWU6IG9iai5nZXRWYWx1ZShcImFwaV9uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHNjcmlwdDogb2JqLmdldFZhbHVlKFwic2NyaXB0XCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcGlfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouYXBpX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouc2NyaXB0KSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouc2NyaXB0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTY3JpcHRfRmlsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcGlfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zY3JpcHQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5zY3JpcHQpID09PSAnb2JqZWN0JykgcmV0LnNjcmlwdCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zY3JpcHQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMgPSB0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcGlfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NyaXB0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwaV9uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBpX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwaV9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwaV9uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NjcmlwdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NjcmlwdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2NyaXB0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NjcmlwdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTY3JpcHQgRmlsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2luY2x1ZGUnLCBbJyonXSlbJ3N5c19zY3JpcHRfaW5jbHVkZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9pbmNsdWRlJywgWycqJ10pWydzeXNfc2NyaXB0X2luY2x1ZGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKSkgdGhpcy5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyhvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9pbmNsdWRlJywgWycqJ10pWydzeXNfc2NyaXB0X2luY2x1ZGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzY3JpcHQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRzY3JpcHQ6IG9iai5nZXRWYWx1ZShcInNjcmlwdFwiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY3JpcHQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnNjcmlwdCkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnNjcmlwdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZpeF9TY3JpcHRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNjcmlwdCA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnNjcmlwdCkgPT09ICdvYmplY3QnKSByZXQuc2NyaXB0ID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNjcmlwdCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjcmlwdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NjcmlwdF9maXgnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NjcmlwdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2NyaXB0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY3JpcHQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2NyaXB0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpeCBTY3JpcHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2NyaXB0X2ZpeCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2ZpeCcsIFsnKiddKVsnc3lzX3NjcmlwdF9maXgnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHRfZml4Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UYWJsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVGFibGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVGFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9UYWJsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1RhYmxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS50YWJsZV9Db2x1bW5zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGVfQ29sdW1ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RhYmxlX0NvbHVtbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9Db2x1bW5zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZV9Db2x1bW5zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9Db2x1bW5zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0NvbHVtbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQ29sdW1ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9Db2x1bW5zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfQ29sdW1ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19PdXRwdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X091dHB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuc3VwZXJfY2xhc3MgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZXh0ZW5kcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3N1cGVyX2NsYXNzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoX3RoaXMpID0+IF90aGlzLl9tYXAoJ2NsYXNzLmV4dGVuZHMnLCBmYWxzZSwgJ190b0pTT04nLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBfdGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5leHRlbmRzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0Y5MGFHbHpLU0E5UGlCZmRHaHBjeTVmYldGd0tDZGpiR0Z6Y3k1bGVIUmxibVJ6Snl3Z1ptRnNjMlVzSUNkZmRHOUtVMDlPSnl3Z2RXNWtaV1pwYm1Wa0xDQjFibVJsWm1sdVpXUXNJSFZ1WkdWbWFXNWxaQ3dnWDNSb2FYTXVibUZ0WlNncEtTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLl9faWRGaWVsZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2lkRmllbGQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2lkRmllbGQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwibmFtZVwiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fX2lkRmllbGQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2libUZ0WlNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdCh0aGlzLnRhYmxlX0NvbHVtbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19kaWN0aW9uYXJ5Lm5hbWUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZGljdGlvbmFyeS5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2F2ZV9TdWJzY3JpcHRpb24udGFibGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2lucHV0LnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X291dHB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3ZhcmlhYmxlLnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cy5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2FjdGlvbl9pbnB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZmxvd19kYXRhX3Zhci5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnN5c19uYW1lKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGVfQ29sdW1ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRhYmxlX0NvbHVtbnMobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLnRhYmxlX0NvbHVtbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9Db2x1bW5zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0NvbHVtbnMobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9Db2x1bW5zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUYWJsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubGFiZWwgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19uYW1lKSA9PT0gJ29iamVjdCcpIHJldC5zeXNfbmFtZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zeXNfbmFtZSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy50YWJsZV9Db2x1bW5zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlX0NvbHVtbnMgPSB0aGlzLnRhYmxlX0NvbHVtbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9Db2x1bW5zID0gdGhpcy5yZWZlcmVuY2VfQ29sdW1ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9IHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdXBlcl9jbGFzcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdXBlcl9jbGFzcyA9IHRoaXMuc3VwZXJfY2xhc3MoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2lkRmllbGQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19pZEZpZWxkID0gdGhpcy5fX2lkRmllbGQoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RiX29iamVjdCcsIFsnKiddKVsnc3lzX2RiX29iamVjdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai50YWJsZV9Db2x1bW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50YWJsZV9Db2x1bW5zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRhYmxlX0NvbHVtbnMpKSB0aGlzLnRhYmxlX0NvbHVtbnMob2JqLnRhYmxlX0NvbHVtbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfQ29sdW1uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0NvbHVtbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0NvbHVtbnMpKSB0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKG9iai5yZWZlcmVuY2VfQ29sdW1ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucykpIHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X0lucHV0cykpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5wdXRzKG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKSkgdGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyhvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKSkgdGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyhvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kYl9vYmplY3QnLCBbJyonXSlbJ3N5c19kYl9vYmplY3QnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmdcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmFsdWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3ZhbHVlID0gdjtcblx0XHRcdHRoaXMuX3ZhbHVlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZhbHVlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5ibG9jayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ibG9jayA9IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9jaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21hcHBpbmdfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hcHBpbmdfVmFyaWFibGVfVmFsdWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLl9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwiWydpZCcsICdmaWVsZCcsICd0YWJsZSddXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lXeWRwWkNjc0lDZG1hV1ZzWkNjc0lDZDBZV0pzWlNkZEluMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdmaWVsZCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2lkJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3RhYmxlJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl92YWx1ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3ZhbHVlJyArICh0aGlzLl92YWx1ZV9jb29wIHx8ICc9JykgKyB0aGlzLnZhbHVlKCk7XG5cblx0XHRpZiAodGhpcy5fYmxvY2spIHJldCArPSAvKih0aGlzLl9ibG9ja19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJsb2NrKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Jsb2NrLicpO1xuXG5cdFx0KHRoaXMubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c192YXJpYWJsZV92YWx1ZS5tYXBwaW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9waWxsX2NvbXBvdW5kLmVsZW1lbnRNYXBwaW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRmaWVsZDogb2JqLmdldFZhbHVlKFwiZmllbGRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0aWQ6IG9iai5nZXRWYWx1ZShcImlkXCIpLFxuXG5cdFx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRcdHZhbHVlOiBvYmouZ2V0VmFsdWUoXCJ2YWx1ZVwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5maWVsZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZmllbGQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmlkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5pZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnRhYmxlKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoudGFibGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52YWx1ZShvYmoudmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWxlbWVudF9NYXBwaW5nXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmllbGQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pZCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRhYmxlID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQudGFibGUpID09PSAnb2JqZWN0JykgcmV0LnRhYmxlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnRhYmxlKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC52YWx1ZSA9IHRoaXMudmFsdWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJsb2NrID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ibG9jaykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYmxvY2spLmxlbmd0aCkgcmV0LmJsb2NrID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzID0gdGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmaWVsZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRhYmxlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInZhbHVlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmFsdWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFsdWUodGhpcy52YWx1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJsb2NrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYmxvY2soKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2sodGhpcy5ibG9jaygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2VsZW1lbnRfbWFwcGluZycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmaWVsZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmaWVsZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmllbGQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmllbGQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RhYmxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0YWJsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0YWJsZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92YWx1ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3ZhbHVlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy52YWx1ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFsdWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFsdWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhbHVlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhbHVlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVsZW1lbnQgTWFwcGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYmxvY2snKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYmxvY2snLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lbGVtZW50X21hcHBpbmcnLCBbJyonXSlbJ3N5c19lbGVtZW50X21hcHBpbmcnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyhvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMpKSB0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fQWN0aW9uX0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX1N0ZXBzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9TdGVwcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2Fubm90YXRpb24nICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UuYWN0aW9uX3R5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2FjdGlvbl9pbnB1dC5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfc3RlcF9pbnN0YW5jZS5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dC5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX25hbWU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0YW5ub3RhdGlvbjogb2JqLmdldFZhbHVlKFwiYW5ub3RhdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouaW50ZXJuYWxfbmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYW5ub3RhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYW5ub3RhdGlvbikpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmFubm90YXRpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9BY3Rpb25fSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX1R5cGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hbm5vdGF0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuYW5ub3RhdGlvbikgPT09ICdvYmplY3QnKSByZXQuYW5ub3RhdGlvbiA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5hbm5vdGF0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzID0gdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9JbnB1dHMgPSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbl9BY3Rpb25fU3RlcHMgPSB0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnRlcm5hbF9uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhbm5vdGF0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ludGVybmFsX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYW5ub3RhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Fubm90YXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Fubm90YXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYW5ub3RhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gVHlwZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyhvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMpKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbl9BY3Rpb25fU3RlcHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX0FjdGlvbl9TdGVwcykpIHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcyhvYmouYWN0aW9uX0FjdGlvbl9TdGVwcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi50cmFuc2Zvcm0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0cmFuc2Zvcm0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RyYW5zZm9ybSA9IHY7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHJhbnNmb3JtO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90cmFuc2Zvcm0pIHJldCArPSAvKih0aGlzLl90cmFuc2Zvcm1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50cmFuc2Zvcm0oKS5fdG9FUXVlcnkoc1BhdGggKyAndHJhbnNmb3JtX2RlZmluaXRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHRyYW5zZm9ybV9kZWZpbml0aW9uOiBvYmouZ2V0VmFsdWUoXCJ0cmFuc2Zvcm1fZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHJhbnNmb3JtX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRyYW5zZm9ybShuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtX2RlZmluaXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX25hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHJhbnNmb3JtX2RlZmluaXRpb24gPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0XHRpZiAocmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uKSB7XG5cdFx0XHRcdHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbiA9IHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHJhbnNmb3JtX2RlZmluaXRpb24pLmxlbmd0aCkgcmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRyYW5zZm9ybV9kZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHJhbnNmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybSh0aGlzLnRyYW5zZm9ybSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90cmFuc2Zvcm1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50cmFuc2Zvcm0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUcmFuc2Zvcm0gQ29tcG9zaXRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRyYW5zZm9ybSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIgKyBcInRyYW5zZm9ybVt0cmFuc2Zvcm1fZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50cmFuc2Zvcm0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHJhbnNmb3JtX2RlZmluaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RyYW5zZm9ybV9kZWZpbml0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RyYW5zZm9ybV9kZWZpbml0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZGVmaW5pdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlZmluaXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWZpbml0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZWZpbml0aW9uKSByZXQgKz0gLyoodGhpcy5fZGVmaW5pdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlZmluaXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVmaW5pdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19uYW1lOiBvYmouZ2V0VmFsdWUoXCJzeXNfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVmaW5pdGlvbjogb2JqLmdldFZhbHVlKFwiZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGVmaW5pdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVmaW5pdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0RhdGFcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVmaW5pdGlvbiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlZmluaXRpb24pIHtcblx0XHRcdFx0cmV0LmRlZmluaXRpb24gPSByZXQuZGVmaW5pdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWZpbml0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWZpbml0aW9uKS5sZW5ndGgpIHJldC5kZWZpbml0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZGF0YScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVmaW5pdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlZmluaXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IERhdGFcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcImRlZmluaXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiICsgXCJkZWZpbml0aW9uW2RlZmluaXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVmaW5pdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWZpbml0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVmaW5pdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2Zsb3dfZGF0YScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfZGF0YScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS50eXBlX1NlY3VyaXR5X0NvbnRyb2xzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZV9TZWN1cml0eV9Db250cm9scyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3R5cGVfU2VjdXJpdHlfQ29udHJvbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90eXBlX1NlY3VyaXR5X0NvbnRyb2xzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlX1NlY3VyaXR5X0NvbnRyb2xzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGVzY3JpcHRpb24nICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2VjdXJpdHlfYWNsLnR5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19uYW1lOiBvYmouZ2V0VmFsdWUoXCJzeXNfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwiZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouZGVzY3JpcHRpb24pKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTZWN1cml0eV9UeXBlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZXNjcmlwdGlvbiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2NyaXB0aW9uKSA9PT0gJ29iamVjdCcpIHJldC5kZXNjcmlwdGlvbiA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5kZXNjcmlwdGlvbikpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGVfU2VjdXJpdHlfQ29udHJvbHMgPSB0aGlzLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfdHlwZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBUeXBlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2VjdXJpdHlfdHlwZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfdHlwZScsIFsnKiddKVsnc3lzX3NlY3VyaXR5X3R5cGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmoudHlwZV9TZWN1cml0eV9Db250cm9sczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHlwZV9TZWN1cml0eV9Db250cm9scywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKSkgdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zZWN1cml0eV90eXBlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2Rlc2NyaXB0aW9uJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2VjdXJpdHlfYWNsLm9wZXJhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdGRlc2NyaXB0aW9uOiBvYmouZ2V0VmFsdWUoXCJkZXNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5zeXNfbmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmRlc2NyaXB0aW9uKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouZGVzY3JpcHRpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdXJpdHlfT3BlcmF0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX25hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVzY3JpcHRpb24gPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5kZXNjcmlwdGlvbikgPT09ICdvYmplY3QnKSByZXQuZGVzY3JpcHRpb24gPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuZGVzY3JpcHRpb24pKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyA9IHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNlY3VyaXR5IE9wZXJhdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpKSB0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyhvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1BsYXRmb3JtIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfUGxhdGZvcm0iLCJuYW1lIjoic2hzX2FyYmZ3X1BsYXRmb3JtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1BsYXRmb3JtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19QbGF0Zm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLnBsYXRmb3JtX01vZHVsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbGF0Zm9ybV9Nb2R1bGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fTW9kdWxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX01vZHVsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYXRmb3JtX01vZHVsZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5wbGF0Zm9ybV9Nb2R1bGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUucGxhdGZvcm0sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJpbml0XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuaW5pdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybV9Nb2R1bGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucGxhdGZvcm1fTW9kdWxlcyhuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnBsYXRmb3JtX01vZHVsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQbGF0Zm9ybVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBsYXRmb3JtX01vZHVsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGxhdGZvcm1fTW9kdWxlcyA9IHRoaXMucGxhdGZvcm1fTW9kdWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIm9iai5wbGF0Zm9ybV9Nb2R1bGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wbGF0Zm9ybV9Nb2R1bGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBsYXRmb3JtX01vZHVsZXMpKSB0aGlzLnBsYXRmb3JtX01vZHVsZXMob2JqLnBsYXRmb3JtX01vZHVsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5pbml0KCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5pdChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmluaXQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1VzZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Vc2VyIiwibmFtZSI6InNoc19hcmJmd19Vc2VyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1VzZXIgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1VzZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9lZGl0b3JfVmVyc2lvbl9IaXN0b3J5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5vcmdhbml6ZXJfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmdhbml6ZXJfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm1vZGVyYXRvcl9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZXJhdG9yX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX0JvYXJkX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXJfQm9hcmRfTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX0JvYXJkX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX1RlYW1fTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcl9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZW1iZXJfVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndXNlcl9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeS5lZGl0b3IsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZy5vcmdhbml6ZXIsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZy5tb2RlcmF0b3IsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXIubWVtYmVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlci5tZW1iZXIsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVXNlcigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0dXNlcl9uYW1lOiBvYmouZ2V0VmFsdWUoXCJ1c2VyX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudXNlcl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai51c2VyX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZ2FuaXplcl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5vcmdhbml6ZXJfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tb2RlcmF0b3JfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMobmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVtYmVyX1RlYW1fTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJVc2VyXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC51c2VyX25hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMgPSB0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JnYW5pemVyX01lZXRpbmdzID0gdGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlcmF0b3JfTWVldGluZ3MgPSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVtYmVyX0JvYXJkX01lbWJlcnMgPSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcl9UZWFtX01lbWJlcnMgPSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Vc2VyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInVzZXJfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c191c2VyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndXNlcl9uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd1c2VyX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3VzZXJfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd1c2VyX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c191c2VyJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMpKSB0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKG9iai5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwib2JqLm9yZ2FuaXplcl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoub3JnYW5pemVyX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm9yZ2FuaXplcl9NZWV0aW5ncykpIHRoaXMub3JnYW5pemVyX01lZXRpbmdzKG9iai5vcmdhbml6ZXJfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubW9kZXJhdG9yX01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tb2RlcmF0b3JfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubW9kZXJhdG9yX01lZXRpbmdzKSkgdGhpcy5tb2RlcmF0b3JfTWVldGluZ3Mob2JqLm1vZGVyYXRvcl9NZWV0aW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5tZW1iZXJfQm9hcmRfTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMpKSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwib2JqLm1lbWJlcl9UZWFtX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVtYmVyX1RlYW1fTWVtYmVycykpIHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycyhvYmoubWVtYmVyX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c191c2VyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0VmZm9ydCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0VmZm9ydCIsIm5hbWUiOiJzaHNfYXJiZndfRWZmb3J0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0VmZm9ydCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRWZmb3J0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlZmZvcnRfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZS5lZmZvcnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJFZmZvcnRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzID0gdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0VmZm9ydCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSkgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfQnVkZ2V0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfQnVkZ2V0IiwibmFtZSI6InNoc19hcmJmd19CdWRnZXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfQnVkZ2V0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19CdWRnZXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5idWRnZXRfUHJvamVjdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRidWRnZXRfUHJvamVjdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldF9Qcm9qZWN0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJ1ZGdldF9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdC5idWRnZXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5idWRnZXRfUHJvamVjdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5idWRnZXRfUHJvamVjdHMobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0X1Byb2plY3RzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQnVkZ2V0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5idWRnZXRfUHJvamVjdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYnVkZ2V0X1Byb2plY3RzID0gdGhpcy5idWRnZXRfUHJvamVjdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19CdWRnZXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwib2JqLmJ1ZGdldF9Qcm9qZWN0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYnVkZ2V0X1Byb2plY3RzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJ1ZGdldF9Qcm9qZWN0cykpIHRoaXMuYnVkZ2V0X1Byb2plY3RzKG9iai5idWRnZXRfUHJvamVjdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1Rhc2siLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19UYXNrIiwibmFtZSI6InNoc19hcmJmd19UYXNrIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1Rhc2sgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1Rhc2tcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2sub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ251bWJlcicgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGFzaygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVGFzaygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bnVtYmVyOiBvYmouZ2V0VmFsdWUoXCJudW1iZXJcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubnVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5udW1iZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVGFza1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubnVtYmVyID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19UYXNrKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm51bWJlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd0YXNrJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbnVtYmVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdudW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ251bWJlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdudW1iZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3Rhc2snLCBbJyonXSlbJ3Rhc2snXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd0YXNrJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3Rhc2snLCBbJyonXSlbJ3Rhc2snXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3Rhc2snKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSIsIm5hbWUiOiJzaHNfYXJiZndfU2VjdGlvbl9UeXBlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU2VjdGlvbl9UeXBlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGVfU29sdXRpb25fU2VjdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90eXBlX1NvbHV0aW9uX1NlY3Rpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uLnR5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nLnR5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyhuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTZWN0aW9uX1R5cGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnR5cGVfU29sdXRpb25fU2VjdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyA9IHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyA9IHRoaXMudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpKSB0aGlzLnR5cGVfU29sdXRpb25fU2VjdGlvbnMob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKSB0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhvYmoudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nLnN0b3JhZ2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fU3RvcmFnZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gdGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIm9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKSB0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfRGVjaXNpb24iLCJuYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0RlY2lzaW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19EZWNpc2lvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZGVjaXNpb25fTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uLmRlY2lzaW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5kZWNpc2lvbl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZy5kZWNpc2lvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMobmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRGVjaXNpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMgPSB0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uX01lZXRpbmdzID0gdGhpcy5kZWNpc2lvbl9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMpKSB0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJvYmouZGVjaXNpb25fTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlY2lzaW9uX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlY2lzaW9uX01lZXRpbmdzKSkgdGhpcy5kZWNpc2lvbl9NZWV0aW5ncyhvYmouZGVjaXNpb25fTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0JvYXJkIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfQm9hcmQiLCJuYW1lIjoic2hzX2FyYmZ3X0JvYXJkIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0JvYXJkIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Cb2FyZFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmJvYXJkX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Ym9hcmRfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ib2FyZF9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2JvYXJkX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZF9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5ib2FyZF9Cb2FyZF9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Ym9hcmRfQm9hcmRfTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2JvYXJkX0JvYXJkX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuYm9hcmRfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcuYm9hcmQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlci5ib2FyZCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmRfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ib2FyZF9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZF9NZWV0aW5ncykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmRfQm9hcmRfTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMobmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQm9hcmRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5ib2FyZF9NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZF9NZWV0aW5ncyA9IHRoaXMuYm9hcmRfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYm9hcmRfQm9hcmRfTWVtYmVycyA9IHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0JvYXJkKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIm9iai5ib2FyZF9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYm9hcmRfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYm9hcmRfTWVldGluZ3MpKSB0aGlzLmJvYXJkX01lZXRpbmdzKG9iai5ib2FyZF9NZWV0aW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJvYmouYm9hcmRfQm9hcmRfTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYm9hcmRfQm9hcmRfTWVtYmVycywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzKSkgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0ZyZXF1ZW5jeSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0ZyZXF1ZW5jeSIsIm5hbWUiOiJzaHNfYXJiZndfRnJlcXVlbmN5Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRnJlcXVlbmN5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGFpbHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYWlseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGFpbHkgPSB2O1xuXHRcdFx0dGhpcy5fZGFpbHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGFpbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZWtseSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZWtseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2Vla2x5ID0gdjtcblx0XHRcdHRoaXMuX3dlZWtseV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWVrbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm1vbnRobHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb250aGx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb250aGx5ID0gdjtcblx0XHRcdHRoaXMuX21vbnRobHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9udGhseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucXVhcnRlcmx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cXVhcnRlcmx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9xdWFydGVybHkgPSB2O1xuXHRcdFx0dGhpcy5fcXVhcnRlcmx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3F1YXJ0ZXJseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGF5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRheXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RheXMgPSB2O1xuXHRcdFx0dGhpcy5fZGF5c19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXlzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5tb25kYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb25kYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21vbmRheSA9IHY7XG5cdFx0XHR0aGlzLl9tb25kYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9uZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS50dWVzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHVlc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHVlc2RheSA9IHY7XG5cdFx0XHR0aGlzLl90dWVzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R1ZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZG5lc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZG5lc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2VkbmVzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3dlZG5lc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWRuZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnRodXJzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGh1cnNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RodXJzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3RodXJzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RodXJzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5mcmlkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmlkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2ZyaWRheSA9IHY7XG5cdFx0XHR0aGlzLl9mcmlkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJpZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5zYXR1cmRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNhdHVyZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zYXR1cmRheSA9IHY7XG5cdFx0XHR0aGlzLl9zYXR1cmRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zYXR1cmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc3VuZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3VuZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdW5kYXkgPSB2O1xuXHRcdFx0dGhpcy5fc3VuZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1bmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kYWlseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhaWx5JyArICh0aGlzLl9kYWlseV9jb29wIHx8ICc9JykgKyB0aGlzLmRhaWx5KCk7XG5cblx0XHRpZiAodGhpcy5fd2Vla2x5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2Vla2x5JyArICh0aGlzLl93ZWVrbHlfY29vcCB8fCAnPScpICsgdGhpcy53ZWVrbHkoKTtcblxuXHRcdGlmICh0aGlzLl9tb250aGx5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbW9udGhseScgKyAodGhpcy5fbW9udGhseV9jb29wIHx8ICc9JykgKyB0aGlzLm1vbnRobHkoKTtcblxuXHRcdGlmICh0aGlzLl9xdWFydGVybHkpIHJldCArPSAnXicgKyBzUGF0aCArICdxdWFydGVybHknICsgKHRoaXMuX3F1YXJ0ZXJseV9jb29wIHx8ICc9JykgKyB0aGlzLnF1YXJ0ZXJseSgpO1xuXG5cdFx0aWYgKHRoaXMuX2RheXMpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXlzJyArICh0aGlzLl9kYXlzX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF5cygpO1xuXG5cdFx0aWYgKHRoaXMuX21vbmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21vbmRheScgKyAodGhpcy5fbW9uZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMubW9uZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fdHVlc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R1ZXNkYXknICsgKHRoaXMuX3R1ZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy50dWVzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fd2VkbmVzZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2VkbmVzZGF5JyArICh0aGlzLl93ZWRuZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdGlmICh0aGlzLl90aHVyc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3RodXJzZGF5JyArICh0aGlzLl90aHVyc2RheV9jb29wIHx8ICc9JykgKyB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fZnJpZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnZnJpZGF5JyArICh0aGlzLl9mcmlkYXlfY29vcCB8fCAnPScpICsgdGhpcy5mcmlkYXkoKTtcblxuXHRcdGlmICh0aGlzLl9zYXR1cmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NhdHVyZGF5JyArICh0aGlzLl9zYXR1cmRheV9jb29wIHx8ICc9JykgKyB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fc3VuZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3VuZGF5JyArICh0aGlzLl9zdW5kYXlfY29vcCB8fCAnPScpICsgdGhpcy5zdW5kYXkoKTtcblxuXHRcdCh0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzLmZyZXF1ZW5jeSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkYWlseTogb2JqLmdldFZhbHVlKFwiZGFpbHlcIiksXG5cblx0XHRcdFx0XHRcdHdlZWtseTogb2JqLmdldFZhbHVlKFwid2Vla2x5XCIpLFxuXG5cdFx0XHRcdFx0XHRtb250aGx5OiBvYmouZ2V0VmFsdWUoXCJtb250aGx5XCIpLFxuXG5cdFx0XHRcdFx0XHRxdWFydGVybHk6IG9iai5nZXRWYWx1ZShcInF1YXJ0ZXJseVwiKSxcblxuXHRcdFx0XHRcdFx0ZGF5czogb2JqLmdldFZhbHVlKFwiZGF5c1wiKSxcblxuXHRcdFx0XHRcdFx0bW9uZGF5OiBvYmouZ2V0VmFsdWUoXCJtb25kYXlcIiksXG5cblx0XHRcdFx0XHRcdHR1ZXNkYXk6IG9iai5nZXRWYWx1ZShcInR1ZXNkYXlcIiksXG5cblx0XHRcdFx0XHRcdHdlZG5lc2RheTogb2JqLmdldFZhbHVlKFwid2VkbmVzZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHR0aHVyc2RheTogb2JqLmdldFZhbHVlKFwidGh1cnNkYXlcIiksXG5cblx0XHRcdFx0XHRcdGZyaWRheTogb2JqLmdldFZhbHVlKFwiZnJpZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRzYXR1cmRheTogb2JqLmdldFZhbHVlKFwic2F0dXJkYXlcIiksXG5cblx0XHRcdFx0XHRcdHN1bmRheTogb2JqLmdldFZhbHVlKFwic3VuZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYWlseShvYmouZGFpbHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZWtseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMud2Vla2x5KG9iai53ZWVrbHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbnRobHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vbnRobHkob2JqLm1vbnRobHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnF1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucXVhcnRlcmx5KG9iai5xdWFydGVybHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRheXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRheXMob2JqLmRheXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubW9uZGF5KG9iai5tb25kYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR1ZXNkYXkob2JqLnR1ZXNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZG5lc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMud2VkbmVzZGF5KG9iai53ZWRuZXNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRodXJzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50aHVyc2RheShvYmoudGh1cnNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZnJpZGF5KG9iai5mcmlkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zYXR1cmRheShvYmouc2F0dXJkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1bmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3VuZGF5KG9iai5zdW5kYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRnJlcXVlbmN5XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGFpbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhaWx5ID0gdGhpcy5kYWlseSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWVrbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LndlZWtseSA9IHRoaXMud2Vla2x5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vbnRobHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vbnRobHkgPSB0aGlzLm1vbnRobHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcXVhcnRlcmx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5xdWFydGVybHkgPSB0aGlzLnF1YXJ0ZXJseSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXlzID0gdGhpcy5kYXlzKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubW9uZGF5ID0gdGhpcy5tb25kYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHVlc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHVlc2RheSA9IHRoaXMudHVlc2RheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWRuZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LndlZG5lc2RheSA9IHRoaXMud2VkbmVzZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RodXJzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50aHVyc2RheSA9IHRoaXMudGh1cnNkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJpZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mcmlkYXkgPSB0aGlzLmZyaWRheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zYXR1cmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2F0dXJkYXkgPSB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1bmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3VuZGF5ID0gdGhpcy5zdW5kYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MgPSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhaWx5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGFpbHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGFpbHkodGhpcy5kYWlseSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIndlZWtseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLndlZWtseSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC53ZWVrbHkodGhpcy53ZWVrbHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb250aGx5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubW9udGhseSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb250aGx5KHRoaXMubW9udGhseSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInF1YXJ0ZXJseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnF1YXJ0ZXJseSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5xdWFydGVybHkodGhpcy5xdWFydGVybHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXlzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXlzKHRoaXMuZGF5cygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vbmRheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vbmRheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb25kYXkodGhpcy5tb25kYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0dWVzZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHVlc2RheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50dWVzZGF5KHRoaXMudHVlc2RheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIndlZG5lc2RheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLndlZG5lc2RheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC53ZWRuZXNkYXkodGhpcy53ZWRuZXNkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0aHVyc2RheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRodXJzZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRodXJzZGF5KHRoaXMudGh1cnNkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmcmlkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mcmlkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZnJpZGF5KHRoaXMuZnJpZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2F0dXJkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zYXR1cmRheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zYXR1cmRheSh0aGlzLnNhdHVyZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3VuZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3VuZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN1bmRheSh0aGlzLnN1bmRheSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGFpbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYWlseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhaWx5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYWlseScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYWlseScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGFpbHknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGFpbHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2Vla2x5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fd2Vla2x5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMud2Vla2x5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd3ZWVrbHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnd2Vla2x5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd3ZWVrbHknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnd2Vla2x5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vbnRobHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tb250aGx5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubW9udGhseSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9udGhseScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb250aGx5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb250aGx5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21vbnRobHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcXVhcnRlcmx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcXVhcnRlcmx5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucXVhcnRlcmx5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdxdWFydGVybHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncXVhcnRlcmx5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdxdWFydGVybHknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncXVhcnRlcmx5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RheXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXlzX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF5cygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF5cycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXlzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXlzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RheXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9uZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbW9uZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubW9uZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb25kYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbW9uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbW9uZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90dWVzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHVlc2RheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHVlc2RheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0dWVzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0dWVzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R1ZXNkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2VkbmVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fd2VkbmVzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMud2VkbmVzZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd3ZWRuZXNkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnd2VkbmVzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd3ZWRuZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnd2VkbmVzZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RodXJzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGh1cnNkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50aHVyc2RheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGh1cnNkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGh1cnNkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RodXJzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RodXJzZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2ZyaWRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZyaWRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZnJpZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ZyaWRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZnJpZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ZyaWRheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zYXR1cmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NhdHVyZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2F0dXJkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NhdHVyZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NhdHVyZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzYXR1cmRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzYXR1cmRheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdW5kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdW5kYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdW5kYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N1bmRheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdW5kYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1bmRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdW5kYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwib2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcykpIHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyhvYmouZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1RlYW0iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19UZWFtIiwibmFtZSI6InNoc19hcmJmd19UZWFtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1RlYW0gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS50ZWFtX1Byb2plY3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbV9Qcm9qZWN0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90ZWFtX1Byb2plY3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtX1Byb2plY3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0udGVhbV9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGVhbV9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudGVhbV9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdC50ZWFtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50ZWFtX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXIudGVhbSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtX1Byb2plY3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudGVhbV9Qcm9qZWN0cyhuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai50ZWFtX1Byb2plY3RzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtX1RlYW1fTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai50ZWFtX1RlYW1fTWVtYmVycykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRlYW1cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGVhbV9Qcm9qZWN0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtX1Byb2plY3RzID0gdGhpcy50ZWFtX1Byb2plY3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50ZWFtX1RlYW1fTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtX1RlYW1fTWVtYmVycyA9IHRoaXMudGVhbV9UZWFtX01lbWJlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19UZWFtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIm9iai50ZWFtX1Byb2plY3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50ZWFtX1Byb2plY3RzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRlYW1fUHJvamVjdHMpKSB0aGlzLnRlYW1fUHJvamVjdHMob2JqLnRlYW1fUHJvamVjdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJvYmoudGVhbV9UZWFtX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRlYW1fVGVhbV9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRlYW1fVGVhbV9NZW1iZXJzKSkgdGhpcy50ZWFtX1RlYW1fTWVtYmVycyhvYmoudGVhbV9UZWFtX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Sb2xlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfUm9sZSIsIm5hbWUiOiJzaHNfYXJiZndfUm9sZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Sb2xlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Sb2xlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUucm9sZV9FZmZvcnRfRXN0aW1hdGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZV9FZmZvcnRfRXN0aW1hdGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcm9sZV9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcm9sZV9FZmZvcnRfRXN0aW1hdGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yb2xlX0VmZm9ydF9Fc3RpbWF0ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5yb2xlX1RlYW1fTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJvbGVfVGVhbV9NZW1iZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcm9sZV9UZWFtX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yb2xlX1RlYW1fTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZV9UZWFtX01lbWJlcnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZS5yb2xlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yb2xlX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXIucm9sZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMobmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGVfVGVhbV9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucm9sZV9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGVfVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUm9sZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZV9FZmZvcnRfRXN0aW1hdGVzID0gdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGVfVGVhbV9NZW1iZXJzID0gdGhpcy5yb2xlX1RlYW1fTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1JvbGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfcm9sZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIm9iai5yb2xlX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucm9sZV9UZWFtX01lbWJlcnMpKSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKG9iai5yb2xlX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcm9sZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcm9sZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi52ZXJzaW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmVyc2lvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdmVyc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl92ZXJzaW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZlcnNpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NjcmlwdF9GaWxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRml4X1NjcmlwdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9UYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9UYWJsZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9UYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9UYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GbG93cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0Zsb3dzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fRmxvd3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmllbGRfTGFiZWxzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmllbGRfTGFiZWxzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9UeXBlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdzY29wZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc2hvcnRfZGVzY3JpcHRpb24nICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZlcnNpb24pIHJldCArPSAnXicgKyBzUGF0aCArICd2ZXJzaW9uJyArICh0aGlzLl92ZXJzaW9uX2Nvb3AgfHwgJz0nKSArIHRoaXMudmVyc2lvbigpO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19yb2xsYmFja19jb250ZXh0LnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2NyaXB0X2luY2x1ZGUuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3NjcmlwdF9maXguYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2RiX29iamVjdC5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2F2ZV9TdWJzY3JpcHRpb24uc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GbG93cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93LnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZG9jdW1lbnRhdGlvbi5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZS5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfYWN0aW9uX2luc3RhbmNlLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24uc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3NuYXBzaG90LnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfcGlsbF9jb21wb3VuZC5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2VjdXJpdHlfYWNsLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19zZWN1cml0eV90eXBlLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3NlY3VyaXR5X29wZXJhdGlvbi5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHNjb3BlOiBvYmouZ2V0VmFsdWUoXCJzY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRzaG9ydF9kZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwic2hvcnRfZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdHZlcnNpb246IG9iai5nZXRWYWx1ZShcInZlcnNpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnNjb3BlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zaG9ydF9kZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouc2hvcnRfZGVzY3JpcHRpb24pKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5zaG9ydF9kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudmVyc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudmVyc2lvbihvYmoudmVyc2lvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1RhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0Zsb3dzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fRmxvd3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9GbG93cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQXBwbGljYXRpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2NvcGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2hvcnRfZGVzY3JpcHRpb24gPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5zaG9ydF9kZXNjcmlwdGlvbikgPT09ICdvYmplY3QnKSByZXQuc2hvcnRfZGVzY3JpcHRpb24gPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuc2hvcnRfZGVzY3JpcHRpb24pKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmVyc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudmVyc2lvbiA9IHRoaXMudmVyc2lvbigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzID0gdGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyA9IHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyA9IHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9UYWJsZXMgPSB0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyA9IHRoaXMuYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GbG93cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GbG93cyA9IHRoaXMuYXBwbGljYXRpb25fRmxvd3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMgPSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyA9IHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyA9IHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyA9IHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyA9IHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzID0gdGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgPSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyA9IHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyA9IHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNob3J0X2Rlc2NyaXB0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInZlcnNpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy52ZXJzaW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZlcnNpb24odGhpcy52ZXJzaW9uKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2NvcGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Nob3J0X2Rlc2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2hvcnRfZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Nob3J0X2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Nob3J0X2Rlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZlcnNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl92ZXJzaW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3ZlcnNpb25fY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnZlcnNpb24oKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZlcnNpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2ZXJzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd2ZXJzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZlcnNpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3Njb3BlJywgWycqJ10pWydzeXNfc2NvcGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zY29wZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cykpIHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMob2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcykpIHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKG9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cykpIHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1RhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fVGFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1RhYmxlcykpIHRoaXMuYXBwbGljYXRpb25fVGFibGVzKG9iai5hcHBsaWNhdGlvbl9UYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucykpIHRoaXMuYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0Zsb3dzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9GbG93cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93cykpIHRoaXMuYXBwbGljYXRpb25fRmxvd3Mob2JqLmFwcGxpY2F0aW9uX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscykpIHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcykpIHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3Mob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcykpIHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcykpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyhvYmouYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcykpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cykpIHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcykpIHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMob2JqLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scykpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcykpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucykpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyhvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NvcGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3Njb3BlJywgWycqJ10pWydzeXNfc2NvcGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9RdWV1ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfUXVldWUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfUXVldWUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9RdWV1ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1F1ZXVlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5jbHVzdGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2x1c3Rlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2x1c3RlciA9IHY7XG5cdFx0XHR0aGlzLl9jbHVzdGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NsdXN0ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUudG9waWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0b3BpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdG9waWMgPSB2O1xuXHRcdFx0dGhpcy5fdG9waWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdG9waWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucHJvY2Vzc2VkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvY2Vzc2VkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3NlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3Byb2Nlc3NlZCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9jZXNzZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvY2Vzc2VkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRpcmVjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRpcmVjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGlyZWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RpcmVjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fc3RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VuZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZW5kZXIgPSB2O1xuXHRcdFx0dGhpcy5fc2VuZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlbmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZWNpcGllbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWNpcGllbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlY2lwaWVudCA9IHY7XG5cdFx0XHR0aGlzLl9yZWNpcGllbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVjaXBpZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnJlc3BvbnNlVG8gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXNwb25zZVRvKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvID0gdjtcblx0XHRcdHRoaXMuX3Jlc3BvbnNlVG9fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUbztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZXNwb25zZVRvX1F1ZXVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlc3BvbnNlVG9fUXVldWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVzcG9uc2VUb19RdWV1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvX1F1ZXVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUb19RdWV1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NvdXJjZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncGF5bG9hZCcgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fY2x1c3RlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FnZW50JyArICh0aGlzLl9jbHVzdGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMuY2x1c3RlcigpO1xuXG5cdFx0aWYgKHRoaXMuX3RvcGljKSByZXQgKz0gJ14nICsgc1BhdGggKyAndG9waWMnICsgKHRoaXMuX3RvcGljX2Nvb3AgfHwgJz0nKSArIHRoaXMudG9waWMoKTtcblxuXHRcdGlmICh0aGlzLl9wcm9jZXNzZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdwcm9jZXNzZWQnICsgKHRoaXMuX3Byb2Nlc3NlZF9jb29wIHx8ICc9JykgKyB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2RpcmVjdGlvbikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3F1ZXVlJyArICh0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPScpICsgdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdGlmICh0aGlzLl9zdGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXRlJyArICh0aGlzLl9zdGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXRlKCk7XG5cblx0XHRpZiAodGhpcy5fc2VuZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZnJvbV9ob3N0JyArICh0aGlzLl9zZW5kZXJfY29vcCB8fCAnPScpICsgdGhpcy5zZW5kZXIoKTtcblxuXHRcdGlmICh0aGlzLl9yZWNpcGllbnQpIHJldCArPSAnXicgKyBzUGF0aCArICdhZ2VudF9jb3JyZWxhdG9yJyArICh0aGlzLl9yZWNpcGllbnRfY29vcCB8fCAnPScpICsgdGhpcy5yZWNpcGllbnQoKTtcblxuXHRcdGlmICh0aGlzLl9yZXNwb25zZVRvKSByZXQgKz0gLyoodGhpcy5fcmVzcG9uc2VUb19jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlc3BvbnNlVG8oKS5fdG9FUXVlcnkoc1BhdGggKyAncmVzcG9uc2VfdG8uJyk7XG5cblx0XHQodGhpcy5yZXNwb25zZVRvX1F1ZXVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZZWNjX3F1ZXVlLnJlc3BvbnNlX3RvLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJwcm9jZXNzXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvY2VzcygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c291cmNlOiBvYmouZ2V0VmFsdWUoXCJzb3VyY2VcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cGF5bG9hZDogb2JqLmdldFZhbHVlKFwicGF5bG9hZFwiKSxcblxuXHRcdFx0XHRcdFx0YWdlbnQ6IG9iai5nZXRWYWx1ZShcImFnZW50XCIpLFxuXG5cdFx0XHRcdFx0XHR0b3BpYzogb2JqLmdldFZhbHVlKFwidG9waWNcIiksXG5cblx0XHRcdFx0XHRcdHByb2Nlc3NlZDogb2JqLmdldFZhbHVlKFwicHJvY2Vzc2VkXCIpLFxuXG5cdFx0XHRcdFx0XHRxdWV1ZTogb2JqLmdldFZhbHVlKFwicXVldWVcIiksXG5cblx0XHRcdFx0XHRcdHN0YXRlOiBvYmouZ2V0VmFsdWUoXCJzdGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZnJvbV9ob3N0OiBvYmouZ2V0VmFsdWUoXCJmcm9tX2hvc3RcIiksXG5cblx0XHRcdFx0XHRcdGFnZW50X2NvcnJlbGF0b3I6IG9iai5nZXRWYWx1ZShcImFnZW50X2NvcnJlbGF0b3JcIiksXG5cblx0XHRcdFx0XHRcdHJlc3BvbnNlX3RvOiBvYmouZ2V0VmFsdWUoXCJyZXNwb25zZV90b1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zb3VyY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnNvdXJjZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGF5bG9hZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucGF5bG9hZCkpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnBheWxvYWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFnZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jbHVzdGVyKG9iai5hZ2VudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRvcGljKG9iai50b3BpYyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvY2Vzc2VkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wcm9jZXNzZWQob2JqLnByb2Nlc3NlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucXVldWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRpcmVjdGlvbihvYmoucXVldWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGF0ZShvYmouc3RhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyb21faG9zdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2VuZGVyKG9iai5mcm9tX2hvc3QpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFnZW50X2NvcnJlbGF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlY2lwaWVudChvYmouYWdlbnRfY29ycmVsYXRvcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVzcG9uc2VfdG8pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlc3BvbnNlVG8obmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVzcG9uc2VfdG8pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXNwb25zZVRvX1F1ZXVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlc3BvbnNlVG9fUXVldWVzKG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlVG9fUXVldWVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUXVldWVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc291cmNlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBheWxvYWQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5wYXlsb2FkKSA9PT0gJ29iamVjdCcpIHJldC5wYXlsb2FkID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnBheWxvYWQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2x1c3RlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWdlbnQgPSB0aGlzLmNsdXN0ZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRvcGljID0gdGhpcy50b3BpYygpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9jZXNzZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnByb2Nlc3NlZCA9IHRoaXMucHJvY2Vzc2VkKCk7XG5cblx0XHRcdGlmIChyZXQucHJvY2Vzc2VkICYmIHR5cGVvZihyZXQucHJvY2Vzc2VkLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LnByb2Nlc3NlZCA9IHJldC5wcm9jZXNzZWQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RpcmVjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucXVldWUgPSB0aGlzLmRpcmVjdGlvbigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RhdGUgPSB0aGlzLnN0YXRlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlbmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZnJvbV9ob3N0ID0gdGhpcy5zZW5kZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVjaXBpZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hZ2VudF9jb3JyZWxhdG9yID0gdGhpcy5yZWNpcGllbnQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVzcG9uc2VUbykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVzcG9uc2VfdG8gPSB0aGlzLnJlc3BvbnNlVG8oKTtcblxuXHRcdFx0aWYgKHJldC5yZXNwb25zZV90bykge1xuXHRcdFx0XHRyZXQucmVzcG9uc2VfdG8gPSByZXQucmVzcG9uc2VfdG8uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVzcG9uc2VfdG8pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlc3BvbnNlX3RvKS5sZW5ndGgpIHJldC5yZXNwb25zZV90byA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVzcG9uc2VUb19RdWV1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVzcG9uc2VUb19RdWV1ZXMgPSB0aGlzLnJlc3BvbnNlVG9fUXVldWVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jbHVzdGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNsdXN0ZXIodGhpcy5jbHVzdGVyKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMudG9waWMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudG9waWModGhpcy50b3BpYygpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmRpcmVjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kaXJlY3Rpb24odGhpcy5kaXJlY3Rpb24oKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zZW5kZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2VuZGVyKHRoaXMuc2VuZGVyKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMucmVjaXBpZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlY2lwaWVudCh0aGlzLnJlY2lwaWVudCgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnJlc3BvbnNlVG8oKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVzcG9uc2VUbyh0aGlzLnJlc3BvbnNlVG8oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNvdXJjZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGF5bG9hZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhZ2VudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNsdXN0ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2x1c3Rlcih0aGlzLmNsdXN0ZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0b3BpY1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRvcGljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRvcGljKHRoaXMudG9waWMoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcm9jZXNzZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9jZXNzZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvY2Vzc2VkKHRoaXMucHJvY2Vzc2VkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicXVldWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kaXJlY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3RhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGF0ZSh0aGlzLnN0YXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJvbV9ob3N0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VuZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlbmRlcih0aGlzLnNlbmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFnZW50X2NvcnJlbGF0b3JcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWNpcGllbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVjaXBpZW50KHRoaXMucmVjaXBpZW50KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVzcG9uc2VfdG9cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXNwb25zZVRvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG8odGhpcy5yZXNwb25zZVRvKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdlY2NfcXVldWUnLCBbJyonXSlbJ2VjY19xdWV1ZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnZWNjX3F1ZXVlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzb3VyY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzb3VyY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NvdXJjZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzb3VyY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGF5bG9hZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BheWxvYWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BheWxvYWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGF5bG9hZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jbHVzdGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY2x1c3Rlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jbHVzdGVyX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jbHVzdGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhZ2VudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FnZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhZ2VudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhZ2VudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90b3BpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RvcGljX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3RvcGljX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50b3BpYygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndG9waWMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0b3BpYycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndG9waWMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndG9waWMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvY2Vzc2VkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcHJvY2Vzc2VkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucHJvY2Vzc2VkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2Nlc3NlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Byb2Nlc3NlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvY2Vzc2VkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Byb2Nlc3NlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kaXJlY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fZGlyZWN0aW9uX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3F1ZXVlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncXVldWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3F1ZXVlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3F1ZXVlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fc3RhdGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN0YXRlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0YXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZW5kZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zZW5kZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fc2VuZGVyX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zZW5kZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zyb21faG9zdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zyb21faG9zdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZnJvbV9ob3N0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zyb21faG9zdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWNpcGllbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWNpcGllbnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVjaXBpZW50X2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWNpcGllbnQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FnZW50X2NvcnJlbGF0b3InKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhZ2VudF9jb3JyZWxhdG9yJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhZ2VudF9jb3JyZWxhdG9yJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FnZW50X2NvcnJlbGF0b3InLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVzcG9uc2VUbykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Jlc3BvbnNlVG9fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZXNwb25zZVRvKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUXVldWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwicmVzcG9uc2VUbyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIiArIFwicmVzcG9uc2VUb1tyZXNwb25zZV90b10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXNwb25zZVRvKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Jlc3BvbnNlX3RvJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVzcG9uc2VfdG8nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Jlc3BvbnNlX3RvJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Jlc3BvbnNlX3RvJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdlY2NfcXVldWUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdGlmIChfb2JqLnByb2Nlc3NlZCAmJiB0eXBlb2YoX29iai5wcm9jZXNzZWQuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLnByb2Nlc3NlZCA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmoucHJvY2Vzc2VkKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlc3BvbnNlVG9fUXVldWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZXNwb25zZVRvX1F1ZXVlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZXNwb25zZVRvX1F1ZXVlcykpIHRoaXMucmVzcG9uc2VUb19RdWV1ZXMob2JqLnJlc3BvbnNlVG9fUXVldWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnByb2Nlc3MoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9jZXNzKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUucHJvY2VzcygpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHR0aGlzLnN0YXRlKFwicHJvY2Vzc2luZ1wiKS5wcm9jZXNzZWQobmV3IERhdGUoKSkucmVzcG9uc2VUbyhudWxsKS5zdG9yZSgpO1xuXG5cdFx0XHRsZXQgciA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuZGlyZWN0aW9uKFwib3V0cHV0XCIpLm5hbWUodGhpcy5uYW1lKCkpLnRvcGljKHRoaXMudG9waWMoKSkuY2x1c3Rlcih0aGlzLmNsdXN0ZXIoKSkuc2VuZGVyKHRoaXMucmVjaXBpZW50KCkpLnJlY2lwaWVudCh0aGlzLnNlbmRlcigpKS5jb2RlKHRoaXMuY29kZSgpKS5zdGF0ZShcInByb2Nlc3NlZFwiKS5wcm9jZXNzZWQobmV3IERhdGUoKSkucmVzcG9uc2VUbyh0aGlzKTtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGxldCByZXQgPSAobmV3IHRoaXMuX19vU2NvcGVbdGhpcy5jb2RlKCldKCkpLl9pbnZva2UodGhpcy5uYW1lKCksIHRoaXMucmVtYXJrKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ci5yZW1hcmsocmV0KTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdGxvZyhcIkV4Y2VwdGlvbjogXCIgKyBleCk7XG5cdFx0XHRcdHIuc3RhdGUoXCJlcnJvclwiKS5yZW1hcmsoZXgudG9TdHJpbmcoKSk7XG5cdFx0XHR9XG5cdFx0XHRyLnN0b3JlKCk7XG5cblx0XHRcdHRoaXMucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnN0YXRlKFwicHJvY2Vzc2VkXCIpLnN0b3JlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTYXZlX1N1YnNjcmlwdGlvbi5wcm9maWxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJDb25uZWN0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zID0gdGhpcy5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ0Nvbm5lY3Rpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdDb25uZWN0aW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKSkgdGhpcy5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyhvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ0Nvbm5lY3Rpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb25fRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N5c19uYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMubG9naWNfZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlZmluaXRpb25fRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTG9naWNfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uX0Zsb3dfTG9naWNzID0gdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKSkgdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2siLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9ja1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRmxvd3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19GbG93cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0Zsb3dzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRWxlbWVudF9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrX0VsZW1lbnRfTWFwcGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19FbGVtZW50X01hcHBpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRWxlbWVudF9NYXBwaW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2tfRWxlbWVudF9NYXBwaW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmJsb2NrX0Zsb3dfU25hcHNob3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2tfRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93X1NuYXBzaG90cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfU25hcHNob3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9ja19GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N5c19uYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93LmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2xvZ2ljLmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ibG9ja19FbGVtZW50X01hcHBpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZWxlbWVudF9tYXBwaW5nLmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93X1NuYXBzaG90cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3NuYXBzaG90LmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdHN5c19uYW1lOiBvYmouZ2V0VmFsdWUoXCJzeXNfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19GbG93cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRmxvd3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrX0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5ibG9ja19GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5ibG9ja19GbG93X1NuYXBzaG90cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfQmxvY2tcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJsb2NrX0Zsb3dzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrX0Zsb3dzID0gdGhpcy5ibG9ja19GbG93cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYmxvY2tfRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2tfRmxvd19Mb2dpY3MgPSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5ibG9ja19FbGVtZW50X01hcHBpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MgPSB0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJsb2NrX0Zsb3dfU25hcHNob3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrX0Zsb3dfU25hcHNob3RzID0gdGhpcy5ibG9ja19GbG93X1NuYXBzaG90cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfYmxvY2snLCBbJyonXSlbJ3N5c19odWJfZmxvd19ibG9jayddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2Jsb2NrJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfYmxvY2snLCBbJyonXSlbJ3N5c19odWJfZmxvd19ibG9jayddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfYmxvY2snKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJvYmouYmxvY2tfRmxvd3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0Zsb3dzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0Zsb3dzKSkgdGhpcy5ibG9ja19GbG93cyhvYmouYmxvY2tfRmxvd3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIm9iai5ibG9ja19GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYmxvY2tfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRmxvd19Mb2dpY3MpKSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKG9iai5ibG9ja19GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncykpIHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncyhvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJvYmouYmxvY2tfRmxvd19TbmFwc2hvdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzKSkgdGhpcy5ibG9ja19GbG93X1NuYXBzaG90cyhvYmouYmxvY2tfRmxvd19TbmFwc2hvdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X2Jsb2NrJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19ibG9jaycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2Jsb2NrJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1RyYW5zZm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0udHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2Rlc2NyaXB0aW9uJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9waWxsX2NvbXBvdW5kLnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbi50cmFuc2Zvcm1fZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGRlc2NyaXB0aW9uOiBvYmouZ2V0VmFsdWUoXCJkZXNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmxhYmVsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouZGVzY3JpcHRpb24pKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRyYW5zZm9ybVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LmRlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmRlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyA9IHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyA9IHRoaXMudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSkgdGhpcy50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMob2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKSkgdGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyhvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5kZWZpbml0aW9uX0Zsb3dfRGF0YXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uX0Zsb3dfRGF0YXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uX0Zsb3dfRGF0YXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uX0Zsb3dfRGF0YXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlZmluaXRpb25fRmxvd19EYXRhcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19mbG93X2RhdGEuZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRhdGFfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uX0Zsb3dfRGF0YXMgPSB0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlZmluaXRpb25fRmxvd19EYXRhczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykpIHRoaXMuZGVmaW5pdGlvbl9GbG93X0RhdGFzKG9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24gZXh0ZW5kcyBzaHNfYXJiZndfVGFzayB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1ZlcnNpb25fSGlzdG9yeXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9WZXJzaW9uX0hpc3RvcnlzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fU29sdXRpb25fU2VjdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gLypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3RvRVF1ZXJ5LmNhbGwodGhpcywgKi8gc3VwZXIuX3RvRVF1ZXJ5KHNQYXRoKSB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdudW1iZXInICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdzaG9ydF9kZXNjcmlwdGlvbicgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeS5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbi5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4LmRlc2lnbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl9mcm9tRG9jdW1lbnQuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyLl9mcm9tRG9jdW1lbnQob2JqKVxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRudW1iZXI6IG9iai5nZXRWYWx1ZShcIm51bWJlclwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzaG9ydF9kZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwic2hvcnRfZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubnVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5udW1iZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNob3J0X2Rlc2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5zaG9ydF9kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMobmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9EZXNpZ25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSAvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5fdG9Eb2N1bWVudC5jYWxsKHRoaXMsICovIHN1cGVyLl90b0RvY3VtZW50KGFyRmllbGRzKSB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm51bWJlciA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNob3J0X2Rlc2NyaXB0aW9uID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMgPSB0aGlzLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zID0gdGhpcy5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyA9IHRoaXMuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpO1xuXG5cdFx0LypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3VuaXF1ZS5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIuX3VuaXF1ZShrZXlzLCByZXQpXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJudW1iZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzaG9ydF9kZXNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nKTtcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl9xdWVyeS5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIuX3F1ZXJ5KGdxKVxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbnVtYmVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ251bWJlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbnVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ251bWJlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2hvcnRfZGVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2hvcnRfZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Nob3J0X2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Nob3J0X2Rlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSkgdGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyhvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG9iai5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIm9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In1d",
	"cluster": "APISERVER",
	"topic": "apiserver.shs_arbfw",
	"direction": "input",
	"state": "ready",
	"sender": "apiserver.shs_arbfw",
	"recipient": "instance_name",
	"__keys": ["code", "name", "cluster", "topic", "direction", "sender", "recipient", "responseTo"],
	"active": true,
	"enabled": true,
	"__trMap": []
}