{
	"Id": "42cc1320deea26ad45b96124dbae1c8670a88e87",
	"code": "shs_arbfw_appd_Script_File",
	"date": "2025-06-28T07:32:49.748Z",
	"name": "store",
	"remark": "W3siYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJfX2NvbnN1bWVyIjoiXG4gICAgKGZ1bmN0aW9uKHMpe1xuXHQvLyBncy5pbmZvKHMuYXBpX25hbWUgKyAnOiAnICsgcy5zeXNfaWQpO1xuXG5cdHZhciBzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRzZ3IuYWRkUXVlcnkoJ25hbWUnLCAnPScsIHMubmFtZSk7XG5cdHNnci5xdWVyeSgpO1xuXHRpZiAoIXNnci5uZXh0KCkpIHNnciA9IG5ldyBHbGlkZVJlY29yZChzZ3IuZ2V0VGFibGVOYW1lKCkpO1xuXHRPYmplY3Qua2V5cyhzKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBrLmluZGV4T2YoJ19fJykgPCAwO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRzZ3Iuc2V0VmFsdWUoaywgc1trXSk7XG5cdH0pO1xuXHRzZ3IudXBkYXRlKCk7XG5cdFxuXHR2YXIgZXNnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblx0ZXNnci5hZGRRdWVyeSgnaWQnLCBzZ3Iuc3lzX2lkKTtcblx0ZXNnci5hZGRRdWVyeSgndGFibGUnLCAnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cdGVzZ3IucXVlcnkoKTtcblx0aWYoIWVzZ3IubmV4dCgpKSBlc2dyID0gbmV3IEdsaWRlUmVjb3JkKGVzZ3IuZ2V0VGFibGVOYW1lKCkpO1xuXHRlc2dyLnNldFZhbHVlKCdpZCcsIHNnci5zeXNfaWQpO1xuXHRlc2dyLnNldFZhbHVlKCd0YWJsZScsICdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0ZXNnci5zZXRWYWx1ZSgndXNlX2VzX2xhdGVzdCcsIHRydWUpO1xuXHRlc2dyLnVwZGF0ZSgpO1xuXHRcblx0aWYoIXMuZGVzY3JpcHRpb24pIHJldHVybjtcblxuICAgIHZhciBvVGFibGUgPSBKU09OLnBhcnNlKHMuZGVzY3JpcHRpb24pO1xuXG4gICAgdmFyIHQgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kYl9vYmplY3QnKTtcbiAgICB0LmFkZFF1ZXJ5KCduYW1lJywgb1RhYmxlLm5hbWUpO1xuICAgIHQuc2V0TGltaXQoMSk7XG4gICAgdC5xdWVyeSgpO1xuICAgIGlmKHQubmV4dCgpKXtcbiAgICAgICAgb1RhYmxlLklkID0gdC5zeXNfaWQudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICB2YXIgc2MgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY29wZScpO1xuICAgIHNjLmdldCgnc2NvcGUnLCAnJyk7XG5cbiAgICBpZih0LnN5c19zY29wZS5zY29wZT09Jycpe1xuICAgICAgICB2YXIgYWNsT3BzID0ge3JlYWQ6ICdmaW5kJywgd3JpdGU6ICd1cGRhdGUnLCBjcmVhdGU6ICdpbnNlcnQnLyosIGRlbGV0ZTogJycsIGV4ZWN1dGU6ICcnKi99O1xuICAgICAgICBPYmplY3Qua2V5cyhhY2xPcHMpLmZvckVhY2goZnVuY3Rpb24oYWspe1xuICAgICAgICAgICAgdmFyIGFjbCA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X2FjbCcpO1xuICAgICAgICAgICAgdmFyIG9BQ0wgPSB7YWN0aXZlOiB0cnVlLCBhZG1pbl9vdmVycmlkZXM6IGZhbHNlLCBhZHZhbmNlZDogdHJ1ZSwgbmFtZTogb1RhYmxlLm5hbWUrJy4qJyxcbiAgICAgICAgICAgICAgICBzY3JpcHQ6ICdhbnN3ZXIgPSBuZXcgJyArIHMubmFtZSArICcoKS5fZnJvbUdsaWRlUmVjb3JkKGN1cnJlbnQpLl8nICsgYWNsT3BzW2FrXSArICdBc3NlcnQoKTsnLFxuICAgICAgICAgICAgICAgIGRlY2lzaW9uX3R5cGU6ICdhbGxvdycsIHR5cGU6ICdyZWNvcmQnLCBvcGVyYXRpb246IGFrLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQWxsb3cgJyArIGFrICsgJyBmb3IgYWxsIGZpZWxkcyBpbiAnICsgb1RhYmxlLmxhYmVsICsgJygnICsgb1RhYmxlLm5hbWUgKyAnKSwgaWYgdGhlIEFDTCBzY3JpcHQgYW5zd2VycyB0cnVlLid9O1xuICAgICAgICAgICAgYWNsLmFkZFF1ZXJ5KCduYW1lJywgb0FDTC5uYW1lKTtcbiAgICAgICAgICAgIGFjbC5hZGRRdWVyeSgnb3BlcmF0aW9uJywgb0FDTC5vcGVyYXRpb24pO1xuICAgICAgICAgICAgYWNsLmFkZFF1ZXJ5KCd0eXBlJywgb0FDTC50eXBlKTtcbiAgICAgICAgICAgIGFjbC5zZXRMaW1pdCgxKTtcbiAgICAgICAgICAgIGFjbC5xdWVyeSgpO1xuICAgICAgICAgICAgaWYoIWFjbC5uZXh0KCkpIGFjbCA9IG5ldyBHbGlkZVJlY29yZChhY2wuZ2V0VGFibGVOYW1lKCkpO1xuICAgICAgICAgICAgT2JqZWN0LmtleXMob0FDTCkuZm9yRWFjaChmdW5jdGlvbihrKXthY2wuc2V0VmFsdWUoaywgb0FDTFtrXSk7fSk7XG4gICAgICAgICAgICBhY2wudXBkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdmFyIGJyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0Jyk7XG4gICAgICAgIGJyLmFkZFF1ZXJ5KCdjb2xsZWN0aW9uJywgb1RhYmxlLm5hbWUpO1xuICAgICAgICBici5hZGRRdWVyeSgnc3lzX3Njb3BlJywgc2Muc3lzX2lkKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ3doZW4nLCAnYmVmb3JlJyk7XG4gICAgICAgIGJyLmFkZFF1ZXJ5KCduYW1lJywgb1RhYmxlLmxhYmVsICsgJyBhc3NlcnRpb24nKTtcbiAgICAgICAgYnIuc2V0TGltaXQoMSk7XG4gICAgICAgIGJyLnF1ZXJ5KCk7XG4gICAgICAgIC8vZ3MuaW5mbyhcImJyIGNvdW50OiBcIiArIGJyLmdldFJvd0NvdW50KCkgKyBcIiwgcXVlcnk6IFwiICsgYnIuZ2V0RW5jb2RlZFF1ZXJ5KCkpO1xuICAgICAgICBpZighYnIubmV4dCgpKSBiciA9IG5ldyBHbGlkZVJlY29yZChici5nZXRUYWJsZU5hbWUoKSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdhY3RpdmUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2NvbGxlY3Rpb24nLCBvVGFibGUubmFtZSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdzeXNfc2NvcGUnLCBzYy5zeXNfaWQpO1xuICAgICAgICBici5zZXRWYWx1ZSgnd2hlbicsICdiZWZvcmUnKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ25hbWUnLCBvVGFibGUubGFiZWwgKyAnIGFzc2VydGlvbicpO1xuICAgICAgICBici5zZXRWYWx1ZSgnZGVzY3JpcHRpb24nLCAnUnVsZSBmb3IgJyArIG9UYWJsZS5sYWJlbCArICcoJyArIG9UYWJsZS5uYW1lICsgJyksIHRvIGFzc2VydCBvcGVyYXRpb24gdmFsaWRpdHkuJyk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdhY3Rpb25faW5zZXJ0JywgdHJ1ZSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdhY3Rpb25fdXBkYXRlJywgdHJ1ZSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdhY3Rpb25fZGVsZXRlJywgdHJ1ZSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdhY3Rpb25fcXVlcnknLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2Fib3J0X2FjdGlvbicsIGZhbHNlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FkZF9tZXNzYWdlJywgdHJ1ZSk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdtZXNzYWdlJywgJ09wZXJhdGlvbiBhYm9ydGVkOiBhc3NlcnRpb24gZmFpbGVkJyk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdzY3JpcHQnLCAnY3VycmVudC5zZXRBYm9ydEFjdGlvbighbmV3ICcgKyBzLm5hbWUgKyAnKCkuX2Zyb21HbGlkZVJlY29yZChjdXJyZW50KVtcIl9cIiArICh7aW5zZXJ0OiBcImluc2VydFwiLCB1cGRhdGU6IFwidXBkYXRlXCIsIHF1ZXJ5OiBcImZpbmRcIiwgZGVsZXRlOiBcInVwZGF0ZVwifSlbY3VycmVudC5vcGVyYXRpb24oKSB8fCBcImluc2VydFwiXSArIFwiQXNzZXJ0XCJdKCkpOycpO1xuICAgICAgICBici51cGRhdGUoKTtcbiAgICB9XG4gICAgXG4gICAgaWYodC5pc1ZhbGlkUmVjb3JkKCkpIHJldHVybjtcblxuICAgIHQgPSBuZXcgR2xpZGVSZWNvcmQodC5nZXRUYWJsZU5hbWUoKSk7XG4gICAgdC5zZXROZXdHdWlkVmFsdWUob1RhYmxlLklkKTtcbiAgICBbJ25hbWUnLCAnbGFiZWwnLCAnc3lzX25hbWUnXS5mb3JFYWNoKGZ1bmN0aW9uKGYpe3Quc2V0VmFsdWUoZiwgb1RhYmxlW2ZdKTt9KTtcbiAgICB0LnN5c19zY29wZSA9IHNjLnN5c19pZDtcbiAgICBpZihvVGFibGUuc3VwZXJfY2xhc3MpIHtcbiAgICAgICAgdmFyIHN1cGVyX2NsYXNzID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG4gICAgICAgIHN1cGVyX2NsYXNzLmdldCgnbmFtZScsIG9UYWJsZS5zdXBlcl9jbGFzcyk7XG4gICAgICAgIGlmKHN1cGVyX2NsYXNzLmlzVmFsaWRSZWNvcmQoKSkgdC5zZXRWYWx1ZSgnc3VwZXJfY2xhc3MnLCBzdXBlcl9jbGFzcy5zeXNfaWQpO1xuICAgIH1cbiAgICBncy5pbmZvKCdjcmVhdGluZyB0YWJsZTogJyArIG9UYWJsZS5uYW1lICsgXCIgIC0gXCIgKyBzLnN5c19pZCk7XG4gICAgXG4gICAgdC5pbnNlcnQoKTtcbiAgICBcbiAgICBvVGFibGUuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGMpe1xuICAgICAgICB2YXIgZ3JjID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGljdGlvbmFyeScpO1xuICAgICAgICBPYmplY3Qua2V5cyhjKS5mb3JFYWNoKGZ1bmN0aW9uKGYpe2dyYy5zZXRWYWx1ZShmLCBjW2ZdKTt9KTtcbiAgICAgICAgZ3JjLmluc2VydCgpO1xuICAgIH0pO1xuICAgIFxuXHR9KVxuICAgICIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhbHVlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92YWx1ZSA9IHY7XG5cdFx0XHR0aGlzLl92YWx1ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YWx1ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5pbnN0YW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnN0YW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmFjdGlvbklucHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uSW5wdXQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbklucHV0ID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbklucHV0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmZsb3dJbnB1dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dJbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvd0lucHV0ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dJbnB1dF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93SW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUubWFwcGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hcHBpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hcHBpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWFwcGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYXBwaW5nO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhbHVlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndmFsdWUnICsgKHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nKSArIHRoaXMudmFsdWUoKTtcblxuXHRcdGlmICh0aGlzLl9pbnN0YW5jZSkgcmV0ICs9IC8qKHRoaXMuX2luc3RhbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuaW5zdGFuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAnaW5zdGFuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb25JbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uSW5wdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uSW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvd0lucHV0KSByZXQgKz0gLyoodGhpcy5fZmxvd0lucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvd0lucHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3dJbnB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl9tYXBwaW5nKSByZXQgKz0gLyoodGhpcy5fbWFwcGluZ19jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWFwcGluZy4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlZhcmlhYmxlX1ZhbHVlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHR2YWx1ZTogb2JqLmdldFZhbHVlKFwidmFsdWVcIiksXG5cblx0XHRcdFx0XHRpbnN0YW5jZTogb2JqLmdldFZhbHVlKFwiaW5zdGFuY2VcIiksXG5cblx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdGFjdGlvbklucHV0OiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25JbnB1dFwiKSxcblxuXHRcdFx0XHRcdGZsb3dJbnB1dDogb2JqLmdldFZhbHVlKFwiZmxvd0lucHV0XCIpLFxuXG5cdFx0XHRcdFx0bWFwcGluZzogb2JqLmdldFZhbHVlKFwibWFwcGluZ1wiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy52YWx1ZShTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnZhbHVlKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy52YWx1ZShvYmoudmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5pbnN0YW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3Rpb25JbnB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uSW5wdXQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmZsb3dJbnB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dJbnB1dCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1hcHBpbmcobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm1hcHBpbmcpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJWYXJpYWJsZV9WYWx1ZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudmFsdWUgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC52YWx1ZSkgPT09ICdvYmplY3QnKSByZXQudmFsdWUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQudmFsdWUpKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0aWYgKHJldC5pbnN0YW5jZSkge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gcmV0Lmluc3RhbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdGlmIChyZXQuYWN0aW9uKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbklucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aW9uSW5wdXQgPSB0aGlzLmFjdGlvbklucHV0KCk7XG5cblx0XHRpZiAocmV0LmFjdGlvbklucHV0KSB7XG5cdFx0XHRyZXQuYWN0aW9uSW5wdXQgPSByZXQuYWN0aW9uSW5wdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbklucHV0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb25JbnB1dCkubGVuZ3RoKSByZXQuYWN0aW9uSW5wdXQgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93SW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5mbG93SW5wdXQgPSB0aGlzLmZsb3dJbnB1dCgpO1xuXG5cdFx0aWYgKHJldC5mbG93SW5wdXQpIHtcblx0XHRcdHJldC5mbG93SW5wdXQgPSByZXQuZmxvd0lucHV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5mbG93SW5wdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3dJbnB1dCkubGVuZ3RoKSByZXQuZmxvd0lucHV0ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1hcHBpbmcgPSB0aGlzLm1hcHBpbmcoKTtcblxuXHRcdGlmIChyZXQubWFwcGluZykge1xuXHRcdFx0cmV0Lm1hcHBpbmcgPSByZXQubWFwcGluZy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQubWFwcGluZykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWFwcGluZykubGVuZ3RoKSByZXQubWFwcGluZyA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidmFsdWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy52YWx1ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52YWx1ZSh0aGlzLnZhbHVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImluc3RhbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuaW5zdGFuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2UodGhpcy5pbnN0YW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uSW5wdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb25JbnB1dCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25JbnB1dCh0aGlzLmFjdGlvbklucHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93SW5wdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93SW5wdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd0lucHV0KHRoaXMuZmxvd0lucHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYXBwaW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFwcGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXBwaW5nKHRoaXMubWFwcGluZygpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl92YWx1ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFsdWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2YWx1ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd2YWx1ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhbHVlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJpbnN0YW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJpbnN0YW5jZVtpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnN0YW5jZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2luc3RhbmNlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW5zdGFuY2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW5zdGFuY2UnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uSW5wdXRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uSW5wdXQoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiYWN0aW9uSW5wdXQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwiYWN0aW9uSW5wdXRbYWN0aW9uSW5wdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uSW5wdXQoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb25pbnB1dCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbmlucHV0Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbmlucHV0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uaW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93SW5wdXRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZmxvd0lucHV0KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcImZsb3dJbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJmbG93SW5wdXRbZmxvd0lucHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3dJbnB1dCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3dpbnB1dCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3dpbnB1dCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93aW5wdXQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93aW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbWFwcGluZ19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5tYXBwaW5nKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcIm1hcHBpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwibWFwcGluZ1ttYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1hcHBpbmcoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYXBwaW5nJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFwcGluZycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYXBwaW5nJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFwcGluZycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfdmFyaWFibGVfdmFsdWUnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19BZ2VuZGFfSXRlbSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfQWdlbmRhX0l0ZW0iLCJuYW1lIjoic2hzX2FyYmZ3X0FnZW5kYV9JdGVtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19BZ2VuZGFfSXRlbVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uYWdlbmRhIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWdlbmRhKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hZ2VuZGEgPSB2O1xuXHRcdFx0dGhpcy5fYWdlbmRhX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FnZW5kYTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5yZXF1aXJlbWVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlcXVpcmVtZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudCA9IHY7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZXF1aXJlbWVudDtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hZ2VuZGEpIHJldCArPSAvKih0aGlzLl9hZ2VuZGFfY29vcCB8fCAnPScpICsgKi8gdGhpcy5hZ2VuZGEoKS5fdG9FUXVlcnkoc1BhdGggKyAnYWdlbmRhLicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlcXVpcmVtZW50KSByZXQgKz0gLyoodGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZXF1aXJlbWVudCgpLl90b0VRdWVyeShzUGF0aCArICdyZXF1aXJlbWVudC4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJBZ2VuZGFfSXRlbVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfQWdlbmRhX0l0ZW1cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRhZ2VuZGE6IG9iai5nZXRWYWx1ZShcImFnZW5kYVwiKSxcblxuXHRcdFx0XHRcdHJlcXVpcmVtZW50OiBvYmouZ2V0VmFsdWUoXCJyZXF1aXJlbWVudFwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hZ2VuZGEpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hZ2VuZGEobmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQob2JqLmFnZW5kYSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZXF1aXJlbWVudChuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJBZ2VuZGFfSXRlbVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlXG5cblx0XHQmJlxuXHRcdCgoZnVuY3Rpb24oKSB7XG5cdFx0XHR0cnkge1xuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2luc2VydEFzc2VydCgpOiBcIiArIFwiRXhjZXB0aW9uIGluIF9pbnNlcnRBc3NlcnQ6OigpOiBcIiArIGV4LmdldE1lc3NhZ2UoKSk7XG5cdFx0XHR9XG5cdFx0fSkodGhpcykpO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZVxuXG5cdFx0JiZcblx0XHQoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zdG9yZUFzc2VydCgpOiBcIiArIFwiRXhjZXB0aW9uIGluIF9zdG9yZUFzc2VydDo6KCk6IFwiICsgZXguZ2V0TWVzc2FnZSgpKTtcblx0XHRcdH1cblx0XHR9KSh0aGlzKSk7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWdlbmRhKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWdlbmRhID0gdGhpcy5hZ2VuZGEoKTtcblxuXHRcdGlmIChyZXQuYWdlbmRhKSB7XG5cdFx0XHRyZXQuYWdlbmRhID0gcmV0LmFnZW5kYS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYWdlbmRhKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hZ2VuZGEpLmxlbmd0aCkgcmV0LmFnZW5kYSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVxdWlyZW1lbnQgPSB0aGlzLnJlcXVpcmVtZW50KCk7XG5cblx0XHRpZiAocmV0LnJlcXVpcmVtZW50KSB7XG5cdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlcXVpcmVtZW50KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZXF1aXJlbWVudCkubGVuZ3RoKSByZXQucmVxdWlyZW1lbnQgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hZ2VuZGEodGhpcy5hZ2VuZGEoKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhZ2VuZGFcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hZ2VuZGEoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhKHRoaXMuYWdlbmRhKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZXF1aXJlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlcXVpcmVtZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50KHRoaXMucmVxdWlyZW1lbnQoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hZ2VuZGEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWdlbmRhX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFnZW5kYSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBZ2VuZGEgSXRlbVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJhZ2VuZGEgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIiArIFwiYWdlbmRhW2FnZW5kYV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hZ2VuZGEoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhZ2VuZGEnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhZ2VuZGEnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWdlbmRhJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWdlbmRhJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBZ2VuZGEgSXRlbVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJyZXF1aXJlbWVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiICsgXCJyZXF1aXJlbWVudFtyZXF1aXJlbWVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1aXJlbWVudCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlcXVpcmVtZW50JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZXF1aXJlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc3ViZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YmZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3N1YmZsb3cgPSB2O1xuXHRcdFx0dGhpcy5fc3ViZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJmbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldCArPSAvKih0aGlzLl9wYXJlbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wYXJlbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50LicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9zdWJmbG93KSByZXQgKz0gLyoodGhpcy5fc3ViZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnc3ViZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnN0YW5jZV9JbnB1dC5pbnN0YW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllWYXJpYWJsZV9WYWx1ZS5pbnN0YW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0luc3RhbmNlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0cGFyZW50OiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRzdWJmbG93OiBvYmouZ2V0VmFsdWUoXCJzdWJmbG93XCIpLFxuXG5cdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5wYXJlbnQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zdWJmbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc3ViZmxvdykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5zdGFuY2VcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucGFyZW50ID0gdGhpcy5wYXJlbnQoKTtcblxuXHRcdGlmIChyZXQucGFyZW50KSB7XG5cdFx0XHRyZXQucGFyZW50ID0gcmV0LnBhcmVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucGFyZW50KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wYXJlbnQpLmxlbmd0aCkgcmV0LnBhcmVudCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdWJmbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc3ViZmxvdyA9IHRoaXMuc3ViZmxvdygpO1xuXG5cdFx0aWYgKHJldC5zdWJmbG93KSB7XG5cdFx0XHRyZXQuc3ViZmxvdyA9IHJldC5zdWJmbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zdWJmbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zdWJmbG93KS5sZW5ndGgpIHJldC5zdWJmbG93ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdGlmIChyZXQuc25hcHNob3QpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGFyZW50XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGFyZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudCh0aGlzLnBhcmVudCgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdWJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3ViZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdWJmbG93KHRoaXMuc3ViZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwicGFyZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXJlbnQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fc3ViZmxvd19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zdWJmbG93KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJzdWJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwic3ViZmxvd1tzdWJmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnN1YmZsb3coKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdWJmbG93JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdWJmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1YmZsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdWJmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcyhvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5pbnN0YW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnN0YW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbGVuZ3RoID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiAoe1xuXHRcdFx0XHRcdFx0XCJTdHJpbmdcIjogMjU1LFxuXHRcdFx0XHRcdFx0XCJUZXh0XCI6IDQwMDAsXG5cdFx0XHRcdFx0fSlbdGhpcy50eXBlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuTW9kZWxfSUQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9JRCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5Nb2RlbF9JRCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3ZTNCd1lYUm9mWDB1WDE5MGVYQmxQVDBuYzNselgzWmhjbWxoWW14bFgzWmhiSFZsSnlBbUppQjdlMTlmZlgwdWMzVmlabXh2ZHlrL2UzdGZYMzE5TG5OMVltWnNiM2N1U1dRNmUzdHdjR0YwYUgxOUxrbGtLVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UEZzcUtsdG1iRzkzWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVczTnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhWMHVjM1ZpWm14dmR5NUpaQ3dnS2lwYllXTjBhVzl1WDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRoWTNScGIyNUpibkIxZEZ0dGIyUmxiRjlwWkQwbmUzdHBaSDE5SjExZFhTNTdYQ0pKWkZ3aU9pQmNJbDltZTJkekxtbHVabThvWDNSdlUzUnlhVzVuSUNzZ0p6b2dSa2xLVTA5T09pQW5JQ3NnU2xOUFRpNXpkSEpwYm1kcFpua29jbVZtY3k1dFlXNTVVbVZtY3lrcGZWd2lmUzVKWkYxYk1GMCtQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lk1vZGVsX1RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfVGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5BdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdEF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9BdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5faW5zdGFuY2UpIHJldCArPSAvKih0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmluc3RhbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2luc3RhbmNlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0luc3RhbmNlX0lucHV0XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXRcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRpbnN0YW5jZTogb2JqLmdldFZhbHVlKFwiaW5zdGFuY2VcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50eXBlKG9iai50eXBlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmluc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuaW5zdGFuY2UobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5pbnN0YW5jZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5zdGFuY2VfSW5wdXRcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0aWYgKHJldC5pbnN0YW5jZSkge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gcmV0Lmluc3RhbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMubGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX0lEKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX0lEID0gdGhpcy5Nb2RlbF9JRCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9UYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9UYWJsZSA9IHRoaXMuTW9kZWxfVGFibGUoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuQXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5BdHRyaWJ1dGVzID0gdGhpcy5BdHRyaWJ1dGVzKCk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnN0YW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnN0YW5jZSh0aGlzLmluc3RhbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmluc3RhbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmluc3RhbmNlKHRoaXMuaW5zdGFuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZSBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwiaW5zdGFuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJpbnN0YW5jZVtpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnN0YW5jZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2luc3RhbmNlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2luc3RhbmNlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cyddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2VcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGFyZW50KSByZXQgKz0gLyoodGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGFyZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3BhcmVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZhcmlhYmxlX1ZhbHVlLmFjdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkFjdGlvbl9JbnN0YW5jZVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2VcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRwYXJlbnQ6IG9iai5nZXRWYWx1ZShcInBhcmVudFwiKSxcblxuXHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5wYXJlbnQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX0luc3RhbmNlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5wYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHJldC5wYXJlbnQpIHtcblx0XHRcdHJldC5wYXJlbnQgPSByZXQucGFyZW50Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudCkubGVuZ3RoKSByZXQucGFyZW50ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGlvbiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uKS5sZW5ndGgpIHJldC5hY3Rpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInBhcmVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInBhcmVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGFyZW50Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiQWN0aW9uIEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5wbHVyYWwgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbHVyYWwodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3BsdXJhbCA9IHY7XG5cdFx0XHR0aGlzLl9wbHVyYWxfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGx1cmFsO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmxhbmd1YWdlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGFuZ3VhZ2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2xhbmd1YWdlID0gdjtcblx0XHRcdHRoaXMuX2xhbmd1YWdlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xhbmd1YWdlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmlucHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5wdXQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2lucHV0ID0gdjtcblx0XHRcdHRoaXMuX2lucHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2lucHV0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLm91dHB1dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG91dHB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3V0cHV0ID0gdjtcblx0XHRcdHRoaXMuX291dHB1dF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vdXRwdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwudmFyaWFibGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2YXJpYWJsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdmFyaWFibGUgPSB2O1xuXHRcdFx0dGhpcy5fdmFyaWFibGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmFyaWFibGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuY29sdW1uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29sdW1uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4gPSB2O1xuXHRcdFx0dGhpcy5fY29sdW1uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbHVtbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wbHVyYWwpIHJldCArPSAnXicgKyBzUGF0aCArICdwbHVyYWwnICsgKHRoaXMuX3BsdXJhbF9jb29wIHx8ICc9JykgKyB0aGlzLnBsdXJhbCgpO1xuXG5cdFx0aWYgKHRoaXMuX2xhbmd1YWdlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFuZ3VhZ2UnICsgKHRoaXMuX2xhbmd1YWdlX2Nvb3AgfHwgJz0nKSArIHRoaXMubGFuZ3VhZ2UoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5faW5wdXQpIHJldCArPSAvKih0aGlzLl9pbnB1dF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmlucHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2lucHV0LicpO1xuXG5cdFx0aWYgKHRoaXMuX291dHB1dCkgcmV0ICs9IC8qKHRoaXMuX291dHB1dF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm91dHB1dCgpLl90b0VRdWVyeShzUGF0aCArICdvdXRwdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fdmFyaWFibGUpIHJldCArPSAvKih0aGlzLl92YXJpYWJsZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnZhcmlhYmxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3ZhcmlhYmxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2NvbHVtbikgcmV0ICs9IC8qKHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmNvbHVtbigpLl90b0VRdWVyeShzUGF0aCArICdjb2x1bW4uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGaWVsZF9MYWJlbFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbFwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0cGx1cmFsOiBvYmouZ2V0VmFsdWUoXCJwbHVyYWxcIiksXG5cblx0XHRcdFx0XHRsYW5ndWFnZTogb2JqLmdldFZhbHVlKFwibGFuZ3VhZ2VcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRpbnB1dDogb2JqLmdldFZhbHVlKFwiaW5wdXRcIiksXG5cblx0XHRcdFx0XHRvdXRwdXQ6IG9iai5nZXRWYWx1ZShcIm91dHB1dFwiKSxcblxuXHRcdFx0XHRcdHZhcmlhYmxlOiBvYmouZ2V0VmFsdWUoXCJ2YXJpYWJsZVwiKSxcblxuXHRcdFx0XHRcdGNvbHVtbjogb2JqLmdldFZhbHVlKFwiY29sdW1uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbHVyYWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5wbHVyYWwob2JqLnBsdXJhbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYW5ndWFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmxhbmd1YWdlKG9iai5sYW5ndWFnZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmlucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouaW5wdXQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm91dHB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm91dHB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG9iai5vdXRwdXQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudmFyaWFibGUobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai52YXJpYWJsZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29sdW1uKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW4pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGaWVsZF9MYWJlbFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3BsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnBsdXJhbCA9IHRoaXMucGx1cmFsKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5sYW5ndWFnZSA9IHRoaXMubGFuZ3VhZ2UoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5faW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5pbnB1dCA9IHRoaXMuaW5wdXQoKTtcblxuXHRcdGlmIChyZXQuaW5wdXQpIHtcblx0XHRcdHJldC5pbnB1dCA9IHJldC5pbnB1dC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuaW5wdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmlucHV0KS5sZW5ndGgpIHJldC5pbnB1dCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX291dHB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm91dHB1dCA9IHRoaXMub3V0cHV0KCk7XG5cblx0XHRpZiAocmV0Lm91dHB1dCkge1xuXHRcdFx0cmV0Lm91dHB1dCA9IHJldC5vdXRwdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0Lm91dHB1dCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQub3V0cHV0KS5sZW5ndGgpIHJldC5vdXRwdXQgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl92YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnZhcmlhYmxlID0gdGhpcy52YXJpYWJsZSgpO1xuXG5cdFx0aWYgKHJldC52YXJpYWJsZSkge1xuXHRcdFx0cmV0LnZhcmlhYmxlID0gcmV0LnZhcmlhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC52YXJpYWJsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudmFyaWFibGUpLmxlbmd0aCkgcmV0LnZhcmlhYmxlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29sdW1uID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdGlmIChyZXQuY29sdW1uKSB7XG5cdFx0XHRyZXQuY29sdW1uID0gcmV0LmNvbHVtbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuY29sdW1uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5jb2x1bW4pLmxlbmd0aCkgcmV0LmNvbHVtbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxhbmd1YWdlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxhbmd1YWdlKHRoaXMubGFuZ3VhZ2UoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInBsdXJhbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBsdXJhbCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wbHVyYWwodGhpcy5wbHVyYWwoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibGFuZ3VhZ2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5sYW5ndWFnZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sYW5ndWFnZSh0aGlzLmxhbmd1YWdlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW5wdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5pbnB1dCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnB1dCh0aGlzLmlucHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvdXRwdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vdXRwdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3V0cHV0KHRoaXMub3V0cHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YXJpYWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhcmlhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhcmlhYmxlKHRoaXMudmFyaWFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvbHVtblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvbHVtbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2x1bW4odGhpcy5jb2x1bW4oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RvY3VtZW50YXRpb24nLCBbJyonXSlbJ3N5c19kb2N1bWVudGF0aW9uJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2RvY3VtZW50YXRpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wbHVyYWwpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcGx1cmFsX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9wbHVyYWxfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5wbHVyYWwoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwbHVyYWwnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbHVyYWwnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGx1cmFsJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGx1cmFsJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9sYW5ndWFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9sYW5ndWFnZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbGFuZ3VhZ2VfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5sYW5ndWFnZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhbmd1YWdlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFuZ3VhZ2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFuZ3VhZ2UnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYW5ndWFnZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2lucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmlucHV0KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImlucHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIgKyBcImlucHV0W2lucHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmlucHV0KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW5wdXQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnB1dCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnB1dCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2lucHV0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vdXRwdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3V0cHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm91dHB1dCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJvdXRwdXQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwib3V0cHV0W291dHB1dF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5vdXRwdXQoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvdXRwdXQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvdXRwdXQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3V0cHV0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3V0cHV0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl92YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl92YXJpYWJsZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy52YXJpYWJsZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ2YXJpYWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJ2YXJpYWJsZVt2YXJpYWJsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy52YXJpYWJsZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZhcmlhYmxlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2YXJpYWJsZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwiY29sdW1uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIgKyBcImNvbHVtbltjb2x1bW5dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY29sdW1uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29sdW1uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvbHVtbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2RvY3VtZW50YXRpb24nKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZG9jdW1lbnRhdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubG9naWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbG9naWMgPSB2O1xuXHRcdFx0dGhpcy5fbG9naWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9naWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZFRhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZWRUYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3JlZmVyZW5jZWRUYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZFRhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyeHZaMmxqWDBac2IzZGZTVzV3ZFhSZlUyTnlhWEIwYzF0eVpXWmxjbVZ1WTJWa1gzUmhZbXhsUFZ3aWUzdHBaSDE5WENKZFhTNXdZWEpsYm5SZlFXTjBhVzl1WDBsdWMzUmhibU5sY3lrL0ozTjVjMTlvZFdKZllXTjBhVzl1WDJsdWMzUmhibU5sSnpvbmMzbHpYMmgxWWw5bWJHOTNYMnh2WjJsakp6NCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9sb2dpYykgcmV0ICs9IC8qKHRoaXMuX2xvZ2ljX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubG9naWMoKS5fdG9FUXVlcnkoc1BhdGggKyAnbG9naWMuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0lucHV0X1NjcmlwdFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdFwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0bG9naWM6IG9iai5nZXRWYWx1ZShcImxvZ2ljXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5sb2dpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmxvZ2ljKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmoubG9naWMpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0lucHV0X1NjcmlwdFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2xvZ2ljKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubG9naWMgPSB0aGlzLmxvZ2ljKCk7XG5cblx0XHRpZiAocmV0LmxvZ2ljKSB7XG5cdFx0XHRyZXQubG9naWMgPSByZXQubG9naWMuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmxvZ2ljKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5sb2dpYykubGVuZ3RoKSByZXQubG9naWMgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZWRUYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VkVGFibGUgPSB0aGlzLnJlZmVyZW5jZWRUYWJsZSgpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJsb2dpY1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJywgWycqJ10pWydzeXNfaHViX2lucHV0X3NjcmlwdHMnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2lucHV0X3NjcmlwdHMnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9sb2dpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9sb2dpY19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5sb2dpYygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IElucHV0IFNjcmlwdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJsb2dpYyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiICsgXCJsb2dpY1tsb2dpY10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5sb2dpYygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xvZ2ljJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbG9naWMnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbG9naWMnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsb2dpYycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2lucHV0X3NjcmlwdHMnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX0FnZW5kYVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubWVldGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lZXRpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lZXRpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmFnZW5kYV9BZ2VuZGFfSXRlbXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhZ2VuZGFfQWdlbmRhX0l0ZW1zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWdlbmRhX0FnZW5kYV9JdGVtcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHQodGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBZ2VuZGFfSXRlbS5hZ2VuZGEsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJNZWV0aW5nX0FnZW5kYVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGFcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRtZWV0aW5nOiBvYmouZ2V0VmFsdWUoXCJtZWV0aW5nXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tZWV0aW5nKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmcpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfQWdlbmRhXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRpZiAocmV0Lm1lZXRpbmcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gcmV0Lm1lZXRpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhX0FnZW5kYV9JdGVtcyA9IHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lZXRpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tZWV0aW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiTWVldGluZyBBZ2VuZGFcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwibWVldGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiICsgXCJtZWV0aW5nW21lZXRpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVldGluZygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lZXRpbmcnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lZXRpbmcnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZWV0aW5nJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwib2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpKSB0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfTWVldGluZ19NaW51dGUiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX01pbnV0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUubWVldGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lZXRpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lZXRpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX21lZXRpbmcpIHJldCArPSAvKih0aGlzLl9tZWV0aW5nX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubWVldGluZygpLl90b0VRdWVyeShzUGF0aCArICdtZWV0aW5nLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIk1lZXRpbmdfTWludXRlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19NZWV0aW5nX01pbnV0ZVwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdG1lZXRpbmc6IG9iai5nZXRWYWx1ZShcIm1lZXRpbmdcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1lZXRpbmcobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfTWludXRlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRpZiAocmV0Lm1lZXRpbmcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gcmV0Lm1lZXRpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZyh0aGlzLm1lZXRpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZWV0aW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbWVldGluZ19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIk1lZXRpbmcgTWludXRlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcIm1lZXRpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIiArIFwibWVldGluZ1ttZWV0aW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lZXRpbmcoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZWV0aW5nJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVldGluZycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVldGluZycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWNcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGVmaW5pdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlZmluaXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWZpbml0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnBhcmVudF9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50X0Zsb3dfSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfQWN0aW9uX0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpY19GbG93X0lucHV0X1NjcmlwdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldCArPSAvKih0aGlzLl9wYXJlbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wYXJlbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50LicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdGlmICh0aGlzLl9kZWZpbml0aW9uKSByZXQgKz0gLyoodGhpcy5fZGVmaW5pdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlZmluaXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVmaW5pdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0xvZ2ljLnBhcmVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlLnBhcmVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFjdGlvbl9JbnN0YW5jZS5wYXJlbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnB1dF9TY3JpcHQubG9naWMsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRmxvd19Mb2dpY1wiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHBhcmVudDogb2JqLmdldFZhbHVlKFwicGFyZW50XCIpLFxuXG5cdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdGRlZmluaXRpb246IG9iai5nZXRWYWx1ZShcImRlZmluaXRpb25cIiksXG5cblx0XHRcdFx0XHRibG9jazogb2JqLmdldFZhbHVlKFwiYmxvY2tcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kZWZpbml0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVmaW5pdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19Mb2dpY1wiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5wYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHJldC5wYXJlbnQpIHtcblx0XHRcdHJldC5wYXJlbnQgPSByZXQucGFyZW50Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudCkubGVuZ3RoKSByZXQucGFyZW50ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc25hcHNob3QgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnNuYXBzaG90KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zbmFwc2hvdCkubGVuZ3RoKSByZXQuc25hcHNob3QgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGVmaW5pdGlvbiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0aWYgKHJldC5kZWZpbml0aW9uKSB7XG5cdFx0XHRyZXQuZGVmaW5pdGlvbiA9IHJldC5kZWZpbml0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5kZWZpbml0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWZpbml0aW9uKS5sZW5ndGgpIHJldC5kZWZpbml0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfRmxvd19Mb2dpY3MgPSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudF9GbG93X0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWMnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfbG9naWMnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9wYXJlbnRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJwYXJlbnRbcGFyZW50XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmVudCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BhcmVudCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGFyZW50Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBMb2dpY1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGVmaW5pdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kZWZpbml0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJkZWZpbml0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiZGVmaW5pdGlvbltkZWZpbml0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlZmluaXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWZpbml0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWZpbml0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZWZpbml0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9ibG9ja19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Jsb2NrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X2xvZ2ljJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWMnLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpYyddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5wYXJlbnRfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGFyZW50X0Zsb3dfTG9naWNzKSkgdGhpcy5wYXJlbnRfRmxvd19Mb2dpY3Mob2JqLnBhcmVudF9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMpKSB0aGlzLnBhcmVudF9GbG93X0luc3RhbmNlcyhvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykpIHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKSkgdGhpcy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X2xvZ2ljJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfUGxhblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRmxvd19QbGFuXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dfUGxhblwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19QbGFuXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gcmV0LnNuYXBzaG90Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgUGxhblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nLCBbJyonXSlbJ3N5c19mbG93X3N1YmZsb3dfcGxhbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19QbGFuLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X1BsYW4uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nLCBbJyonXSlbJ3N5c19mbG93X3N1YmZsb3dfcGxhbiddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfUGxhbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJuYW1lIjoic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUucGVyc29uRGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGVyc29uRGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wZXJzb25EYXkgPSB2O1xuXHRcdFx0dGhpcy5fcGVyc29uRGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BlcnNvbkRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZWZmb3J0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWZmb3J0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lZmZvcnQgPSB2O1xuXHRcdFx0dGhpcy5fZWZmb3J0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VmZm9ydDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUucmVxdWlyZW1lbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnQgPSB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJvbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yb2xlID0gdjtcblx0XHRcdHRoaXMuX3JvbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZTtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wZXJzb25EYXkpIHJldCArPSAnXicgKyBzUGF0aCArICdwZXJzb25EYXknICsgKHRoaXMuX3BlcnNvbkRheV9jb29wIHx8ICc9JykgKyB0aGlzLnBlcnNvbkRheSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VmZm9ydCkgcmV0ICs9IC8qKHRoaXMuX2VmZm9ydF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmVmZm9ydCgpLl90b0VRdWVyeShzUGF0aCArICdlZmZvcnQuJyk7XG5cblx0XHRpZiAodGhpcy5fcmVxdWlyZW1lbnQpIHJldCArPSAvKih0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlcXVpcmVtZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlcXVpcmVtZW50LicpO1xuXG5cdFx0aWYgKHRoaXMuX3JvbGUpIHJldCArPSAvKih0aGlzLl9yb2xlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucm9sZSgpLl90b0VRdWVyeShzUGF0aCArICdyb2xlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJFZmZvcnRfRXN0aW1hdGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZVwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRwZXJzb25EYXk6IG9iai5nZXRWYWx1ZShcInBlcnNvbkRheVwiKSxcblxuXHRcdFx0XHRcdGVmZm9ydDogb2JqLmdldFZhbHVlKFwiZWZmb3J0XCIpLFxuXG5cdFx0XHRcdFx0cmVxdWlyZW1lbnQ6IG9iai5nZXRWYWx1ZShcInJlcXVpcmVtZW50XCIpLFxuXG5cdFx0XHRcdFx0cm9sZTogb2JqLmdldFZhbHVlKFwicm9sZVwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5wZXJzb25EYXkob2JqLnBlcnNvbkRheSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZmZvcnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lZmZvcnQobmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KG9iai5lZmZvcnQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVxdWlyZW1lbnQobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucm9sZShuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWZmb3J0X0VzdGltYXRlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcGVyc29uRGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucGVyc29uRGF5ID0gdGhpcy5wZXJzb25EYXkoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lZmZvcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lZmZvcnQgPSB0aGlzLmVmZm9ydCgpO1xuXG5cdFx0aWYgKHJldC5lZmZvcnQpIHtcblx0XHRcdHJldC5lZmZvcnQgPSByZXQuZWZmb3J0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5lZmZvcnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmVmZm9ydCkubGVuZ3RoKSByZXQuZWZmb3J0ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdGlmIChyZXQucmVxdWlyZW1lbnQpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHJldC5yZXF1aXJlbWVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yb2xlID0gdGhpcy5yb2xlKCk7XG5cblx0XHRpZiAocmV0LnJvbGUpIHtcblx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJvbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJvbGUpLmxlbmd0aCkgcmV0LnJvbGUgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGVyc29uRGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGVyc29uRGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBlcnNvbkRheSh0aGlzLnBlcnNvbkRheSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlZmZvcnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lZmZvcnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWZmb3J0KHRoaXMuZWZmb3J0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZXF1aXJlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlcXVpcmVtZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50KHRoaXMucmVxdWlyZW1lbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJvbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yb2xlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGUodGhpcy5yb2xlKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3BlcnNvbkRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGVyc29uZGF5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BlcnNvbmRheScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwZXJzb25kYXknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwZXJzb25kYXknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lZmZvcnRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZWZmb3J0KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwiZWZmb3J0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJlZmZvcnRbZWZmb3J0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVmZm9ydCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VmZm9ydCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlZmZvcnQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWZmb3J0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWZmb3J0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJFZmZvcnQgRXN0aW1hdGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInJlcXVpcmVtZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJyZXF1aXJlbWVudFtyZXF1aXJlbWVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1aXJlbWVudCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlcXVpcmVtZW50JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVxdWlyZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcm9sZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yb2xlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwicm9sZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwicm9sZVtyb2xlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJvbGUoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyb2xlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JvbGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncm9sZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JvbGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmciLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X01lZXRpbmciLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfTWVldGluZyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuc3RhcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLnN0YXJ0KCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fc3RhcnQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5lbmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0YXJ0ZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuc3RhcnRlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3N0YXJ0ZWQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdGFydGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZW5kZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmRlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLmVuZGVkKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZW5kZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5kZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zZXJpZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzZXJpZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NlcmllcyA9IHY7XG5cdFx0XHR0aGlzLl9zZXJpZXNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VyaWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcub3JnYW5pemVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JnYW5pemVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmdhbml6ZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JnYW5pemVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1vZGVyYXRvciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9kZXJhdG9yID0gdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2RlcmF0b3I7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5wcm9qZWN0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvamVjdCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5ib2FyZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ib2FyZCA9IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmRlY2lzaW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlY2lzaW9uID0gdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX0FnZW5kYXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfQWdlbmRhcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX0FnZW5kYXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfTWludXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX01pbnV0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3RhcnQnICsgKHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnQoKTtcblxuXHRcdGlmICh0aGlzLl9lbmQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmQnICsgKHRoaXMuX2VuZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuZCgpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0ZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydGVkJyArICh0aGlzLl9zdGFydGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kZWQnICsgKHRoaXMuX2VuZGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kZWQoKTtcblxuXHRcdGlmICh0aGlzLl9zZXJpZXMpIHJldCArPSAvKih0aGlzLl9zZXJpZXNfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zZXJpZXMoKS5fdG9FUXVlcnkoc1BhdGggKyAnc2VyaWVzLicpO1xuXG5cdFx0aWYgKHRoaXMuX29yZ2FuaXplcikgcmV0ICs9IC8qKHRoaXMuX29yZ2FuaXplcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9yZ2FuaXplcigpLl90b0VRdWVyeShzUGF0aCArICdvcmdhbml6ZXIuJyk7XG5cblx0XHRpZiAodGhpcy5fbW9kZXJhdG9yKSByZXQgKz0gLyoodGhpcy5fbW9kZXJhdG9yX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubW9kZXJhdG9yKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21vZGVyYXRvci4nKTtcblxuXHRcdGlmICh0aGlzLl9wcm9qZWN0KSByZXQgKz0gLyoodGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2plY3QoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvamVjdC4nKTtcblxuXHRcdGlmICh0aGlzLl9ib2FyZCkgcmV0ICs9IC8qKHRoaXMuX2JvYXJkX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYm9hcmQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYm9hcmQuJyk7XG5cblx0XHRpZiAodGhpcy5fZGVjaXNpb24pIHJldCArPSAvKih0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlY2lzaW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlY2lzaW9uLicpO1xuXG5cdFx0KHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmdfQWdlbmRhLm1lZXRpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nX01pbnV0ZS5tZWV0aW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJNZWV0aW5nXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19NZWV0aW5nXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRzdGFydDogb2JqLmdldFZhbHVlKFwic3RhcnRcIiksXG5cblx0XHRcdFx0XHRlbmQ6IG9iai5nZXRWYWx1ZShcImVuZFwiKSxcblxuXHRcdFx0XHRcdHN0YXJ0ZWQ6IG9iai5nZXRWYWx1ZShcInN0YXJ0ZWRcIiksXG5cblx0XHRcdFx0XHRlbmRlZDogb2JqLmdldFZhbHVlKFwiZW5kZWRcIiksXG5cblx0XHRcdFx0XHRzZXJpZXM6IG9iai5nZXRWYWx1ZShcInNlcmllc1wiKSxcblxuXHRcdFx0XHRcdG9yZ2FuaXplcjogb2JqLmdldFZhbHVlKFwib3JnYW5pemVyXCIpLFxuXG5cdFx0XHRcdFx0bW9kZXJhdG9yOiBvYmouZ2V0VmFsdWUoXCJtb2RlcmF0b3JcIiksXG5cblx0XHRcdFx0XHRwcm9qZWN0OiBvYmouZ2V0VmFsdWUoXCJwcm9qZWN0XCIpLFxuXG5cdFx0XHRcdFx0Ym9hcmQ6IG9iai5nZXRWYWx1ZShcImJvYXJkXCIpLFxuXG5cdFx0XHRcdFx0ZGVjaXNpb246IG9iai5nZXRWYWx1ZShcImRlY2lzaW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc3RhcnQob2JqLnN0YXJ0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuZChvYmouZW5kKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zdGFydGVkKG9iai5zdGFydGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5kZWQob2JqLmVuZGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNlcmllcykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnNlcmllcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvYmouc2VyaWVzKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmdhbml6ZXIobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoub3JnYW5pemVyKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2RlcmF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tb2RlcmF0b3IobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kZXJhdG9yKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucHJvamVjdChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai5wcm9qZWN0KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kZWNpc2lvbihuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMobmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ1wiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zdGFydCA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdGlmIChyZXQuc3RhcnQgJiYgdHlwZW9mKHJldC5zdGFydC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydCA9IHJldC5zdGFydC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmQgPSB0aGlzLmVuZCgpO1xuXG5cdFx0aWYgKHJldC5lbmQgJiYgdHlwZW9mKHJldC5lbmQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZW5kID0gcmV0LmVuZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdGFydGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc3RhcnRlZCA9IHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0aWYgKHJldC5zdGFydGVkICYmIHR5cGVvZihyZXQuc3RhcnRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydGVkID0gcmV0LnN0YXJ0ZWQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5kZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmRlZCA9IHRoaXMuZW5kZWQoKTtcblxuXHRcdGlmIChyZXQuZW5kZWQgJiYgdHlwZW9mKHJldC5lbmRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmRlZCA9IHJldC5lbmRlZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zZXJpZXMgPSB0aGlzLnNlcmllcygpO1xuXG5cdFx0aWYgKHJldC5zZXJpZXMpIHtcblx0XHRcdHJldC5zZXJpZXMgPSByZXQuc2VyaWVzLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zZXJpZXMpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNlcmllcykubGVuZ3RoKSByZXQuc2VyaWVzID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JnYW5pemVyID0gdGhpcy5vcmdhbml6ZXIoKTtcblxuXHRcdGlmIChyZXQub3JnYW5pemVyKSB7XG5cdFx0XHRyZXQub3JnYW5pemVyID0gcmV0Lm9yZ2FuaXplci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQub3JnYW5pemVyKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5vcmdhbml6ZXIpLmxlbmd0aCkgcmV0Lm9yZ2FuaXplciA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21vZGVyYXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1vZGVyYXRvciA9IHRoaXMubW9kZXJhdG9yKCk7XG5cblx0XHRpZiAocmV0Lm1vZGVyYXRvcikge1xuXHRcdFx0cmV0Lm1vZGVyYXRvciA9IHJldC5tb2RlcmF0b3IuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0Lm1vZGVyYXRvcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubW9kZXJhdG9yKS5sZW5ndGgpIHJldC5tb2RlcmF0b3IgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucHJvamVjdCA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0aWYgKHJldC5wcm9qZWN0KSB7XG5cdFx0XHRyZXQucHJvamVjdCA9IHJldC5wcm9qZWN0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5wcm9qZWN0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wcm9qZWN0KS5sZW5ndGgpIHJldC5wcm9qZWN0ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5ib2FyZCA9IHRoaXMuYm9hcmQoKTtcblxuXHRcdGlmIChyZXQuYm9hcmQpIHtcblx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYm9hcmQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJvYXJkKS5sZW5ndGgpIHJldC5ib2FyZCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGVjaXNpb24gPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRyZXQuZGVjaXNpb24gPSByZXQuZGVjaXNpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmRlY2lzaW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWNpc2lvbikubGVuZ3RoKSByZXQuZGVjaXNpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gdGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMubWVldGluZ19NZWV0aW5nX01pbnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgPSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0YXJ0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0KHRoaXMuc3RhcnQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5kXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5kKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuZCh0aGlzLmVuZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnRlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydGVkKHRoaXMuc3RhcnRlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmRlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuZGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuZGVkKHRoaXMuZW5kZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2VyaWVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VyaWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlcmllcyh0aGlzLnNlcmllcygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JnYW5pemVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JnYW5pemVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcih0aGlzLm9yZ2FuaXplcigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibW9kZXJhdG9yXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubW9kZXJhdG9yKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVyYXRvcih0aGlzLm1vZGVyYXRvcigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvamVjdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2plY3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdCh0aGlzLnByb2plY3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImJvYXJkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYm9hcmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYm9hcmQodGhpcy5ib2FyZCgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVjaXNpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZWNpc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWNpc2lvbih0aGlzLmRlY2lzaW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGFydF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhcnQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0YXJ0Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXJ0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5kKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fc3RhcnRlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zdGFydGVkKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXJ0ZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdGFydGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmRlZCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5kZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuZGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuZGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NlcmllcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zZXJpZXNfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJzZXJpZXMgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJzZXJpZXNbc2VyaWVzXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNlcmllcygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NlcmllcycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2VyaWVzJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NlcmllcycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NlcmllcycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZ2FuaXplcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmdhbml6ZXIoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcIm9yZ2FuaXplciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcIm9yZ2FuaXplcltvcmdhbml6ZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3JnYW5pemVyKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JnYW5pemVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmdhbml6ZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JnYW5pemVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JnYW5pemVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tb2RlcmF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbW9kZXJhdG9yX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwibW9kZXJhdG9yIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwibW9kZXJhdG9yW21vZGVyYXRvcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2RlcmF0b3IoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb2RlcmF0b3InKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vZGVyYXRvcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb2RlcmF0b3InKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2RlcmF0b3InLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3Byb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJwcm9qZWN0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwicHJvamVjdFtwcm9qZWN0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnByb2plY3QoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9qZWN0JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2plY3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9ib2FyZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwiYm9hcmQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJib2FyZFtib2FyZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ib2FyZCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2JvYXJkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdib2FyZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdib2FyZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2JvYXJkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwiZGVjaXNpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJkZWNpc2lvbltkZWNpc2lvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWNpc2lvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RlY2lzaW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWNpc2lvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZWNpc2lvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKSkgdGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyhvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwib2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0IiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbGVuZ3RoID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiAoe1xuXHRcdFx0XHRcdFx0XCJTdHJpbmdcIjogMjU1LFxuXHRcdFx0XHRcdFx0XCJUZXh0XCI6IDQwMDAsXG5cdFx0XHRcdFx0fSlbdGhpcy50eXBlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lk1vZGVsX0lEIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfSUQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5Nb2RlbF9JRCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3ZTNCd1lYUm9mWDB1WDE5MGVYQmxQVDBuYzNselgzWmhjbWxoWW14bFgzWmhiSFZsSnlBbUppQjdlMTlmZlgwdWMzVmlabXh2ZHlrL2UzdGZYMzE5TG5OMVltWnNiM2N1U1dRNmUzdHdjR0YwYUgxOUxrbGtLVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UEZzcUtsdG1iRzkzWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVczTnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhWMHVjM1ZpWm14dmR5NUpaQ3dnS2lwYllXTjBhVzl1WDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRoWTNScGIyNUpibkIxZEZ0dGIyUmxiRjlwWkQwbmUzdHBaSDE5SjExZFhTNTdYQ0pKWkZ3aU9pQmNJbDltZTJkekxtbHVabThvWDNSdlUzUnlhVzVuSUNzZ0p6b2dSa2xLVTA5T09pQW5JQ3NnU2xOUFRpNXpkSEpwYm1kcFpua29jbVZtY3k1dFlXNTVVbVZtY3lrcGZWd2lmUzVKWkYxYk1GMCtQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuTW9kZWxfVGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9UYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5BdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdEF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9BdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICd0eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVmFyaWFibGVfVmFsdWUuYWN0aW9uSW5wdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJBY3Rpb25fSW5wdXRcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0YWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50eXBlKG9iai50eXBlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9JbnB1dFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdGlmIChyZXQuc25hcHNob3QpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGlvbiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uKS5sZW5ndGgpIHJldC5hY3Rpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9JRCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9JRCA9IHRoaXMuTW9kZWxfSUQoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfVGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfVGFibGUgPSB0aGlzLk1vZGVsX1RhYmxlKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2lucHV0JywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnB1dCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfYWN0aW9uX2lucHV0Jyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2lucHV0JywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnB1dCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9hY3Rpb25faW5wdXQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyhvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25faW5wdXQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3RcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfT3V0cHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfT3V0cHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfVmFyaWFibGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfUGxhbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X1BsYW5zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19QbGFucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfUGxhbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfUGxhbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnB1dC5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X091dHB1dC5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfVmFyaWFibGUuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0xvZ2ljLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnN0YW5jZS5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX0lucHV0LnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X1BsYW4uc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfRGF0YV9WYXJpYWJsZS5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZyb21GbG93XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZnJvbUZsb3cocGF5bG9hZFtcImZsb3dcIl0sICk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRmxvd19TbmFwc2hvdFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRibG9jazogb2JqLmdldFZhbHVlKFwiYmxvY2tcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X1BsYW5zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfRmxvd19QbGFucyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19QbGFucykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfU25hcHNob3RcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X0lucHV0cyA9IHRoaXMuc25hcHNob3RfRmxvd19JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfT3V0cHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X091dHB1dHMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfT3V0cHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19WYXJpYWJsZXMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X0xvZ2ljcyA9IHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzID0gdGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzID0gdGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfUGxhbnMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyA9IHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3NuYXBzaG90JywgWycqJ10pWydzeXNfaHViX2Zsb3dfc25hcHNob3QnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfc25hcHNob3QnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgU25hcHNob3RcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9ibG9ja19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Jsb2NrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X3NuYXBzaG90Jyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19JbnB1dHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfSW5wdXRzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cyhvYmouc25hcHNob3RfRmxvd19JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X091dHB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19PdXRwdXRzKSkgdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyhvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcyhvYmouc25hcHNob3RfRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyhvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSkgdGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X1BsYW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X1BsYW5zLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X1BsYW5zKSkgdGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKG9iai5zbmFwc2hvdF9GbG93X1BsYW5zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3Quc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X3NuYXBzaG90Jyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpICoqKioqKioqKioqKioqKioqKioqKiovXG5mcm9tRmxvdyhfX2V2ZW50LCBmbG93KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YoZXZKU09OLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0ZmxvdyA9IGV2SlNPTi5mbG93O1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gZXZKU09OO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcikgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKGZsb3cpID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YodGhpcy5nZXRQYXJhbWV0ZXIoJ2Zsb3cnKSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRmbG93ID0gdGhpcy5nZXRQYXJhbWV0ZXIoJ2Zsb3cnKTtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0IiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5pbnB1dF9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnB1dF9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9pbnB1dF9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnB1dF9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lk1vZGVsX1RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfVGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5Nb2RlbF9JRCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX0lEID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Lk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuQXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfQXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0aGlzLmlucHV0X0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmllbGRfTGFiZWwuaW5wdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZhcmlhYmxlX1ZhbHVlLmZsb3dJbnB1dCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0lucHV0XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5wdXRfRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLmlucHV0X0ZpZWxkX0xhYmVscykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnB1dFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdGlmIChyZXQucmVmZXJlbmNlKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gcmV0LnNuYXBzaG90Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5wdXRfRmllbGRfTGFiZWxzID0gdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9UYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9UYWJsZSA9IHRoaXMuTW9kZWxfVGFibGUoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfSUQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfSUQgPSB0aGlzLk1vZGVsX0lEKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm1hbmRhdG9yeVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1hbmRhdG9yeSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYW5kYXRvcnkodGhpcy5tYW5kYXRvcnkoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19pbnB1dCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2lucHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X2lucHV0Jyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIm9iai5pbnB1dF9GaWVsZF9MYWJlbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmlucHV0X0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5wdXRfRmllbGRfTGFiZWxzKSkgdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMob2JqLmlucHV0X0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0lucHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfaW5wdXQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2lucHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfaW5wdXQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0IiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5vdXRwdXRfRmllbGRfTGFiZWxzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3V0cHV0X0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX291dHB1dF9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9vdXRwdXRfRmllbGRfTGFiZWxzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vdXRwdXRfRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lmxlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lk1vZGVsX0lEIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfSUQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lk1vZGVsX1RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfVGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LkF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX0F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmllbGRfTGFiZWwub3V0cHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X091dHB1dFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dFwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3V0cHV0X0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvYmoub3V0cHV0X0ZpZWxkX0xhYmVscykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X091dHB1dFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSByZXQucmVmZXJlbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc25hcHNob3QgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnNuYXBzaG90KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zbmFwc2hvdCkubGVuZ3RoKSByZXQuc25hcHNob3QgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3V0cHV0X0ZpZWxkX0xhYmVscyA9IHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9JRCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9JRCA9IHRoaXMuTW9kZWxfSUQoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfVGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfVGFibGUgPSB0aGlzLk1vZGVsX1RhYmxlKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X291dHB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X291dHB1dCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBPdXRwdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBPdXRwdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IE91dHB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLm91dHB1dF9GaWVsZF9MYWJlbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMpKSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X091dHB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X291dHB1dCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUudmFyaWFibGVfRmllbGRfTGFiZWxzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmFyaWFibGVfRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdmFyaWFibGVfRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdmFyaWFibGVfRmllbGRfTGFiZWxzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YXJpYWJsZV9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLk1vZGVsX0lEIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfSUQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5Nb2RlbF9UYWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX1RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuQXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfQXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmllbGRfTGFiZWwudmFyaWFibGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRmxvd19WYXJpYWJsZVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHR5cGU6IG9iai5nZXRWYWx1ZShcInR5cGVcIiksXG5cblx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLnR5cGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19WYXJpYWJsZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdGlmIChyZXQucmVmZXJlbmNlKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gcmV0LnNuYXBzaG90Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFyaWFibGVfRmllbGRfTGFiZWxzID0gdGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGVuZ3RoID0gdGhpcy5sZW5ndGgoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfSUQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfSUQgPSB0aGlzLk1vZGVsX0lEKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX1RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX1RhYmxlID0gdGhpcy5Nb2RlbF9UYWJsZSgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5BdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LkF0dHJpYnV0ZXMgPSB0aGlzLkF0dHJpYnV0ZXMoKTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJywgWycqJ10pWydzeXNfaHViX2Zsb3dfdmFyaWFibGUnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd192YXJpYWJsZScpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJywgWycqJ10pWydzeXNfaHViX2Zsb3dfdmFyaWFibGUnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykpIHRoaXMudmFyaWFibGVfRmllbGRfTGFiZWxzKG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd192YXJpYWJsZScpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmxlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfSUQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9JRCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5Nb2RlbF9UYWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX1RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLkF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX0F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0RhdGFfVmFyaWFibGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfRGF0YV9WYXJpYWJsZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdGlmIChyZXQuc25hcHNob3QpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9JRCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9JRCA9IHRoaXMuTW9kZWxfSUQoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfVGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfVGFibGUgPSB0aGlzLk1vZGVsX1RhYmxlKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfdmFyJywgWycqJ10pWydzeXNfZmxvd19kYXRhX3ZhciddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19mbG93X2RhdGFfdmFyJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3cgRGF0YSBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IERhdGEgVmFyaWFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IERhdGEgVmFyaWFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19kYXRhX3ZhcicpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX3ZhcicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV92YXInXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfZGF0YV92YXInKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19SZXF1aXJlbWVudCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfUmVxdWlyZW1lbnQiLCJuYW1lIjoic2hzX2FyYmZ3X1JlcXVpcmVtZW50Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1JlcXVpcmVtZW50IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19SZXF1aXJlbWVudFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucHJvamVjdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2plY3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3Byb2plY3QgPSB2O1xuXHRcdFx0dGhpcy5fcHJvamVjdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmNhcGFiaWxpdHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjYXBhYmlsaXR5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5ID0gdjtcblx0XHRcdHRoaXMuX2NhcGFiaWxpdHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY2FwYWJpbGl0eTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X0FnZW5kYV9JdGVtc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2plY3QpIHJldCArPSAvKih0aGlzLl9wcm9qZWN0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucHJvamVjdCgpLl90b0VRdWVyeShzUGF0aCArICdwcm9qZWN0LicpO1xuXG5cdFx0aWYgKHRoaXMuX2NhcGFiaWxpdHkpIHJldCArPSAvKih0aGlzLl9jYXBhYmlsaXR5X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuY2FwYWJpbGl0eSgpLl90b0VRdWVyeShzUGF0aCArICdjYXBhYmlsaXR5LicpO1xuXG5cdFx0KHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRWZmb3J0X0VzdGltYXRlLnJlcXVpcmVtZW50LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFnZW5kYV9JdGVtLnJlcXVpcmVtZW50LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiUmVxdWlyZW1lbnRcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X1JlcXVpcmVtZW50XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0cHJvamVjdDogb2JqLmdldFZhbHVlKFwicHJvamVjdFwiKSxcblxuXHRcdFx0XHRcdGNhcGFiaWxpdHk6IG9iai5nZXRWYWx1ZShcImNhcGFiaWxpdHlcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnByb2plY3QobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY2FwYWJpbGl0eSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNhcGFiaWxpdHkobmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouY2FwYWJpbGl0eSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMobmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUmVxdWlyZW1lbnRcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnByb2plY3QgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdGlmIChyZXQucHJvamVjdCkge1xuXHRcdFx0cmV0LnByb2plY3QgPSByZXQucHJvamVjdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucHJvamVjdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucHJvamVjdCkubGVuZ3RoKSByZXQucHJvamVjdCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jYXBhYmlsaXR5ID0gdGhpcy5jYXBhYmlsaXR5KCk7XG5cblx0XHRpZiAocmV0LmNhcGFiaWxpdHkpIHtcblx0XHRcdHJldC5jYXBhYmlsaXR5ID0gcmV0LmNhcGFiaWxpdHkuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmNhcGFiaWxpdHkpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmNhcGFiaWxpdHkpLmxlbmd0aCkgcmV0LmNhcGFiaWxpdHkgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyA9IHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyA9IHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvamVjdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2plY3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdCh0aGlzLnByb2plY3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNhcGFiaWxpdHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jYXBhYmlsaXR5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNhcGFiaWxpdHkodGhpcy5jYXBhYmlsaXR5KCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9wcm9qZWN0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiUmVxdWlyZW1lbnRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwicHJvamVjdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiICsgXCJwcm9qZWN0W3Byb2plY3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucHJvamVjdCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2plY3QnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2plY3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jYXBhYmlsaXR5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NhcGFiaWxpdHlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY2FwYWJpbGl0eSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJSZXF1aXJlbWVudFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJjYXBhYmlsaXR5IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIgKyBcImNhcGFiaWxpdHlbY2FwYWJpbGl0eV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5jYXBhYmlsaXR5KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY2FwYWJpbGl0eScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NhcGFiaWxpdHknKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY2FwYWJpbGl0eScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NhcGFiaWxpdHknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyhvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIm9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSkgdGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmNvbHVtbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uID0gdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3Vic2NyaXB0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3Vic2NyaXB0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb24gPSB2O1xuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4pIHJldCArPSAvKih0aGlzLl9jb2x1bW5fY29vcCB8fCAnPScpICsgKi8gdGhpcy5jb2x1bW4oKS5fdG9FUXVlcnkoc1BhdGggKyAnY29sdW1uLicpO1xuXG5cdFx0aWYgKHRoaXMuX3N1YnNjcmlwdGlvbikgcmV0ICs9IC8qKHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YnNjcmlwdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzdWJzY3JpcHRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJTdWJzY3JpcHRpb25fVHJpZ2dlclwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlclwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0Y29sdW1uOiBvYmouZ2V0VmFsdWUoXCJjb2x1bW5cIiksXG5cblx0XHRcdFx0XHRzdWJzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcInN1YnNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29sdW1uKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW4pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YnNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnN1YnNjcmlwdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zdWJzY3JpcHRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTdWJzY3JpcHRpb25fVHJpZ2dlclwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvbHVtbiA9IHRoaXMuY29sdW1uKCk7XG5cblx0XHRpZiAocmV0LmNvbHVtbikge1xuXHRcdFx0cmV0LmNvbHVtbiA9IHJldC5jb2x1bW4uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmNvbHVtbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuY29sdW1uKS5sZW5ndGgpIHJldC5jb2x1bW4gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zdWJzY3JpcHRpb24gPSB0aGlzLnN1YnNjcmlwdGlvbigpO1xuXG5cdFx0aWYgKHJldC5zdWJzY3JpcHRpb24pIHtcblx0XHRcdHJldC5zdWJzY3JpcHRpb24gPSByZXQuc3Vic2NyaXB0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zdWJzY3JpcHRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN1YnNjcmlwdGlvbikubGVuZ3RoKSByZXQuc3Vic2NyaXB0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2x1bW5cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2x1bW4oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29sdW1uKHRoaXMuY29sdW1uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdWJzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdWJzY3JpcHRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3Vic2NyaXB0aW9uKHRoaXMuc3Vic2NyaXB0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJywgWycqJ10pWydTdWJzY3JpcHRpb25fVHJpZ2dlciddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU3Vic2NyaXB0aW9uIFRyaWdnZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwiY29sdW1uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcImNvbHVtbltjb2x1bW5dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY29sdW1uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29sdW1uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvbHVtbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc3Vic2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zdWJzY3JpcHRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU3Vic2NyaXB0aW9uIFRyaWdnZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwic3Vic2NyaXB0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcInN1YnNjcmlwdGlvbltzdWJzY3JpcHRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc3Vic2NyaXB0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3Vic2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3Vic2NyaXB0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1YnNjcmlwdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1YnNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnU3Vic2NyaXB0aW9uX1RyaWdnZXInKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLnNvdXJjZVR5cGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c291cmNlVHlwZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3NvdXJjZVR5cGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3lzX2h1Yl9mbG93XCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zb3VyY2VUeXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNselgyaDFZbDltYkc5M0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkZsb3dfU2V0dGluZ1wiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmdcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1NldHRpbmdcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnNvdXJjZVR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc291cmNlVHlwZSA9IHRoaXMuc291cmNlVHlwZSgpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnLCBbJyonXSlbJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRmxvdyBTZXR0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvdyIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9GbG93IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3ciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc2VjdXJpdHlDb250cm9sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VjdXJpdHlDb250cm9sKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2wgPSB2O1xuXHRcdFx0dGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlY3VyaXR5Q29udHJvbDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0Zsb3dfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfRmxvd19JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19PdXRwdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X091dHB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X091dHB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnN1YmZsb3dfRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdWJmbG93X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc3ViZmxvd19GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0FjdGlvbl9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19TZXR0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TZXR0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NldHRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X1NuYXBzaG90cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1NuYXBzaG90c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY2xpZW50Q2FsbGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2xpZW50Q2FsbGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9jbGllbnRDYWxsYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5jbGllbnRDYWxsYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLSHQ3WDE5OWZTNWhZMnh6UHlkMGNuVmxKem9uWm1Gc2MyVW5LVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UENSbGVHbHpkSE1vZTN0ZlgzMTlMbUZqYkhNcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnBvbGljeSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwb2xpY3koKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9wb2xpY3kgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cucG9saWN5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelB5ZHdjbTkwWldOMFpXUW5PaWNuS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBDUmxlR2x6ZEhNb2UzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhNcFB5ZHdjbTkwWldOMFpXUW5PaWNuUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc3RhdHVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXR1cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3N0YXR1cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdGF0dXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6UHlkd2RXSnNhWE5vWldRbk9pZGtjbUZtZENjcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKR1Y0YVhOMGN5aDdlMTlmZlgwdVpteHZkMTlHYkc5M1gxTnVZWEJ6YUc5MGN5ay9KM0IxWW14cGMyaGxaQ2M2SjJSeVlXWjBKejQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy50eXBlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl90eXBlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN1YmZsb3dcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy50eXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNWaVpteHZkeUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lmxhc3RTbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYXN0U25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYXN0U25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubGFzdFNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelAzdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSeld6QmRMa2xrT2ljbktUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQSHQ3WDE5OWZTNW1iRzkzWDBac2IzZGZVMjVoY0hOb2IzUnpXekJkTGtsa1BqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm1haW5TbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYWluU25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tYWluU25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubWFpblNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1c1lYUmxjM1JmYzI1aGNITm9iM1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OGUzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhOYk1GMHVTV1ErUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcImJyb3dzZXJBY3RpdmF0ZWRJbj1jaHJvbWUsaW50ZWdyYXRpb25BY3RpdmF0ZWRJbj1zdGFuZGFsb25lLGxhYmVsQ2FjaGVDbGVhblVwRXhlY3V0ZWQ9dHJ1ZSx0aW1lRnJvbUNyZWF0ZVRvQWN0aXZhdGU9Mzk3MDAwLHZpZXdBY3RpdmF0ZWRJbj1uYXR1cmFsTGFuZ3VhZ2VcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5hdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pWW5KdmQzTmxja0ZqZEdsMllYUmxaRWx1UFdOb2NtOXRaU3hwYm5SbFozSmhkR2x2YmtGamRHbDJZWFJsWkVsdVBYTjBZVzVrWVd4dmJtVXNiR0ZpWld4RFlXTm9aVU5zWldGdVZYQkZlR1ZqZFhSbFpEMTBjblZsTEhScGJXVkdjbTl0UTNKbFlYUmxWRzlCWTNScGRtRjBaVDB6T1Rjd01EQXNkbWxsZDBGamRHbDJZWFJsWkVsdVBXNWhkSFZ5WVd4TVlXNW5kV0ZuWlNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5sYWJlbENhY2hlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxhYmVsQ2FjaGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYWJlbENhY2hlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiBgPDwkYXBwZW5kKCRhcHBlbmQoKioucGFyZW50X0Zsb3dfSW5zdGFuY2VzW2xhYmVsX2NhY2hlPSd7e2lkfX0nXS57XCJuYW1lXCI6IHVpX2lkJlwiLlwiJnN1YmZsb3cuaW50ZXJuYWxfbmFtZSwgXCJyZWZlcmVuY2VfZGlzcGxheVwiOiAnJHt0aGlzLkVudGl0eUNsYXNzLk5hbWV9JywgXCJsYWJlbFwiOiBvcmRlciYnIC0gJyZzdWJmbG93Lm5hbWUmJ1xcdTI3OWInJnN1YmZsb3cubmFtZSwgXCJiYXNlX3R5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJ0eXBlXCI6IGludGVybmFsX3R5cGUsIFwiYXR0cmlidXRlc1wiOiB7XCJlbGVtZW50X21hcHBpbmdfcHJvdmlkZXJcIjogJ2NvbS5nbGlkZS5mbG93X2Rlc2lnbi5hY3Rpb24uZGF0YS5GbG93RGVzaWduVmFyaWFibGVNYXBwZXInLCBcInVpVHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInVpVW5pcXVlSWRcIjogSWR9fVskXSxcblxuJC5mbG93X0Zsb3dfVmFyaWFibGVzLntcIm5hbWVcIjogJ2Zsb3dfdmFyaWFibGUuJyZlbGVtZW50LCBcInJlZmVyZW5jZV9kaXNwbGF5XCI6ICdsYWJlbCdcbiwgXCJsYWJlbFwiOiAnRmxvdyBWYXJpYWJsZXNcXHUyNzliJyZlbGVtZW50LCBcImJhc2VfdHlwZVwiOiBpbnRlcm5hbF90eXBlLFxuXCJ0eXBlXCI6IGludGVybmFsX3R5cGUsIFwiYXR0cmlidXRlc1wiOiB7XG4gICAgXCJlbGVtZW50X21hcHBpbmdfcHJvdmlkZXJcIjogJ2NvbS5nbGlkZS5mbG93X2Rlc2lnbi5hY3Rpb24uZGF0YS5GbG93RGVzaWduVmFyaWFibGVNYXBwZXInLFxuICAgIFwidWlUeXBlXCI6IGludGVybmFsX3R5cGUsIFwidWlVbmlxdWVJZFwiOiBJZFxufVxufSlcbixcbiQuZmxvd19GbG93X0lucHV0cy57XCJuYW1lXCI6ICdzdWJmbG93LicmZWxlbWVudCwgXCJyZWZlcmVuY2VfZGlzcGxheVwiOiAnbGFiZWwnXG4sIFwibGFiZWxcIjogJ0lucHV0XFx1Mjc5YicmZWxlbWVudCwgXCJiYXNlX3R5cGVcIjogaW50ZXJuYWxfdHlwZSxcblwidHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcImF0dHJpYnV0ZXNcIjoge1xuICAgIFwiZWxlbWVudF9tYXBwaW5nX3Byb3ZpZGVyXCI6ICdjb20uZ2xpZGUuZmxvd19kZXNpZ24uYWN0aW9uLmRhdGEuRmxvd0Rlc2lnblZhcmlhYmxlTWFwcGVyJyxcbiAgICBcInVpVHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInVpVW5pcXVlSWRcIjogSWRcbn19KT4+YDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5sYWJlbENhY2hlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdZRHc4SkdGd2NHVnVaQ2drWVhCd1pXNWtLQ29xTG5CaGNtVnVkRjlHYkc5M1gwbHVjM1JoYm1ObGMxdHNZV0psYkY5allXTm9aVDBuZTN0cFpIMTlKMTB1ZTF3aWJtRnRaVndpT2lCMWFWOXBaQ1pjSWk1Y0lpWnpkV0ptYkc5M0xtbHVkR1Z5Ym1Gc1gyNWhiV1VzSUZ3aWNtVm1aWEpsYm1ObFgyUnBjM0JzWVhsY0lqb2dKMXhjSkh0MGFHbHpMa1Z1ZEdsMGVVTnNZWE56TGs1aGJXVjlKeXdnWENKc1lXSmxiRndpT2lCdmNtUmxjaVluSUMwZ0p5WnpkV0ptYkc5M0xtNWhiV1VtSjF4Y1hGeDFNamM1WWljbWMzVmlabXh2ZHk1dVlXMWxMQ0JjSW1KaGMyVmZkSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0luUjVjR1ZjSWpvZ2FXNTBaWEp1WVd4ZmRIbHdaU3dnWENKaGRIUnlhV0oxZEdWelhDSTZJSHRjSW1Wc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjbHdpT2lBblkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaWNzSUZ3aWRXbFVlWEJsWENJNklHbHVkR1Z5Ym1Gc1gzUjVjR1VzSUZ3aWRXbFZibWx4ZFdWSlpGd2lPaUJKWkgxOVd5UmRMRnh1WEc0a0xtWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTXVlMXdpYm1GdFpWd2lPaUFuWm14dmQxOTJZWEpwWVdKc1pTNG5KbVZzWlcxbGJuUXNJRndpY21WbVpYSmxibU5sWDJScGMzQnNZWGxjSWpvZ0oyeGhZbVZzSjF4dUxDQmNJbXhoWW1Wc1hDSTZJQ2RHYkc5M0lGWmhjbWxoWW14bGMxeGNYRngxTWpjNVlpY21aV3hsYldWdWRDd2dYQ0ppWVhObFgzUjVjR1ZjSWpvZ2FXNTBaWEp1WVd4ZmRIbHdaU3hjYmx3aWRIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW1GMGRISnBZblYwWlhOY0lqb2dlMXh1SUNBZ0lGd2laV3hsYldWdWRGOXRZWEJ3YVc1blgzQnliM1pwWkdWeVhDSTZJQ2RqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUp5eGNiaUFnSUNCY0luVnBWSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0luVnBWVzVwY1hWbFNXUmNJam9nU1dSY2JuMWNibjBwWEc0c1hHNGtMbVpzYjNkZlJteHZkMTlKYm5CMWRITXVlMXdpYm1GdFpWd2lPaUFuYzNWaVpteHZkeTRuSm1Wc1pXMWxiblFzSUZ3aWNtVm1aWEpsYm1ObFgyUnBjM0JzWVhsY0lqb2dKMnhoWW1Wc0oxeHVMQ0JjSW14aFltVnNYQ0k2SUNkSmJuQjFkRnhjWEZ4MU1qYzVZaWNtWld4bGJXVnVkQ3dnWENKaVlYTmxYM1I1Y0dWY0lqb2dhVzUwWlhKdVlXeGZkSGx3WlN4Y2Jsd2lkSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0ltRjBkSEpwWW5WMFpYTmNJam9nZTF4dUlDQWdJRndpWld4bGJXVnVkRjl0WVhCd2FXNW5YM0J5YjNacFpHVnlYQ0k2SUNkamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlKeXhjYmlBZ0lDQmNJblZwVkhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJblZwVlc1cGNYVmxTV1JjSWpvZ1NXUmNibjE5S1Q0K1lDSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHRpZiAodGhpcy5fc2VjdXJpdHlDb250cm9sKSByZXQgKz0gLyoodGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2VjdXJpdHlDb250cm9sKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NlY3VyaXR5Q29udHJvbC4nKTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5wdXQuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfT3V0cHV0LmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfVmFyaWFibGUuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19Mb2dpYy5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlLnN1YmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX0lucHV0LmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19TZXR0aW5nLmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfU25hcHNob3QuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0RhdGFfVmFyaWFibGUuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0c2VjdXJpdHlDb250cm9sOiBvYmouZ2V0VmFsdWUoXCJzZWN1cml0eUNvbnRyb2xcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VjdXJpdHlDb250cm9sKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc2VjdXJpdHlDb250cm9sKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmouc2VjdXJpdHlDb250cm9sKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfT3V0cHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0FjdGlvbl9JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfU2V0dGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfU2V0dGluZ3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19TZXR0aW5ncykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X1NuYXBzaG90cykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zZWN1cml0eUNvbnRyb2wpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zZWN1cml0eUNvbnRyb2wgPSB0aGlzLnNlY3VyaXR5Q29udHJvbCgpO1xuXG5cdFx0aWYgKHJldC5zZWN1cml0eUNvbnRyb2wpIHtcblx0XHRcdHJldC5zZWN1cml0eUNvbnRyb2wgPSByZXQuc2VjdXJpdHlDb250cm9sLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zZWN1cml0eUNvbnRyb2wpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNlY3VyaXR5Q29udHJvbCkubGVuZ3RoKSByZXQuc2VjdXJpdHlDb250cm9sID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19JbnB1dHMgPSB0aGlzLmZsb3dfRmxvd19JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19PdXRwdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19PdXRwdXRzID0gdGhpcy5mbG93X0Zsb3dfT3V0cHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfVmFyaWFibGVzID0gdGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19Mb2dpY3MgPSB0aGlzLmZsb3dfRmxvd19Mb2dpY3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3ViZmxvd19GbG93X0luc3RhbmNlcyA9IHRoaXMuc3ViZmxvd19GbG93X0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfQWN0aW9uX0lucHV0cyA9IHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfU2V0dGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X1NldHRpbmdzID0gdGhpcy5mbG93X0Zsb3dfU2V0dGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X1NuYXBzaG90cyA9IHRoaXMuZmxvd19GbG93X1NuYXBzaG90cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyA9IHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5jbGllbnRDYWxsYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jbGllbnRDYWxsYWJsZSA9IHRoaXMuY2xpZW50Q2FsbGFibGUoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMucG9saWN5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBvbGljeSA9IHRoaXMucG9saWN5KCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnN0YXR1cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGF0dXMgPSB0aGlzLnN0YXR1cygpO1xuXG5cdGlmICh0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMubGFzdFNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxhc3RTbmFwc2hvdCA9IHRoaXMubGFzdFNuYXBzaG90KCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLm1haW5TbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYWluU25hcHNob3QgPSB0aGlzLm1haW5TbmFwc2hvdCgpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMubGFiZWxDYWNoZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sYWJlbENhY2hlID0gdGhpcy5sYWJlbENhY2hlKCk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInNlY3VyaXR5Q29udHJvbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlY3VyaXR5Q29udHJvbCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZWN1cml0eUNvbnRyb2wodGhpcy5zZWN1cml0eUNvbnRyb2woKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3cnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIgKyBcImJsb2NrW2Jsb2NrXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJsb2NrKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Jsb2NrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYmxvY2snLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NlY3VyaXR5Q29udHJvbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9zZWN1cml0eUNvbnRyb2xfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuc2VjdXJpdHlDb250cm9sKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJzZWN1cml0eUNvbnRyb2wgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiICsgXCJzZWN1cml0eUNvbnRyb2xbc2VjdXJpdHlDb250cm9sXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNlY3VyaXR5Q29udHJvbCgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NlY3VyaXR5Y29udHJvbCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2VjdXJpdHljb250cm9sJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NlY3VyaXR5Y29udHJvbCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NlY3VyaXR5Y29udHJvbCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvdycpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X0lucHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0lucHV0cykpIHRoaXMuZmxvd19GbG93X0lucHV0cyhvYmouZmxvd19GbG93X0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19PdXRwdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X091dHB1dHMpKSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKG9iai5mbG93X0Zsb3dfT3V0cHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKG9iai5mbG93X0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0xvZ2ljcykpIHRoaXMuZmxvd19GbG93X0xvZ2ljcyhvYmouZmxvd19GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMpKSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0FjdGlvbl9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19BY3Rpb25fSW5wdXRzKSkgdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMob2JqLmZsb3dfQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJvYmouZmxvd19GbG93X1NldHRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfU2V0dGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19TZXR0aW5ncykpIHRoaXMuZmxvd19GbG93X1NldHRpbmdzKG9iai5mbG93X0Zsb3dfU2V0dGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19TbmFwc2hvdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpKSB0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSkgdGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3cuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3cuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvdycpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3cuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnNjaGVtYSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjaGVtYSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc2NoZW1hID0gdjtcblx0XHRcdHRoaXMuX3NjaGVtYV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zY2hlbWE7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24udGFibGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdGFibGUgPSB2O1xuXHRcdFx0dGhpcy5fdGFibGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGFibGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24ucHJvZmlsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2ZpbGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3Byb2ZpbGUgPSB2O1xuXHRcdFx0dGhpcy5fcHJvZmlsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9maWxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3N1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc2NoZW1hKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc2NoZW1hJyArICh0aGlzLl9zY2hlbWFfY29vcCB8fCAnPScpICsgdGhpcy5zY2hlbWEoKTtcblxuXHRcdGlmICh0aGlzLl90YWJsZSkgcmV0ICs9IC8qKHRoaXMuX3RhYmxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGFibGUoKS5fdG9FUXVlcnkoc1BhdGggKyAndGFibGUuJyk7XG5cblx0XHRpZiAodGhpcy5fcHJvZmlsZSkgcmV0ICs9IC8qKHRoaXMuX3Byb2ZpbGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wcm9maWxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Byb2ZpbGUuJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3Vic2NyaXB0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJTYXZlX1N1YnNjcmlwdGlvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvblwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0c2NoZW1hOiBvYmouZ2V0VmFsdWUoXCJzY2hlbWFcIiksXG5cblx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRwcm9maWxlOiBvYmouZ2V0VmFsdWUoXCJwcm9maWxlXCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zY2hlbWEoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zY2hlbWEpKSk7XG5cblx0XHRcdFx0XHR0aGlzLnNjaGVtYShvYmouc2NoZW1hKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoudGFibGUpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2ZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5wcm9maWxlKG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoucHJvZmlsZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMobmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2Zyb21Eb2N1bWVudChvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTYXZlX1N1YnNjcmlwdGlvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NjaGVtYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnNjaGVtYSA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5zY2hlbWEpID09PSAnb2JqZWN0JykgcmV0LnNjaGVtYSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zY2hlbWEpKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnRhYmxlID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0aWYgKHJldC50YWJsZSkge1xuXHRcdFx0cmV0LnRhYmxlID0gcmV0LnRhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50YWJsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudGFibGUpLmxlbmd0aCkgcmV0LnRhYmxlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcHJvZmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnByb2ZpbGUgPSB0aGlzLnByb2ZpbGUoKTtcblxuXHRcdGlmIChyZXQucHJvZmlsZSkge1xuXHRcdFx0cmV0LnByb2ZpbGUgPSByZXQucHJvZmlsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQucHJvZmlsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucHJvZmlsZSkubGVuZ3RoKSByZXQucHJvZmlsZSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyA9IHRoaXMuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NoZW1hXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2NoZW1hKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjaGVtYSh0aGlzLnNjaGVtYSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0YWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInByb2ZpbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9maWxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2ZpbGUodGhpcy5wcm9maWxlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnU2F2ZV9TdWJzY3JpcHRpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fc2NoZW1hX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9zY2hlbWFfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5zY2hlbWEoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzY2hlbWEnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY2hlbWEnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2NoZW1hJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2NoZW1hJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90YWJsZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTYXZlIFN1YnNjcmlwdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0YWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJ0YWJsZVt0YWJsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50YWJsZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RhYmxlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGFibGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndGFibGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0YWJsZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcHJvZmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9wcm9maWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnByb2ZpbGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU2F2ZSBTdWJzY3JpcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwicHJvZmlsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJwcm9maWxlW3Byb2ZpbGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucHJvZmlsZSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2ZpbGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9maWxlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2ZpbGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9maWxlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTYXZlIFN1YnNjcmlwdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnU2F2ZV9TdWJzY3JpcHRpb24nKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykpIHRoaXMuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyhvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGFyZW50ID0gdjtcblx0XHRcdHRoaXMuX3BhcmVudF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmVsZW1lbnRNYXBwaW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWxlbWVudE1hcHBpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nID0gdjtcblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VsZW1lbnRNYXBwaW5nO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQudHJhbnNmb3JtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90cmFuc2Zvcm0gPSB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RyYW5zZm9ybTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnBhcmVudF9QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9QaWxsX0NvbXBvdW5kcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X1BpbGxfQ29tcG91bmRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1widWlfaWRcIiwgXCJhdHRhY2hlZF90b1wiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJblZwWDJsa0lpd2lZWFIwWVdOb1pXUmZkRzhpWFgwPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5VSWQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0VUlkKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfVUlkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLlVJZCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeDdlMTlmZlgwdVNXUStQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmF0dGFjaGVkVG8gRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXR0YWNoZWRUbygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dGFjaGVkVG8gPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuYXR0YWNoZWRUbygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEd3FLa0FrWmx0ZlgzUjVjR1VnYVc0Z1d5ZHplWE5mYUhWaVgyWnNiM2NuTENBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKMTBnWVc1a0lIdDdibko5ZlYwdUpHWXVlM3RmWDMxOUxpUm1XeTB4WFM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldCArPSAvKih0aGlzLl9wYXJlbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wYXJlbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50LicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9lbGVtZW50TWFwcGluZykgcmV0ICs9IC8qKHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZWxlbWVudE1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWxlbWVudE1hcHBpbmcuJyk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybS4nKTtcblxuXHRcdCh0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUGlsbF9Db21wb3VuZC5wYXJlbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiUGlsbF9Db21wb3VuZFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHBhcmVudDogb2JqLmdldFZhbHVlKFwicGFyZW50XCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0ZWxlbWVudE1hcHBpbmc6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRNYXBwaW5nXCIpLFxuXG5cdFx0XHRcdFx0dHJhbnNmb3JtOiBvYmouZ2V0VmFsdWUoXCJ0cmFuc2Zvcm1cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbGVtZW50TWFwcGluZyhuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmouZWxlbWVudE1hcHBpbmcpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnRyYW5zZm9ybShuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUGlsbF9Db21wb3VuZFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5wYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHJldC5wYXJlbnQpIHtcblx0XHRcdHJldC5wYXJlbnQgPSByZXQucGFyZW50Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudCkubGVuZ3RoKSByZXQucGFyZW50ID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VsZW1lbnRNYXBwaW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZWxlbWVudE1hcHBpbmcgPSB0aGlzLmVsZW1lbnRNYXBwaW5nKCk7XG5cblx0XHRpZiAocmV0LmVsZW1lbnRNYXBwaW5nKSB7XG5cdFx0XHRyZXQuZWxlbWVudE1hcHBpbmcgPSByZXQuZWxlbWVudE1hcHBpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmVsZW1lbnRNYXBwaW5nKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5lbGVtZW50TWFwcGluZykubGVuZ3RoKSByZXQuZWxlbWVudE1hcHBpbmcgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50cmFuc2Zvcm0gPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0aWYgKHJldC50cmFuc2Zvcm0pIHtcblx0XHRcdHJldC50cmFuc2Zvcm0gPSByZXQudHJhbnNmb3JtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRyYW5zZm9ybSkubGVuZ3RoKSByZXQudHJhbnNmb3JtID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50X1BpbGxfQ29tcG91bmRzID0gdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5VSWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuVUlkID0gdGhpcy5VSWQoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXR0YWNoZWRUbygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRhY2hlZFRvID0gdGhpcy5hdHRhY2hlZFRvKCk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInBhcmVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudE1hcHBpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbGVtZW50TWFwcGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbGVtZW50TWFwcGluZyh0aGlzLmVsZW1lbnRNYXBwaW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0cmFuc2Zvcm1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcsIFsnKiddKVsnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJQaWxsIENvbXBvdW5kXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwicGFyZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXJlbnQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VsZW1lbnRNYXBwaW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVsZW1lbnRNYXBwaW5nKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJlbGVtZW50TWFwcGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImVsZW1lbnRNYXBwaW5nW2VsZW1lbnRNYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVsZW1lbnRNYXBwaW5nKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudG1hcHBpbmcnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnRtYXBwaW5nJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnRtYXBwaW5nJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudG1hcHBpbmcnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3RyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90cmFuc2Zvcm1fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0cmFuc2Zvcm0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiICsgXCJ0cmFuc2Zvcm1bdHJhbnNmb3JtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRyYW5zZm9ybSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RyYW5zZm9ybScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHJhbnNmb3JtJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RyYW5zZm9ybScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RyYW5zZm9ybScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3BpbGxfY29tcG91bmQnLCBbJyonXSlbJ3N5c19odWJfcGlsbF9jb21wb3VuZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfcGlsbF9jb21wb3VuZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kcykpIHRoaXMucGFyZW50X1BpbGxfQ29tcG91bmRzKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcsIFsnKiddKVsnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLm9wZXJhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9wZXJhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3BlcmF0aW9uID0gdjtcblx0XHRcdHRoaXMuX29wZXJhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcGVyYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnNlY3VyaXR5Q29udHJvbF9GbG93cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNlY3VyaXR5Q29udHJvbF9GbG93cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NlY3VyaXR5Q29udHJvbF9GbG93cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NlY3VyaXR5Q29udHJvbF9GbG93c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VjdXJpdHlDb250cm9sX0Zsb3dzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAvKih0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHlwZSgpLl90b0VRdWVyeShzUGF0aCArICd0eXBlLicpO1xuXG5cdFx0aWYgKHRoaXMuX29wZXJhdGlvbikgcmV0ICs9IC8qKHRoaXMuX29wZXJhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9wZXJhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdvcGVyYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93LnNlY3VyaXR5Q29udHJvbCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJTZWN1cml0eV9Db250cm9sXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2xcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdG9wZXJhdGlvbjogb2JqLmdldFZhbHVlKFwib3BlcmF0aW9uXCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudHlwZShuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9wZXJhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9wZXJhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoub3BlcmF0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zZWN1cml0eUNvbnRyb2xfRmxvd3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdXJpdHlfQ29udHJvbFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHJldC50eXBlKSB7XG5cdFx0XHRyZXQudHlwZSA9IHJldC50eXBlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50eXBlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50eXBlKS5sZW5ndGgpIHJldC50eXBlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3BlcmF0aW9uID0gdGhpcy5vcGVyYXRpb24oKTtcblxuXHRcdGlmIChyZXQub3BlcmF0aW9uKSB7XG5cdFx0XHRyZXQub3BlcmF0aW9uID0gcmV0Lm9wZXJhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQub3BlcmF0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5vcGVyYXRpb24pLmxlbmd0aCkgcmV0Lm9wZXJhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZWN1cml0eUNvbnRyb2xfRmxvd3MgPSB0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm9wZXJhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcGVyYXRpb24odGhpcy5vcGVyYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3BlcmF0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3BlcmF0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9wZXJhdGlvbih0aGlzLm9wZXJhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9hY2wnLCBbJyonXSlbJ3N5c19zZWN1cml0eV9hY2wnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfYWNsJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBDb250cm9sXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidHlwZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIgKyBcInR5cGVbdHlwZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50eXBlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29wZXJhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcGVyYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgQ29udHJvbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcIm9wZXJhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIgKyBcIm9wZXJhdGlvbltvcGVyYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3BlcmF0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3BlcmF0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcGVyYXRpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3BlcmF0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3BlcmF0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBDb250cm9sXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9hY2wnLCBbJyonXSlbJ3N5c19zZWN1cml0eV9hY2wnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2VjdXJpdHlfYWNsJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwib2JqLnNlY3VyaXR5Q29udHJvbF9GbG93czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpKSB0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cyhvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zZWN1cml0eV9hY2wnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X2FjbCcsIFsnKiddKVsnc3lzX3NlY3VyaXR5X2FjbCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1RlYW1fTWVtYmVyIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19UZWFtX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfVGVhbV9NZW1iZXIgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1fTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci50ZWFtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdGVhbSA9IHY7XG5cdFx0XHR0aGlzLl90ZWFtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIubWVtYmVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVtYmVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tZW1iZXIgPSB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdGVhbSkgcmV0ICs9IC8qKHRoaXMuX3RlYW1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50ZWFtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RlYW0uJyk7XG5cblx0XHRpZiAodGhpcy5fbWVtYmVyKSByZXQgKz0gLyoodGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubWVtYmVyKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lbWJlci4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJUZWFtX01lbWJlclwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfVGVhbV9NZW1iZXJcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHR0ZWFtOiBvYmouZ2V0VmFsdWUoXCJ0ZWFtXCIpLFxuXG5cdFx0XHRcdFx0bWVtYmVyOiBvYmouZ2V0VmFsdWUoXCJtZW1iZXJcIiksXG5cblx0XHRcdFx0XHRyb2xlOiBvYmouZ2V0VmFsdWUoXCJyb2xlXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50ZWFtKG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW0pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1lbWJlcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXIpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yb2xlKG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGUpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUZWFtX01lbWJlclwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudGVhbSA9IHRoaXMudGVhbSgpO1xuXG5cdFx0aWYgKHJldC50ZWFtKSB7XG5cdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50ZWFtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50ZWFtKS5sZW5ndGgpIHJldC50ZWFtID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubWVtYmVyID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdGlmIChyZXQubWVtYmVyKSB7XG5cdFx0XHRyZXQubWVtYmVyID0gcmV0Lm1lbWJlci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQubWVtYmVyKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tZW1iZXIpLmxlbmd0aCkgcmV0Lm1lbWJlciA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yb2xlID0gdGhpcy5yb2xlKCk7XG5cblx0XHRpZiAocmV0LnJvbGUpIHtcblx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJvbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJvbGUpLmxlbmd0aCkgcmV0LnJvbGUgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0ZWFtXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGVhbSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtKHRoaXMudGVhbSgpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWVtYmVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVtYmVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcih0aGlzLm1lbWJlcigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicm9sZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJvbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZSh0aGlzLnJvbGUoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3RlYW1fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudGVhbSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJUZWFtIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0ZWFtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIgKyBcInRlYW1bdGVhbV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50ZWFtKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RlYW0nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndGVhbScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tZW1iZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlRlYW0gTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcIm1lbWJlciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJtZW1iZXJbbWVtYmVyXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lbWJlcigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lbWJlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lbWJlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZW1iZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZW1iZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcm9sZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5yb2xlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlRlYW0gTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInJvbGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwicm9sZVtyb2xlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJvbGUoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyb2xlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncm9sZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyb2xlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncm9sZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBUZWFtX01lbWJlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0NvbHVtbiIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9Db2x1bW4iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29sdW1uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQ29sdW1uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4udGFibGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdGFibGUgPSB2O1xuXHRcdFx0dGhpcy5fdGFibGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGFibGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmNvbHVtbl9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2x1bW5fRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fY29sdW1uX0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbHVtbl9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLl9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJuYW1lXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdVlXMWxJbDE5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5kaXNwbGF5IEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRpc3BsYXkoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9kaXNwbGF5ID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiB0eXBlb2YodGhpcy50YWJsZSgpKSA9PT0gXCJvYmplY3RcIiAmJiB0aGlzLnRhYmxlKCkudGFibGVfQ29sdW1ucygpLmZpbmQoYyA9PiBjLnR5cGUoKSA9PSAnU3RyaW5nJykgPT0gdGhpcztcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmRpc3BsYXkoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z2RIbHdaVzltS0hSb2FYTXVkR0ZpYkdVb0tTa2dQVDA5SUZ3aWIySnFaV04wWENJZ0ppWWdkR2hwY3k1MFlXSnNaU2dwTG5SaFlteGxYME52YkhWdGJuTW9LUzVtYVc1a0tHTWdQVDRnWXk1MGVYQmxLQ2tnUFQwZ0oxTjBjbWx1WnljcElEMDlJSFJvYVhNaWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICd0eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fdGFibGUpIHJldCArPSAvKih0aGlzLl90YWJsZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnRhYmxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RhYmxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHQodGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTdWJzY3JpcHRpb25fVHJpZ2dlci5jb2x1bW4sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmNvbHVtbl9GaWVsZF9MYWJlbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZpZWxkX0xhYmVsLmNvbHVtbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkNvbHVtblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9Db2x1bW5cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLnR5cGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50YWJsZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai50YWJsZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMobmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2Zyb21Eb2N1bWVudChvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ29sdW1uXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50YWJsZSA9IHRoaXMudGFibGUoKTtcblxuXHRcdGlmIChyZXQudGFibGUpIHtcblx0XHRcdHJldC50YWJsZSA9IHJldC50YWJsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQudGFibGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRhYmxlKS5sZW5ndGgpIHJldC50YWJsZSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyA9IHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuY29sdW1uX0ZpZWxkX0xhYmVscygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2x1bW5fRmllbGRfTGFiZWxzID0gdGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRpZiAodHlwZW9mKHRoaXMubGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmRpc3BsYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlzcGxheSA9IHRoaXMuZGlzcGxheSgpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50YWJsZSh0aGlzLnRhYmxlKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0YWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RpY3Rpb25hcnknLCBbJyonXSlbJ3N5c19kaWN0aW9uYXJ5J10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2RpY3Rpb25hcnknKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdGFibGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudGFibGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0YWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIiArIFwidGFibGVbdGFibGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGFibGUoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0YWJsZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0YWJsZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0YWJsZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RhYmxlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJDb2x1bW5cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGljdGlvbmFyeScsIFsnKiddKVsnc3lzX2RpY3Rpb25hcnknXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIm9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSkgdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJvYmouY29sdW1uX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY29sdW1uX0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouY29sdW1uX0ZpZWxkX0xhYmVscykpIHRoaXMuY29sdW1uX0ZpZWxkX0xhYmVscyhvYmouY29sdW1uX0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogQ29sdW1uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBDb2x1bW4uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIENvbHVtbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5IiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJuYW1lIjoic2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3Rvcnkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZGVzaWduIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZXNpZ24gPSB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZWRpdG9yIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWRpdG9yKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lZGl0b3IgPSB2O1xuXHRcdFx0dGhpcy5fZWRpdG9yX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VkaXRvcjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZXNpZ24pIHJldCArPSAvKih0aGlzLl9kZXNpZ25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZXNpZ24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVzaWduLicpO1xuXG5cdFx0aWYgKHRoaXMuX2VkaXRvcikgcmV0ICs9IC8qKHRoaXMuX2VkaXRvcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmVkaXRvcigpLl90b0VRdWVyeShzUGF0aCArICdlZGl0b3IuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlZlcnNpb25fSGlzdG9yeVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGRlc2lnbjogb2JqLmdldFZhbHVlKFwiZGVzaWduXCIpLFxuXG5cdFx0XHRcdFx0ZWRpdG9yOiBvYmouZ2V0VmFsdWUoXCJlZGl0b3JcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGVzaWduKG5ldyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduKCkuX2Zyb21Eb2N1bWVudChvYmouZGVzaWduKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZGl0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lZGl0b3IobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmouZWRpdG9yKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVmVyc2lvbl9IaXN0b3J5XCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGVzaWduID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRyZXQuZGVzaWduID0gcmV0LmRlc2lnbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzaWduKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZXNpZ24pLmxlbmd0aCkgcmV0LmRlc2lnbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VkaXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVkaXRvciA9IHRoaXMuZWRpdG9yKCk7XG5cblx0XHRpZiAocmV0LmVkaXRvcikge1xuXHRcdFx0cmV0LmVkaXRvciA9IHJldC5lZGl0b3IuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmVkaXRvcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZWRpdG9yKS5sZW5ndGgpIHJldC5lZGl0b3IgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzaWduXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVzaWduKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbih0aGlzLmRlc2lnbigpLl91bmlxdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWRpdG9yXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZWRpdG9yKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVkaXRvcih0aGlzLmVkaXRvcigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJWZXJzaW9uIEhpc3RvcnlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcImRlc2lnbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNpZ24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVzaWduJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2lnbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZWRpdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VkaXRvcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lZGl0b3IoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiVmVyc2lvbiBIaXN0b3J5XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJlZGl0b3IgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIgKyBcImVkaXRvcltlZGl0b3JdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZWRpdG9yKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWRpdG9yJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VkaXRvcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlZGl0b3InKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlZGl0b3InLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uZGVzaWduIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZXNpZ24gPSB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZXNpZ24pIHJldCArPSAvKih0aGlzLl9kZXNpZ25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZXNpZ24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVzaWduLicpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAvKih0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHlwZSgpLl90b0VRdWVyeShzUGF0aCArICd0eXBlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiU29sdXRpb25fU2VjdGlvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvblwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0ZGVzaWduOiBvYmouZ2V0VmFsdWUoXCJkZXNpZ25cIiksXG5cblx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnR5cGUobmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fU2VjdGlvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGVzaWduID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRyZXQuZGVzaWduID0gcmV0LmRlc2lnbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzaWduKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZXNpZ24pLmxlbmd0aCkgcmV0LmRlc2lnbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRpZiAocmV0LnR5cGUpIHtcblx0XHRcdHJldC50eXBlID0gcmV0LnR5cGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnR5cGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnR5cGUpLmxlbmd0aCkgcmV0LnR5cGUgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2lnblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlc2lnbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ24odGhpcy5kZXNpZ24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTZWN0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwiZGVzaWduIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNpZ24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2lnbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNpZ24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlNvbHV0aW9uIFNlY3Rpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0eXBlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwidHlwZVt0eXBlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGUoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmciLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yYWdlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmFnZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RvcmFnZSA9IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2U7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHRpZiAodGhpcy5fc3RvcmFnZSkgcmV0ICs9IC8qKHRoaXMuX3N0b3JhZ2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zdG9yYWdlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N0b3JhZ2UuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ1wiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHR5cGU6IG9iai5nZXRWYWx1ZShcInR5cGVcIiksXG5cblx0XHRcdFx0XHRzdG9yYWdlOiBvYmouZ2V0VmFsdWUoXCJzdG9yYWdlXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50eXBlKG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RvcmFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnN0b3JhZ2UobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX2Zyb21Eb2N1bWVudChvYmouc3RvcmFnZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ1wiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRpZiAocmV0LnR5cGUpIHtcblx0XHRcdHJldC50eXBlID0gcmV0LnR5cGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnR5cGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnR5cGUpLmxlbmd0aCkgcmV0LnR5cGUgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc3RvcmFnZSA9IHRoaXMuc3RvcmFnZSgpO1xuXG5cdFx0aWYgKHJldC5zdG9yYWdlKSB7XG5cdFx0XHRyZXQuc3RvcmFnZSA9IHJldC5zdG9yYWdlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5zdG9yYWdlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zdG9yYWdlKS5sZW5ndGgpIHJldC5zdG9yYWdlID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdG9yYWdlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RvcmFnZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdG9yYWdlKHRoaXMuc3RvcmFnZSgpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTdG9yYWdlIE1hcHBpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInR5cGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIgKyBcInR5cGVbdHlwZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50eXBlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3N0b3JhZ2VfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuc3RvcmFnZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTdG9yYWdlIE1hcHBpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInN0b3JhZ2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIgKyBcInN0b3JhZ2Vbc3RvcmFnZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zdG9yYWdlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RvcmFnZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdG9yYWdlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0b3JhZ2UnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdG9yYWdlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Cb2FyZF9NZW1iZXIiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfQm9hcmRfTWVtYmVyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0JvYXJkX01lbWJlciBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRfTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5zdGFydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXJ0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdGFydCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3N0YXJ0ID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0YXJ0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5lbmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmVuZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2VuZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5kO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5ib2FyZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ib2FyZCA9IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIubWVtYmVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVtYmVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tZW1iZXIgPSB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zdGFydCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXJ0JyArICh0aGlzLl9zdGFydF9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXJ0KCk7XG5cblx0XHRpZiAodGhpcy5fZW5kKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kJyArICh0aGlzLl9lbmRfY29vcCB8fCAnPScpICsgdGhpcy5lbmQoKTtcblxuXHRcdGlmICh0aGlzLl9ib2FyZCkgcmV0ICs9IC8qKHRoaXMuX2JvYXJkX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYm9hcmQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYm9hcmQuJyk7XG5cblx0XHRpZiAodGhpcy5fbWVtYmVyKSByZXQgKz0gLyoodGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubWVtYmVyKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lbWJlci4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQm9hcmRfTWVtYmVyXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19Cb2FyZF9NZW1iZXJcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0c3RhcnQ6IG9iai5nZXRWYWx1ZShcInN0YXJ0XCIpLFxuXG5cdFx0XHRcdFx0ZW5kOiBvYmouZ2V0VmFsdWUoXCJlbmRcIiksXG5cblx0XHRcdFx0XHRib2FyZDogb2JqLmdldFZhbHVlKFwiYm9hcmRcIiksXG5cblx0XHRcdFx0XHRtZW1iZXI6IG9iai5nZXRWYWx1ZShcIm1lbWJlclwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnN0YXJ0KG9iai5zdGFydCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmQob2JqLmVuZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubWVtYmVyKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkJvYXJkX01lbWJlclwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc3RhcnQgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRpZiAocmV0LnN0YXJ0ICYmIHR5cGVvZihyZXQuc3RhcnQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnQgPSByZXQuc3RhcnQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5kID0gdGhpcy5lbmQoKTtcblxuXHRcdGlmIChyZXQuZW5kICYmIHR5cGVvZihyZXQuZW5kLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmVuZCA9IHJldC5lbmQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5ib2FyZCA9IHRoaXMuYm9hcmQoKTtcblxuXHRcdGlmIChyZXQuYm9hcmQpIHtcblx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYm9hcmQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJvYXJkKS5sZW5ndGgpIHJldC5ib2FyZCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm1lbWJlciA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRpZiAocmV0Lm1lbWJlcikge1xuXHRcdFx0cmV0Lm1lbWJlciA9IHJldC5tZW1iZXIuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0Lm1lbWJlcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWVtYmVyKS5sZW5ndGgpIHJldC5tZW1iZXIgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3RhcnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGFydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydCh0aGlzLnN0YXJ0KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmQodGhpcy5lbmQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZW1iZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZW1iZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVtYmVyKHRoaXMubWVtYmVyKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGFydCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXJ0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5kX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuZCgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5kJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2JvYXJkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkJvYXJkIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwiYm9hcmQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIgKyBcImJvYXJkW2JvYXJkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJvYXJkKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYm9hcmQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYm9hcmQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYm9hcmQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdib2FyZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiQm9hcmQgTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIgKyBcIm1lbWJlclttZW1iZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVtYmVyKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVtYmVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lbWJlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZW1iZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZW1iZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJuYW1lIjoic2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfQ2FwYWJpbGl0eSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQ2FwYWJpbGl0eVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkubW9kdWxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9kdWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb2R1bGUgPSB2O1xuXHRcdFx0dGhpcy5fbW9kdWxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZHVsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2FwYWJpbGl0eV9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2NhcGFiaWxpdHlfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9tb2R1bGUpIHJldCArPSAvKih0aGlzLl9tb2R1bGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tb2R1bGUoKS5fdG9FUXVlcnkoc1BhdGggKyAnbW9kdWxlLicpO1xuXG5cdFx0KHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVJlcXVpcmVtZW50LmNhcGFiaWxpdHksPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkNhcGFiaWxpdHlcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X0NhcGFiaWxpdHlcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdG1vZHVsZTogb2JqLmdldFZhbHVlKFwibW9kdWxlXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZHVsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1vZHVsZShuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyhuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ2FwYWJpbGl0eVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbW9kdWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubW9kdWxlID0gdGhpcy5tb2R1bGUoKTtcblxuXHRcdGlmIChyZXQubW9kdWxlKSB7XG5cdFx0XHRyZXQubW9kdWxlID0gcmV0Lm1vZHVsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQubW9kdWxlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tb2R1bGUpLmxlbmd0aCkgcmV0Lm1vZHVsZSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMgPSB0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb2R1bGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb2R1bGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kdWxlKHRoaXMubW9kdWxlKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbW9kdWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm1vZHVsZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJDYXBhYmlsaXR5XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwibW9kdWxlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIiArIFwibW9kdWxlW21vZHVsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2R1bGUoKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb2R1bGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vZHVsZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb2R1bGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2R1bGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwib2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpKSB0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIENhcGFiaWxpdHkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1Byb2plY3QiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X1Byb2plY3QiLCJuYW1lIjoic2hzX2FyYmZ3X1Byb2plY3QiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfUHJvamVjdCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUHJvamVjdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QudGVhbSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RlYW0gPSB2O1xuXHRcdFx0dGhpcy5fdGVhbV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYnVkZ2V0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YnVkZ2V0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9idWRnZXQgPSB2O1xuXHRcdFx0dGhpcy5fYnVkZ2V0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdF9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9qZWN0X01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcHJvamVjdF9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3RfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdGVhbSkgcmV0ICs9IC8qKHRoaXMuX3RlYW1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50ZWFtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RlYW0uJyk7XG5cblx0XHRpZiAodGhpcy5fYnVkZ2V0KSByZXQgKz0gLyoodGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYnVkZ2V0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2J1ZGdldC4nKTtcblxuXHRcdCh0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllSZXF1aXJlbWVudC5wcm9qZWN0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wcm9qZWN0X01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nLnByb2plY3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiYWN0dWFsQ29zdFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmFjdHVhbENvc3QocGF5bG9hZFtcInRpbGxEYXRlXCJdLCApO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlByb2plY3RcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X1Byb2plY3RcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHRlYW06IG9iai5nZXRWYWx1ZShcInRlYW1cIiksXG5cblx0XHRcdFx0XHRidWRnZXQ6IG9iai5nZXRWYWx1ZShcImJ1ZGdldFwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudGVhbShuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KG9iai50ZWFtKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5idWRnZXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5idWRnZXQobmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KG9iai5idWRnZXQpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdF9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnByb2plY3RfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdF9NZWV0aW5ncykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQcm9qZWN0XCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudGVhbSA9IHRoaXMudGVhbSgpO1xuXG5cdFx0aWYgKHJldC50ZWFtKSB7XG5cdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50ZWFtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50ZWFtKS5sZW5ndGgpIHJldC50ZWFtID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYnVkZ2V0ID0gdGhpcy5idWRnZXQoKTtcblxuXHRcdGlmIChyZXQuYnVkZ2V0KSB7XG5cdFx0XHRyZXQuYnVkZ2V0ID0gcmV0LmJ1ZGdldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYnVkZ2V0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5idWRnZXQpLmxlbmd0aCkgcmV0LmJ1ZGdldCA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdF9SZXF1aXJlbWVudHMgPSB0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5wcm9qZWN0X01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3RfTWVldGluZ3MgPSB0aGlzLnByb2plY3RfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUHJvamVjdCgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInRlYW1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50ZWFtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW0odGhpcy50ZWFtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJidWRnZXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5idWRnZXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYnVkZ2V0KHRoaXMuYnVkZ2V0KCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3RlYW1fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMudGVhbSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJQcm9qZWN0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIgKyBcInRlYW1bdGVhbV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50ZWFtKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGVhbScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGVhbScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2J1ZGdldF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5idWRnZXQoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiUHJvamVjdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcImJ1ZGdldCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIgKyBcImJ1ZGdldFtidWRnZXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYnVkZ2V0KCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYnVkZ2V0JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdidWRnZXQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYnVkZ2V0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYnVkZ2V0JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIm9iai5wcm9qZWN0X1JlcXVpcmVtZW50czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzKSkgdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cyhvYmoucHJvamVjdF9SZXF1aXJlbWVudHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwib2JqLnByb2plY3RfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnByb2plY3RfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnByb2plY3RfTWVldGluZ3MpKSB0aGlzLnByb2plY3RfTWVldGluZ3Mob2JqLnByb2plY3RfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFByb2plY3Quc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFByb2plY3QuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFByb2plY3QuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFByb2plY3QuYWN0dWFsQ29zdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5hY3R1YWxDb3N0KF9fZXZlbnQsIHRpbGxEYXRlKSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YoZXZKU09OLnRpbGxEYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRpbGxEYXRlID0gZXZKU09OLnRpbGxEYXRlO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmFjdHVhbENvc3QoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcikgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHRpbGxEYXRlKSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRoaXMuZ2V0UGFyYW1ldGVyKCd0aWxsRGF0ZScpKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRpbGxEYXRlID0gdGhpcy5nZXRQYXJhbWV0ZXIoJ3RpbGxEYXRlJyk7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnNjcmlwdEZpbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzY3JpcHRGaWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlID0gdjtcblx0XHRcdHRoaXMuX3NjcmlwdEZpbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0RmlsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS50YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN5c19zY3JpcHRfaW5jbHVkZVwiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS50YWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaWMzbHpYM05qY21sd2RGOXBibU5zZFdSbEluMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3NjcmlwdEZpbGUpIHJldCArPSAvKih0aGlzLl9zY3JpcHRGaWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2NyaXB0RmlsZSgpLl90b0VRdWVyeShzUGF0aCArICdzY3JpcHRGaWxlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiU2NyaXB0X0NvbXBhdGliaWxpdHlcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHlcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHNjcmlwdEZpbGU6IG9iai5nZXRWYWx1ZShcInNjcmlwdEZpbGVcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdEZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zY3JpcHRGaWxlKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNjcmlwdEZpbGUpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTY3JpcHRfQ29tcGF0aWJpbGl0eVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NjcmlwdEZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zY3JpcHRGaWxlID0gdGhpcy5zY3JpcHRGaWxlKCk7XG5cblx0XHRpZiAocmV0LnNjcmlwdEZpbGUpIHtcblx0XHRcdHJldC5zY3JpcHRGaWxlID0gcmV0LnNjcmlwdEZpbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnNjcmlwdEZpbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNjcmlwdEZpbGUpLmxlbmd0aCkgcmV0LnNjcmlwdEZpbGUgPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlID0gdGhpcy50YWJsZSgpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zY3JpcHRGaWxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjcmlwdEZpbGUodGhpcy5zY3JpcHRGaWxlKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NyaXB0RmlsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNjcmlwdEZpbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2NyaXB0RmlsZSh0aGlzLnNjcmlwdEZpbGUoKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zY3JpcHRGaWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3NjcmlwdEZpbGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuc2NyaXB0RmlsZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJTY3JpcHQgQ29tcGF0aWJpbGl0eVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJzY3JpcHRGaWxlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIgKyBcInNjcmlwdEZpbGVbc2NyaXB0RmlsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zY3JpcHRGaWxlKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2NyaXB0ZmlsZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NjcmlwdGZpbGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2NyaXB0ZmlsZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NjcmlwdGZpbGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19lc19sYXRlc3Rfc2NyaXB0Jyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkFjdGlvbl9TdGVwXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9TdGVwXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdGlmIChyZXQuYWN0aW9uKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3RlcF9pbnN0YW5jZSddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkFjdGlvbiBTdGVwXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuYWN0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3Rpb24gPSB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb24pIHJldCArPSAvKih0aGlzLl9hY3Rpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hY3Rpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQWN0aW9uX1N0ZXBfSW5wdXRcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXRcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX1N0ZXBfSW5wdXRcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdHJldC5hY3Rpb24gPSByZXQuYWN0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0Jyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiQWN0aW9uIFN0ZXAgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnLCBbJyonXSlbJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnLCBbJyonXSlbJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnLCBbJyonXSlbJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgiLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXgubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZGVzaWduIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZXNpZ24gPSB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZXNpZ24pIHJldCArPSAvKih0aGlzLl9kZXNpZ25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZXNpZ24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVzaWduLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlNvbHV0aW9uX0FwcGVuZGl4XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeFwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGRlc2lnbjogb2JqLmdldFZhbHVlKFwiZGVzaWduXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX0FwcGVuZGl4XCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRpZiAocmV0LmRlc2lnbikge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHJldC5kZXNpZ24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNpZ25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZXNpZ24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduKHRoaXMuZGVzaWduKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU29sdXRpb24gQXBwZW5kaXhcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwiZGVzaWduIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIgKyBcImRlc2lnbltkZXNpZ25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVzaWduKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzaWduJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVzaWduJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2lnbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5kZWNpc2lvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWNpc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZWNpc2lvbikgcmV0ICs9IC8qKHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVjaXNpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVjaXNpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkRlY2lzaW9uX09wdGlvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGRlY2lzaW9uOiBvYmouZ2V0VmFsdWUoXCJkZWNpc2lvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRlY2lzaW9uKG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRlY2lzaW9uX09wdGlvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGVjaXNpb24gPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRyZXQuZGVjaXNpb24gPSByZXQuZGVjaXNpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmRlY2lzaW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWNpc2lvbikubGVuZ3RoKSByZXQuZGVjaXNpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZWNpc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWNpc2lvbih0aGlzLmRlY2lzaW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVjaXNpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZWNpc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWNpc2lvbih0aGlzLmRlY2lzaW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkRlY2lzaW9uIE9wdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwiZGVjaXNpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIgKyBcImRlY2lzaW9uW2RlY2lzaW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlY2lzaW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVjaXNpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZWNpc2lvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZ19TZXJpZXMiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIiwibmFtZSI6InNoc19hcmJmd19NZWV0aW5nX1NlcmllcyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19NZWV0aW5nX1NlcmllcyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ19TZXJpZXNcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZyZXF1ZW5jeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZnJlcXVlbmN5ID0gdjtcblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcmVxdWVuY3k7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc2VyaWVzX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VyaWVzX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zZXJpZXNfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZnJlcXVlbmN5KSByZXQgKz0gLyoodGhpcy5fZnJlcXVlbmN5X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZnJlcXVlbmN5KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2ZyZXF1ZW5jeS4nKTtcblxuXHRcdCh0aGlzLnNlcmllc19NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5zZXJpZXMsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJNZWV0aW5nX1Nlcmllc1wiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfTWVldGluZ19TZXJpZXNcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRmcmVxdWVuY3k6IG9iai5nZXRWYWx1ZShcImZyZXF1ZW5jeVwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5mcmVxdWVuY3kpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5mcmVxdWVuY3kobmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3kpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNlcmllc19NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNlcmllc19NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5zZXJpZXNfTWVldGluZ3MpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ19TZXJpZXNcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZnJlcXVlbmN5ID0gdGhpcy5mcmVxdWVuY3koKTtcblxuXHRcdGlmIChyZXQuZnJlcXVlbmN5KSB7XG5cdFx0XHRyZXQuZnJlcXVlbmN5ID0gcmV0LmZyZXF1ZW5jeS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuZnJlcXVlbmN5KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mcmVxdWVuY3kpLmxlbmd0aCkgcmV0LmZyZXF1ZW5jeSA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuc2VyaWVzX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlcmllc19NZWV0aW5ncyA9IHRoaXMuc2VyaWVzX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJlcXVlbmN5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZnJlcXVlbmN5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyZXF1ZW5jeSh0aGlzLmZyZXF1ZW5jeSgpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2ZyZXF1ZW5jeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mcmVxdWVuY3lfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZnJlcXVlbmN5KCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIk1lZXRpbmcgU2VyaWVzXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcImZyZXF1ZW5jeSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiICsgXCJmcmVxdWVuY3lbZnJlcXVlbmN5XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZyZXF1ZW5jeSgpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ZyZXF1ZW5jeScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ZyZXF1ZW5jeScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmcmVxdWVuY3knKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcmVxdWVuY3knLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJvYmouc2VyaWVzX01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zZXJpZXNfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNlcmllc19NZWV0aW5ncykpIHRoaXMuc2VyaWVzX01lZXRpbmdzKG9iai5zZXJpZXNfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01vZHVsZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfTW9kdWxlIiwibmFtZSI6InNoc19hcmJmd19Nb2R1bGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfTW9kdWxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Nb2R1bGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnBsYXRmb3JtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGxhdGZvcm0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3BsYXRmb3JtID0gdjtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYXRmb3JtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5tb2R1bGVfQ2FwYWJpbGl0eXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb2R1bGVfQ2FwYWJpbGl0eXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tb2R1bGVfQ2FwYWJpbGl0eXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tb2R1bGVfQ2FwYWJpbGl0eXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wbGF0Zm9ybSkgcmV0ICs9IC8qKHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGxhdGZvcm0oKS5fdG9FUXVlcnkoc1BhdGggKyAncGxhdGZvcm0uJyk7XG5cblx0XHQodGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUNhcGFiaWxpdHkubW9kdWxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIk1vZHVsZVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfTW9kdWxlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdHBsYXRmb3JtOiBvYmouZ2V0VmFsdWUoXCJwbGF0Zm9ybVwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnBsYXRmb3JtKG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KG9iai5wbGF0Zm9ybSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kdWxlX0NhcGFiaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNb2R1bGVcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnBsYXRmb3JtID0gdGhpcy5wbGF0Zm9ybSgpO1xuXG5cdFx0aWYgKHJldC5wbGF0Zm9ybSkge1xuXHRcdFx0cmV0LnBsYXRmb3JtID0gcmV0LnBsYXRmb3JtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5wbGF0Zm9ybSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucGxhdGZvcm0pLmxlbmd0aCkgcmV0LnBsYXRmb3JtID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kdWxlX0NhcGFiaWxpdHlzID0gdGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTW9kdWxlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGxhdGZvcm1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wbGF0Zm9ybSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wbGF0Zm9ybSh0aGlzLnBsYXRmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3BsYXRmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnBsYXRmb3JtKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIk1vZHVsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwicGxhdGZvcm0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIgKyBcInBsYXRmb3JtW3BsYXRmb3JtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBsYXRmb3JtKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGxhdGZvcm0nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwbGF0Zm9ybScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwib2JqLm1vZHVsZV9DYXBhYmlsaXR5czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubW9kdWxlX0NhcGFiaWxpdHlzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMpKSB0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cyhvYmoubW9kdWxlX0NhcGFiaWxpdHlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBNb2R1bGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIE1vZHVsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogTW9kdWxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQiLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJSb2xsYmFja19Db250ZXh0XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHRcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUm9sbGJhY2tfQ29udGV4dFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiUm9sbGJhY2sgQ29udGV4dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNjcmlwdF9Db21wYXRpYmlsaXR5LnNjcmlwdEZpbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlNjcmlwdF9GaWxlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2NyaXB0X0ZpbGVcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyA9IHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2luY2x1ZGUnLCBbJyonXSlbJ3N5c19zY3JpcHRfaW5jbHVkZSddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlNjcmlwdCBGaWxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMpKSB0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9pbmNsdWRlJywgWycqJ10pWydzeXNfc2NyaXB0X2luY2x1ZGUnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0IiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRml4X1NjcmlwdFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZpeF9TY3JpcHRcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NjcmlwdF9maXgnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIkZpeCBTY3JpcHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NjcmlwdF9maXgnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRml4X1NjcmlwdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRml4X1NjcmlwdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NjcmlwdF9maXgnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRml4X1NjcmlwdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UYWJsZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9UYWJsZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9UYWJsZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1RhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVGFibGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUudGFibGVfQ29sdW1ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlX0NvbHVtbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90YWJsZV9Db2x1bW5zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGFibGVfQ29sdW1uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGFibGVfQ29sdW1ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfQ29sdW1ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9Db2x1bW5zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0NvbHVtbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQ29sdW1uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0NvbHVtbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0Zsb3dfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X091dHB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfT3V0cHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19WYXJpYWJsZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0FjdGlvbl9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmV4dGVuZHMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZXh0ZW5kcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2V4dGVuZHMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IChfdGhpcykgPT4gX3RoaXMuX21hcCgnY2xhc3MuZXh0ZW5kcycsIGZhbHNlLCAnX3RvSlNPTicsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIF90aGlzLm5hbWUoKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLmV4dGVuZHMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLRjkwYUdsektTQTlQaUJmZEdocGN5NWZiV0Z3S0NkamJHRnpjeTVsZUhSbGJtUnpKeXdnWm1Gc2MyVXNJQ2RmZEc5S1UwOU9KeXdnZFc1a1pXWnBibVZrTENCMWJtUmxabWx1WldRc0lIVnVaR1ZtYVc1bFpDd2dYM1JvYVhNdWJtRnRaU2dwS1NKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuX19pZEZpZWxkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9faWRGaWVsZCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19faWRGaWVsZCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gXCJuYW1lXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9faWRGaWVsZCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaWJtRnRaU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHQodGhpcy50YWJsZV9Db2x1bW5zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllDb2x1bW4udGFibGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllDb2x1bW4ucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNhdmVfU3Vic2NyaXB0aW9uLnRhYmxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5wdXQucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X091dHB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19WYXJpYWJsZS5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnN0YW5jZV9JbnB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5wdXQucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19EYXRhX1ZhcmlhYmxlLnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiVGFibGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfVGFibGVcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGVfQ29sdW1ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRhYmxlX0NvbHVtbnMobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLnRhYmxlX0NvbHVtbnMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfQ29sdW1ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfQ29sdW1ucykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUYWJsZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnRhYmxlX0NvbHVtbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGVfQ29sdW1ucyA9IHRoaXMudGFibGVfQ29sdW1ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0NvbHVtbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0NvbHVtbnMgPSB0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zID0gdGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfRmxvd19JbnB1dHMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfRmxvd19PdXRwdXRzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMgPSB0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmV4dGVuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZXh0ZW5kcyA9IHRoaXMuZXh0ZW5kcygpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fX2lkRmllbGQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19pZEZpZWxkID0gdGhpcy5fX2lkRmllbGQoKTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kYl9vYmplY3QnLCBbJyonXSlbJ3N5c19kYl9vYmplY3QnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiVGFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RiX29iamVjdCcsIFsnKiddKVsnc3lzX2RiX29iamVjdCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZGJfb2JqZWN0Jyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RiX29iamVjdCcsIFsnKiddKVsnc3lzX2RiX29iamVjdCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai50YWJsZV9Db2x1bW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50YWJsZV9Db2x1bW5zLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai50YWJsZV9Db2x1bW5zKSkgdGhpcy50YWJsZV9Db2x1bW5zKG9iai50YWJsZV9Db2x1bW5zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0NvbHVtbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9Db2x1bW5zLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfQ29sdW1ucykpIHRoaXMucmVmZXJlbmNlX0NvbHVtbnMob2JqLnJlZmVyZW5jZV9Db2x1bW5zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucykpIHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5wdXRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cyhvYmoucmVmZXJlbmNlX0Zsb3dfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyhvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMpKSB0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFRhYmxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBUYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RiX29iamVjdCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmdcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcudmFsdWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2YWx1ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdmFsdWUgPSB2O1xuXHRcdFx0dGhpcy5fdmFsdWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmFsdWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gXCJbJ2lkJywgJ2ZpZWxkJywgJ3RhYmxlJ11cIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVd5ZHBaQ2NzSUNkbWFXVnNaQ2NzSUNkMFlXSnNaU2RkSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdmFsdWUpIHJldCArPSAnXicgKyBzUGF0aCArICd2YWx1ZScgKyAodGhpcy5fdmFsdWVfY29vcCB8fCAnPScpICsgdGhpcy52YWx1ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdCh0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllWYXJpYWJsZV9WYWx1ZS5tYXBwaW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUGlsbF9Db21wb3VuZC5lbGVtZW50TWFwcGluZyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkVsZW1lbnRfTWFwcGluZ1wiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmdcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHR2YWx1ZTogb2JqLmdldFZhbHVlKFwidmFsdWVcIiksXG5cblx0XHRcdFx0XHRibG9jazogb2JqLmdldFZhbHVlKFwiYmxvY2tcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudmFsdWUob2JqLnZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJFbGVtZW50X01hcHBpbmdcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudmFsdWUgPSB0aGlzLnZhbHVlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyA9IHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YWx1ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhbHVlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhbHVlKHRoaXMudmFsdWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lbGVtZW50X21hcHBpbmcnLCBbJyonXSlbJ3N5c19lbGVtZW50X21hcHBpbmcnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZWxlbWVudF9tYXBwaW5nJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl92YWx1ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFsdWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFsdWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmFsdWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2YWx1ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiRWxlbWVudCBNYXBwaW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lbGVtZW50X21hcHBpbmcnLCBbJyonXSlbJ3N5c19lbGVtZW50X21hcHBpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyhvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKSkgdGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fQWN0aW9uX0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX1N0ZXBzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9TdGVwcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFjdGlvbl9JbnN0YW5jZS5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5wdXQuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fU3RlcC5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFjdGlvbl9TdGVwX0lucHV0LmFjdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQWN0aW9uX1R5cGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGVcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9UeXBlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0fVxuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX0lucHV0cyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9TdGVwcyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzID0gdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJBY3Rpb24gVHlwZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyhvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9BY3Rpb25fSW5wdXRzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cyhvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbiIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnRyYW5zZm9ybSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRyYW5zZm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHJhbnNmb3JtID0gdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm07XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb25cIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0dHJhbnNmb3JtOiBvYmouZ2V0VmFsdWUoXCJ0cmFuc2Zvcm1cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnRyYW5zZm9ybShuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50cmFuc2Zvcm0gPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0aWYgKHJldC50cmFuc2Zvcm0pIHtcblx0XHRcdHJldC50cmFuc2Zvcm0gPSByZXQudHJhbnNmb3JtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRyYW5zZm9ybSkubGVuZ3RoKSByZXQudHJhbnNmb3JtID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHJhbnNmb3JtXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHJhbnNmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybSh0aGlzLnRyYW5zZm9ybSgpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJUcmFuc2Zvcm0gQ29tcG9zaXRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRyYW5zZm9ybSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIiArIFwidHJhbnNmb3JtW3RyYW5zZm9ybV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50cmFuc2Zvcm0oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0cmFuc2Zvcm0nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHJhbnNmb3JtJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RyYW5zZm9ybScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RyYW5zZm9ybScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9GbG93X0RhdGEiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmRlZmluaXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZWZpbml0aW9uKSByZXQgKz0gLyoodGhpcy5fZGVmaW5pdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlZmluaXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVmaW5pdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0RhdGFcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0ZGVmaW5pdGlvbjogb2JqLmdldFZhbHVlKFwiZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRlZmluaXRpb24obmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0RhdGFcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kZWZpbml0aW9uID0gdGhpcy5kZWZpbml0aW9uKCk7XG5cblx0XHRpZiAocmV0LmRlZmluaXRpb24pIHtcblx0XHRcdHJldC5kZWZpbml0aW9uID0gcmV0LmRlZmluaXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmRlZmluaXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlZmluaXRpb24pLmxlbmd0aCkgcmV0LmRlZmluaXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZGF0YScpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RlZmluaXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJGbG93IERhdGFcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcImRlZmluaXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR2ID0gLTE7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIgKyBcImRlZmluaXRpb25bZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZpbml0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVmaW5pdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWZpbml0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZWZpbml0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGEnLCBbJyonXSlbJ3N5c19mbG93X2RhdGEnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2RhdGEnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEZsb3dfRGF0YS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRmxvd19EYXRhLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19kYXRhJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGEnLCBbJyonXSlbJ3N5c19mbG93X2RhdGEnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0RhdGEuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9TZWN1cml0eV9Db250cm9scyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU2VjdXJpdHlfQ29udHJvbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVfU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2VjdXJpdHlfQ29udHJvbC50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlNlY3VyaXR5X1R5cGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZVwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTZWN1cml0eV9UeXBlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZV9TZWN1cml0eV9Db250cm9scyA9IHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NlY3VyaXR5X3R5cGUnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0LyppZihcIlNlY3VyaXR5IFR5cGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X3R5cGUnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKSkgdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zZWN1cml0eV90eXBlJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX29wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX29wZXJhdGlvbl9TZWN1cml0eV9Db250cm9sc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2VjdXJpdHlfQ29udHJvbC5vcGVyYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJTZWN1cml0eV9PcGVyYXRpb25cIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdXJpdHlfT3BlcmF0aW9uXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gdGhpcy5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgT3BlcmF0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHYgPSAtMTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nLCBbJyonXSlbJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSkgdGhpcy5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19QbGF0Zm9ybSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfUGxhdGZvcm0iLCJuYW1lIjoic2hzX2FyYmZ3X1BsYXRmb3JtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1BsYXRmb3JtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19QbGF0Zm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ucGxhdGZvcm1fTW9kdWxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBsYXRmb3JtX01vZHVsZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wbGF0Zm9ybV9Nb2R1bGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fTW9kdWxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGxhdGZvcm1fTW9kdWxlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnBsYXRmb3JtX01vZHVsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1vZHVsZS5wbGF0Zm9ybSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJpbml0XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuaW5pdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJQbGF0Zm9ybVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfUGxhdGZvcm1cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGxhdGZvcm1fTW9kdWxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBsYXRmb3JtX01vZHVsZXMobmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG9iai5wbGF0Zm9ybV9Nb2R1bGVzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlBsYXRmb3JtXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRpZiAoYy5pbmRleE9mKCdzaHNfYXJiZndfJykgIT0gMCkgYyA9ICh7XG5cdFx0UGxhdGZvcm06IFwic2hzX2FyYmZ3X1BsYXRmb3JtXCIsXG5cdFx0VXNlcjogXCJzaHNfYXJiZndfVXNlclwiLFxuXHRcdFJlcXVpcmVtZW50OiBcInNoc19hcmJmd19SZXF1aXJlbWVudFwiLFxuXHRcdEVmZm9ydF9Fc3RpbWF0ZTogXCJzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlXCIsXG5cdFx0RWZmb3J0OiBcInNoc19hcmJmd19FZmZvcnRcIixcblx0XHRCdWRnZXQ6IFwic2hzX2FyYmZ3X0J1ZGdldFwiLFxuXHRcdFRhc2s6IFwic2hzX2FyYmZ3X1Rhc2tcIixcblx0XHRTb2x1dGlvbl9EZXNpZ246IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnblwiLFxuXHRcdFZlcnNpb25fSGlzdG9yeTogXCJzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5XCIsXG5cdFx0U29sdXRpb25fU2VjdGlvbjogXCJzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvblwiLFxuXHRcdFNlY3Rpb25fVHlwZTogXCJzaHNfYXJiZndfU2VjdGlvbl9UeXBlXCIsXG5cdFx0U29sdXRpb25fU3RvcmFnZTogXCJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZVwiLFxuXHRcdFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZzogXCJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nXCIsXG5cdFx0U29sdXRpb25fQXBwZW5kaXg6IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4XCIsXG5cdFx0QWdlbmRhX0l0ZW06IFwic2hzX2FyYmZ3X0FnZW5kYV9JdGVtXCIsXG5cdFx0TWVldGluZ19BZ2VuZGE6IFwic2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhXCIsXG5cdFx0RGVjaXNpb25fT3B0aW9uOiBcInNoc19hcmJmd19EZWNpc2lvbl9PcHRpb25cIixcblx0XHREZWNpc2lvbjogXCJzaHNfYXJiZndfRGVjaXNpb25cIixcblx0XHRNZWV0aW5nX01pbnV0ZTogXCJzaHNfYXJiZndfTWVldGluZ19NaW51dGVcIixcblx0XHRNZWV0aW5nX1NlcmllczogXCJzaHNfYXJiZndfTWVldGluZ19TZXJpZXNcIixcblx0XHRNZWV0aW5nOiBcInNoc19hcmJmd19NZWV0aW5nXCIsXG5cdFx0Qm9hcmQ6IFwic2hzX2FyYmZ3X0JvYXJkXCIsXG5cdFx0Qm9hcmRfTWVtYmVyOiBcInNoc19hcmJmd19Cb2FyZF9NZW1iZXJcIixcblx0XHRGcmVxdWVuY3k6IFwic2hzX2FyYmZ3X0ZyZXF1ZW5jeVwiLFxuXHRcdE1vZHVsZTogXCJzaHNfYXJiZndfTW9kdWxlXCIsXG5cdFx0Q2FwYWJpbGl0eTogXCJzaHNfYXJiZndfQ2FwYWJpbGl0eVwiLFxuXHRcdFRlYW06IFwic2hzX2FyYmZ3X1RlYW1cIixcblx0XHRQcm9qZWN0OiBcInNoc19hcmJmd19Qcm9qZWN0XCIsXG5cdFx0VGVhbV9NZW1iZXI6IFwic2hzX2FyYmZ3X1RlYW1fTWVtYmVyXCIsXG5cdFx0Um9sZTogXCJzaHNfYXJiZndfUm9sZVwiLFxuXHRcdEFwcGxpY2F0aW9uOiBcInNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uXCIsXG5cdFx0Um9sbGJhY2tfQ29udGV4dDogXCJzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0XCIsXG5cdFx0UXVldWU6IFwic2hzX2FyYmZ3X2FwcGRfUXVldWVcIixcblx0XHRTY3JpcHRfRmlsZTogXCJzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZVwiLFxuXHRcdFNjcmlwdF9Db21wYXRpYmlsaXR5OiBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5XCIsXG5cdFx0Rml4X1NjcmlwdDogXCJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0XCIsXG5cdFx0VGFibGU6IFwic2hzX2FyYmZ3X2FwcGRfVGFibGVcIixcblx0XHRDb2x1bW46IFwic2hzX2FyYmZ3X2FwcGRfQ29sdW1uXCIsXG5cdFx0Q29ubmVjdGlvbjogXCJzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uXCIsXG5cdFx0U3Vic2NyaXB0aW9uX1RyaWdnZXI6IFwic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXJcIixcblx0XHRTYXZlX1N1YnNjcmlwdGlvbjogXCJzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvblwiLFxuXHRcdEZsb3c6IFwic2hzX2FyYmZ3X2FwcGRfRmxvd1wiLFxuXHRcdEZsb3dfSW5wdXQ6IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dFwiLFxuXHRcdEZsb3dfT3V0cHV0OiBcInNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0XCIsXG5cdFx0Rmxvd19WYXJpYWJsZTogXCJzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlXCIsXG5cdFx0RmllbGRfTGFiZWw6IFwic2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWxcIixcblx0XHRMb2dpY19EZWZpbml0aW9uOiBcInNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb25cIixcblx0XHRGbG93X0xvZ2ljOiBcInNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWNcIixcblx0XHRGbG93X0luc3RhbmNlOiBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VcIixcblx0XHRGbG93X0luc3RhbmNlX0lucHV0OiBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXRcIixcblx0XHRBY3Rpb25fSW5zdGFuY2U6IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlXCIsXG5cdFx0VmFyaWFibGVfVmFsdWU6IFwic2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWVcIixcblx0XHRGbG93X0Jsb2NrOiBcInNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2tcIixcblx0XHRFbGVtZW50X01hcHBpbmc6IFwic2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nXCIsXG5cdFx0Rmxvd19JbnB1dF9TY3JpcHQ6IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHRcIixcblx0XHRBY3Rpb25fVHlwZTogXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZVwiLFxuXHRcdEFjdGlvbl9JbnB1dDogXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXRcIixcblx0XHRBY3Rpb25fU3RlcDogXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcFwiLFxuXHRcdEFjdGlvbl9TdGVwX0lucHV0OiBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0XCIsXG5cdFx0Rmxvd19QbGFuOiBcInNoc19hcmJmd19hcHBkX0Zsb3dfUGxhblwiLFxuXHRcdEZsb3dfU2V0dGluZzogXCJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmdcIixcblx0XHRGbG93X1NuYXBzaG90OiBcInNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3RcIixcblx0XHRQaWxsX0NvbXBvdW5kOiBcInNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmRcIixcblx0XHRUcmFuc2Zvcm06IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtXCIsXG5cdFx0VHJhbnNmb3JtX0NvbXBvc2l0aW9uOiBcInNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvblwiLFxuXHRcdERhdGFfRGVmaW5pdGlvbjogXCJzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb25cIixcblx0XHRGbG93X0RhdGE6IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhXCIsXG5cdFx0Rmxvd19EYXRhX1ZhcmlhYmxlOiBcInNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZVwiLFxuXHRcdFNlY3VyaXR5X0NvbnRyb2w6IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbFwiLFxuXHRcdFNlY3VyaXR5X1R5cGU6IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZVwiLFxuXHRcdFNlY3VyaXR5X09wZXJhdGlvbjogXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb25cIixcblx0fSlbY107XG5cdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogKVtjXSgpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnBsYXRmb3JtX01vZHVsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGxhdGZvcm1fTW9kdWxlcyA9IHRoaXMucGxhdGZvcm1fTW9kdWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwib2JqLnBsYXRmb3JtX01vZHVsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBsYXRmb3JtX01vZHVsZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBsYXRmb3JtX01vZHVsZXMpKSB0aGlzLnBsYXRmb3JtX01vZHVsZXMob2JqLnBsYXRmb3JtX01vZHVsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogUGxhdGZvcm0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFBsYXRmb3JtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogUGxhdGZvcm0uaW5pdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5pbml0KF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uaW5pdCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSBldkpTT047XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVXNlciIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfVXNlciIsIm5hbWUiOiJzaHNfYXJiZndfVXNlciIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Vc2VyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Vc2VyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9lZGl0b3JfVmVyc2lvbl9IaXN0b3J5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5vcmdhbml6ZXJfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmdhbml6ZXJfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm1vZGVyYXRvcl9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZXJhdG9yX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX0JvYXJkX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXJfQm9hcmRfTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX0JvYXJkX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX1RlYW1fTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcl9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZW1iZXJfVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllWZXJzaW9uX0hpc3RvcnkuZWRpdG9yLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcub3JnYW5pemVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcubW9kZXJhdG9yLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQm9hcmRfTWVtYmVyLm1lbWJlciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVGVhbV9NZW1iZXIubWVtYmVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Vc2VyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJVc2VyXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19Vc2VyXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfVXNlcigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyhuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JnYW5pemVyX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMub3JnYW5pemVyX01lZXRpbmdzKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm9yZ2FuaXplcl9NZWV0aW5ncykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tb2RlcmF0b3JfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXJfVGVhbV9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycyhuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoubWVtYmVyX1RlYW1fTWVtYmVycykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJVc2VyXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzID0gdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcl9NZWV0aW5ncyA9IHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZXJhdG9yX01lZXRpbmdzID0gdGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcl9Cb2FyZF9NZW1iZXJzID0gdGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXJfVGVhbV9NZW1iZXJzID0gdGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1VzZXIoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c191c2VyJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVXNlcigpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c191c2VyJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cykpIHRoaXMuZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoub3JnYW5pemVyX01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5vcmdhbml6ZXJfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm9yZ2FuaXplcl9NZWV0aW5ncykpIHRoaXMub3JnYW5pemVyX01lZXRpbmdzKG9iai5vcmdhbml6ZXJfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubW9kZXJhdG9yX01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tb2RlcmF0b3JfTWVldGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykpIHRoaXMubW9kZXJhdG9yX01lZXRpbmdzKG9iai5tb2RlcmF0b3JfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubWVtYmVyX0JvYXJkX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykpIHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubWVtYmVyX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVtYmVyX1RlYW1fTWVtYmVycywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVtYmVyX1RlYW1fTWVtYmVycykpIHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycyhvYmoubWVtYmVyX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFVzZXIuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFVzZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c191c2VyJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFVzZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0VmZm9ydCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfRWZmb3J0IiwibmFtZSI6InNoc19hcmJmd19FZmZvcnQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfRWZmb3J0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19FZmZvcnRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnRfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllFZmZvcnRfRXN0aW1hdGUuZWZmb3J0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkVmZm9ydFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfRWZmb3J0XCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWZmb3J0XCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyA9IHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRWZmb3J0KCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEVmZm9ydC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRWZmb3J0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBFZmZvcnQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0J1ZGdldCIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfQnVkZ2V0IiwibmFtZSI6InNoc19hcmJmd19CdWRnZXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfQnVkZ2V0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19CdWRnZXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmJ1ZGdldF9Qcm9qZWN0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJ1ZGdldF9Qcm9qZWN0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2J1ZGdldF9Qcm9qZWN0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2J1ZGdldF9Qcm9qZWN0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYnVkZ2V0X1Byb2plY3RzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllQcm9qZWN0LmJ1ZGdldCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJCdWRnZXRcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X0J1ZGdldFwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYnVkZ2V0X1Byb2plY3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYnVkZ2V0X1Byb2plY3RzKG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQob2JqLmJ1ZGdldF9Qcm9qZWN0cykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJCdWRnZXRcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmJ1ZGdldF9Qcm9qZWN0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5idWRnZXRfUHJvamVjdHMgPSB0aGlzLmJ1ZGdldF9Qcm9qZWN0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19CdWRnZXQoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIm9iai5idWRnZXRfUHJvamVjdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJ1ZGdldF9Qcm9qZWN0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYnVkZ2V0X1Byb2plY3RzKSkgdGhpcy5idWRnZXRfUHJvamVjdHMob2JqLmJ1ZGdldF9Qcm9qZWN0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogQnVkZ2V0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBCdWRnZXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEJ1ZGdldC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVGFzayIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfVGFzayIsIm5hbWUiOiJzaHNfYXJiZndfVGFzayIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19UYXNrIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19UYXNrXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2sub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UYXNrKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJUYXNrXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19UYXNrXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfVGFzaygpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRhc2tcIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19UYXNrKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndGFzaycpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndGFzaycpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogVGFzay5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGFzay5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndGFzaycpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGFzay5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU2VjdGlvbl9UeXBlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19TZWN0aW9uX1R5cGUiLCJuYW1lIjoic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19TZWN0aW9uX1R5cGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGVfU29sdXRpb25fU2VjdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90eXBlX1NvbHV0aW9uX1NlY3Rpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTb2x1dGlvbl9TZWN0aW9uLnR5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnR5cGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiU2VjdGlvbl9UeXBlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19TZWN0aW9uX1R5cGVcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdGlvbl9UeXBlXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGVfU29sdXRpb25fU2VjdGlvbnMgPSB0aGlzLnR5cGVfU29sdXRpb25fU2VjdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgPSB0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKSkgdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmoudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpIHRoaXMudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSIsIm5hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JhZ2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlNvbHV0aW9uX1N0b3JhZ2VcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fU3RvcmFnZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gdGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwib2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKSB0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3VuZGVmaW5lZCcpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19EZWNpc2lvbiIsIm5hbWUiOiJzaHNfYXJiZndfRGVjaXNpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfRGVjaXNpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0RlY2lzaW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRlY2lzaW9uX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb25fTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWURlY2lzaW9uX09wdGlvbi5kZWNpc2lvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcuZGVjaXNpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJEZWNpc2lvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfRGVjaXNpb25cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMobmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb25fTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWNpc2lvbl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbl9NZWV0aW5ncykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJEZWNpc2lvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9IHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fTWVldGluZ3MgPSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykpIHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyhvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWNpc2lvbl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVjaXNpb25fTWVldGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlY2lzaW9uX01lZXRpbmdzKSkgdGhpcy5kZWNpc2lvbl9NZWV0aW5ncyhvYmouZGVjaXNpb25fTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIERlY2lzaW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBEZWNpc2lvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0JvYXJkIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19Cb2FyZCIsIm5hbWUiOiJzaHNfYXJiZndfQm9hcmQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfQm9hcmQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0JvYXJkXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5ib2FyZF9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYm9hcmRfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYm9hcmRfQm9hcmRfTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX0JvYXJkX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJvYXJkX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nLmJvYXJkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllCb2FyZF9NZW1iZXIuYm9hcmQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJCb2FyZFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfQm9hcmRcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmRfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ib2FyZF9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZF9NZWV0aW5ncykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmRfQm9hcmRfTWVtYmVycykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJCb2FyZFwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmJvYXJkX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJvYXJkX01lZXRpbmdzID0gdGhpcy5ib2FyZF9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZF9Cb2FyZF9NZW1iZXJzID0gdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0JvYXJkKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJvYmouYm9hcmRfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJvYXJkX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9NZWV0aW5ncykpIHRoaXMuYm9hcmRfTWVldGluZ3Mob2JqLmJvYXJkX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIm9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzKSkgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIEJvYXJkLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBCb2FyZC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQm9hcmQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0ZyZXF1ZW5jeSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfRnJlcXVlbmN5IiwibmFtZSI6InNoc19hcmJmd19GcmVxdWVuY3kiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfRnJlcXVlbmN5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19GcmVxdWVuY3lcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRhaWx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGFpbHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RhaWx5ID0gdjtcblx0XHRcdHRoaXMuX2RhaWx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhaWx5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS53ZWVrbHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR3ZWVrbHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3dlZWtseSA9IHY7XG5cdFx0XHR0aGlzLl93ZWVrbHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fd2Vla2x5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5tb250aGx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9udGhseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9udGhseSA9IHY7XG5cdFx0XHR0aGlzLl9tb250aGx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vbnRobHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnF1YXJ0ZXJseSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHF1YXJ0ZXJseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcXVhcnRlcmx5ID0gdjtcblx0XHRcdHRoaXMuX3F1YXJ0ZXJseV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9xdWFydGVybHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRheXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kYXlzID0gdjtcblx0XHRcdHRoaXMuX2RheXNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kubW9uZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9uZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb25kYXkgPSB2O1xuXHRcdFx0dGhpcy5fbW9uZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vbmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kudHVlc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR1ZXNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R1ZXNkYXkgPSB2O1xuXHRcdFx0dGhpcy5fdHVlc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90dWVzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS53ZWRuZXNkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR3ZWRuZXNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3dlZG5lc2RheSA9IHY7XG5cdFx0XHR0aGlzLl93ZWRuZXNkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fd2VkbmVzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS50aHVyc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRodXJzZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90aHVyc2RheSA9IHY7XG5cdFx0XHR0aGlzLl90aHVyc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90aHVyc2RheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZnJpZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZnJpZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mcmlkYXkgPSB2O1xuXHRcdFx0dGhpcy5fZnJpZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ZyaWRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc2F0dXJkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzYXR1cmRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc2F0dXJkYXkgPSB2O1xuXHRcdFx0dGhpcy5fc2F0dXJkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F0dXJkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnN1bmRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1bmRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3VuZGF5ID0gdjtcblx0XHRcdHRoaXMuX3N1bmRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdW5kYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGFpbHkpIHJldCArPSAnXicgKyBzUGF0aCArICdkYWlseScgKyAodGhpcy5fZGFpbHlfY29vcCB8fCAnPScpICsgdGhpcy5kYWlseSgpO1xuXG5cdFx0aWYgKHRoaXMuX3dlZWtseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3dlZWtseScgKyAodGhpcy5fd2Vla2x5X2Nvb3AgfHwgJz0nKSArIHRoaXMud2Vla2x5KCk7XG5cblx0XHRpZiAodGhpcy5fbW9udGhseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21vbnRobHknICsgKHRoaXMuX21vbnRobHlfY29vcCB8fCAnPScpICsgdGhpcy5tb250aGx5KCk7XG5cblx0XHRpZiAodGhpcy5fcXVhcnRlcmx5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncXVhcnRlcmx5JyArICh0aGlzLl9xdWFydGVybHlfY29vcCB8fCAnPScpICsgdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdGlmICh0aGlzLl9kYXlzKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF5cycgKyAodGhpcy5fZGF5c19jb29wIHx8ICc9JykgKyB0aGlzLmRheXMoKTtcblxuXHRcdGlmICh0aGlzLl9tb25kYXkpIHJldCArPSAnXicgKyBzUGF0aCArICdtb25kYXknICsgKHRoaXMuX21vbmRheV9jb29wIHx8ICc9JykgKyB0aGlzLm1vbmRheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3R1ZXNkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICd0dWVzZGF5JyArICh0aGlzLl90dWVzZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMudHVlc2RheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3dlZG5lc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3dlZG5lc2RheScgKyAodGhpcy5fd2VkbmVzZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMud2VkbmVzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fdGh1cnNkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICd0aHVyc2RheScgKyAodGhpcy5fdGh1cnNkYXlfY29vcCB8fCAnPScpICsgdGhpcy50aHVyc2RheSgpO1xuXG5cdFx0aWYgKHRoaXMuX2ZyaWRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ZyaWRheScgKyAodGhpcy5fZnJpZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMuZnJpZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fc2F0dXJkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICdzYXR1cmRheScgKyAodGhpcy5fc2F0dXJkYXlfY29vcCB8fCAnPScpICsgdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3N1bmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N1bmRheScgKyAodGhpcy5fc3VuZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMuc3VuZGF5KCk7XG5cblx0XHQodGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nX1Nlcmllcy5mcmVxdWVuY3ksPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRnJlcXVlbmN5XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19GcmVxdWVuY3lcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0ZGFpbHk6IG9iai5nZXRWYWx1ZShcImRhaWx5XCIpLFxuXG5cdFx0XHRcdFx0d2Vla2x5OiBvYmouZ2V0VmFsdWUoXCJ3ZWVrbHlcIiksXG5cblx0XHRcdFx0XHRtb250aGx5OiBvYmouZ2V0VmFsdWUoXCJtb250aGx5XCIpLFxuXG5cdFx0XHRcdFx0cXVhcnRlcmx5OiBvYmouZ2V0VmFsdWUoXCJxdWFydGVybHlcIiksXG5cblx0XHRcdFx0XHRkYXlzOiBvYmouZ2V0VmFsdWUoXCJkYXlzXCIpLFxuXG5cdFx0XHRcdFx0bW9uZGF5OiBvYmouZ2V0VmFsdWUoXCJtb25kYXlcIiksXG5cblx0XHRcdFx0XHR0dWVzZGF5OiBvYmouZ2V0VmFsdWUoXCJ0dWVzZGF5XCIpLFxuXG5cdFx0XHRcdFx0d2VkbmVzZGF5OiBvYmouZ2V0VmFsdWUoXCJ3ZWRuZXNkYXlcIiksXG5cblx0XHRcdFx0XHR0aHVyc2RheTogb2JqLmdldFZhbHVlKFwidGh1cnNkYXlcIiksXG5cblx0XHRcdFx0XHRmcmlkYXk6IG9iai5nZXRWYWx1ZShcImZyaWRheVwiKSxcblxuXHRcdFx0XHRcdHNhdHVyZGF5OiBvYmouZ2V0VmFsdWUoXCJzYXR1cmRheVwiKSxcblxuXHRcdFx0XHRcdHN1bmRheTogb2JqLmdldFZhbHVlKFwic3VuZGF5XCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGFpbHkob2JqLmRhaWx5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZWtseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLndlZWtseShvYmoud2Vla2x5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbnRobHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5tb250aGx5KG9iai5tb250aGx5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnF1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnF1YXJ0ZXJseShvYmoucXVhcnRlcmx5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRheXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXlzKG9iai5kYXlzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1vbmRheShvYmoubW9uZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50dWVzZGF5KG9iai50dWVzZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZG5lc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLndlZG5lc2RheShvYmoud2VkbmVzZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRodXJzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudGh1cnNkYXkob2JqLnRodXJzZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmZyaWRheShvYmouZnJpZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc2F0dXJkYXkob2JqLnNhdHVyZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1bmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnN1bmRheShvYmouc3VuZGF5KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZyZXF1ZW5jeVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGFpbHkgPSB0aGlzLmRhaWx5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fd2Vla2x5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQud2Vla2x5ID0gdGhpcy53ZWVrbHkoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubW9udGhseSA9IHRoaXMubW9udGhseSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3F1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnF1YXJ0ZXJseSA9IHRoaXMucXVhcnRlcmx5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRheXMgPSB0aGlzLmRheXMoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tb25kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5tb25kYXkgPSB0aGlzLm1vbmRheSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50dWVzZGF5ID0gdGhpcy50dWVzZGF5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fd2VkbmVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQud2VkbmVzZGF5ID0gdGhpcy53ZWRuZXNkYXkoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnRodXJzZGF5ID0gdGhpcy50aHVyc2RheSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmZyaWRheSA9IHRoaXMuZnJpZGF5KCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc2F0dXJkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zYXR1cmRheSA9IHRoaXMuc2F0dXJkYXkoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zdW5kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5zdW5kYXkgPSB0aGlzLnN1bmRheSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhaWx5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGFpbHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGFpbHkodGhpcy5kYWlseSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWVrbHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWVrbHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2Vla2x5KHRoaXMud2Vla2x5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vbnRobHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb250aGx5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vbnRobHkodGhpcy5tb250aGx5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInF1YXJ0ZXJseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnF1YXJ0ZXJseSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5xdWFydGVybHkodGhpcy5xdWFydGVybHkoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF5c1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRheXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF5cyh0aGlzLmRheXMoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibW9uZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubW9uZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vbmRheSh0aGlzLm1vbmRheSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0dWVzZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHVlc2RheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50dWVzZGF5KHRoaXMudHVlc2RheSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWRuZXNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWRuZXNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2VkbmVzZGF5KHRoaXMud2VkbmVzZGF5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInRodXJzZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGh1cnNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGh1cnNkYXkodGhpcy50aHVyc2RheSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJmcmlkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mcmlkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZnJpZGF5KHRoaXMuZnJpZGF5KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInNhdHVyZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2F0dXJkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2F0dXJkYXkodGhpcy5zYXR1cmRheSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdW5kYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdW5kYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3VuZGF5KHRoaXMuc3VuZGF5KCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGFpbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGFpbHlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGFpbHkoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYWlseScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYWlseScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYWlseScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhaWx5JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl93ZWVrbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fd2Vla2x5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLndlZWtseSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZWtseScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd3ZWVrbHknKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2Vla2x5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnd2Vla2x5JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX21vbnRobHlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubW9udGhseSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21vbnRobHknKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbW9udGhseScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb250aGx5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbW9udGhseScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcXVhcnRlcmx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3F1YXJ0ZXJseV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdxdWFydGVybHknKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncXVhcnRlcmx5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3F1YXJ0ZXJseScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3F1YXJ0ZXJseScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXlzX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRheXMoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXlzJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RheXMnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF5cycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RheXMnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX21vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9tb25kYXlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMubW9uZGF5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9uZGF5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vbmRheScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb25kYXknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb25kYXknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fdHVlc2RheV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy50dWVzZGF5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHVlc2RheScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0dWVzZGF5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R1ZXNkYXknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0dWVzZGF5JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl93ZWRuZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fd2VkbmVzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLndlZG5lc2RheSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZG5lc2RheScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd3ZWRuZXNkYXknKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2VkbmVzZGF5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnd2VkbmVzZGF5JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90aHVyc2RheV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy50aHVyc2RheSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RodXJzZGF5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RodXJzZGF5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RodXJzZGF5Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGh1cnNkYXknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9mcmlkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZnJpZGF5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZnJpZGF5JykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ZyaWRheScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmcmlkYXknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcmlkYXknLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3NhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3NhdHVyZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2F0dXJkYXknKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2F0dXJkYXknKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2F0dXJkYXknKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzYXR1cmRheScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc3VuZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3N1bmRheV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5zdW5kYXkoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdW5kYXknKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3VuZGF5Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1bmRheScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1bmRheScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndW5kZWZpbmVkJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwib2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpKSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3Mob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGcmVxdWVuY3kuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19UZWFtIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19UZWFtIiwibmFtZSI6InNoc19hcmJmd19UZWFtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1RlYW0gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnRlYW1fUHJvamVjdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtX1Byb2plY3RzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdGVhbV9Qcm9qZWN0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3RlYW1fUHJvamVjdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW1fUHJvamVjdHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS50ZWFtX1RlYW1fTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW1fVGVhbV9NZW1iZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdGVhbV9UZWFtX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90ZWFtX1RlYW1fTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbV9UZWFtX01lbWJlcnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy50ZWFtX1Byb2plY3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllQcm9qZWN0LnRlYW0sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllUZWFtX01lbWJlci50ZWFtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJUZWFtXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19UZWFtXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfVGVhbSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGVhbV9Qcm9qZWN0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRlYW1fUHJvamVjdHMobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbV9Qcm9qZWN0cykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW1fVGVhbV9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudGVhbV9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW1fVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRlYW1cIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMudGVhbV9Qcm9qZWN0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtX1Byb2plY3RzID0gdGhpcy50ZWFtX1Byb2plY3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy50ZWFtX1RlYW1fTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtX1RlYW1fTWVtYmVycyA9IHRoaXMudGVhbV9UZWFtX01lbWJlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVGVhbSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd1bmRlZmluZWQnKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwib2JqLnRlYW1fUHJvamVjdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRlYW1fUHJvamVjdHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRlYW1fUHJvamVjdHMpKSB0aGlzLnRlYW1fUHJvamVjdHMob2JqLnRlYW1fUHJvamVjdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJvYmoudGVhbV9UZWFtX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRlYW1fVGVhbV9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai50ZWFtX1RlYW1fTWVtYmVycykpIHRoaXMudGVhbV9UZWFtX01lbWJlcnMob2JqLnRlYW1fVGVhbV9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHRyZXR1cm4gdGhpcztcbn1cblxuLyoqKioqKioqKioqKiogVGVhbS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGVhbS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVGVhbS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmQoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfUm9sZSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfUm9sZSIsIm5hbWUiOiJzaHNfYXJiZndfUm9sZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Sb2xlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Sb2xlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlX0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yb2xlX0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJvbGVfVGVhbV9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZV9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yb2xlX1RlYW1fTWVtYmVycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yb2xlX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRWZmb3J0X0VzdGltYXRlLnJvbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllUZWFtX01lbWJlci5yb2xlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJSb2xlXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19Sb2xlXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfUm9sZSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZV9UZWFtX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yb2xlX1RlYW1fTWVtYmVycyhuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZV9UZWFtX01lbWJlcnMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUm9sZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZV9FZmZvcnRfRXN0aW1hdGVzID0gdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGVfVGVhbV9NZW1iZXJzID0gdGhpcy5yb2xlX1RlYW1fTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Sb2xlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbl9xdWVyeShncSkge1xuXHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3VuZGVmaW5lZCcpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3VuZGVmaW5lZCcpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIm9iai5yb2xlX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJvbGVfVGVhbV9NZW1iZXJzKSkgdGhpcy5yb2xlX1RlYW1fTWVtYmVycyhvYmoucm9sZV9UZWFtX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd1bmRlZmluZWQnKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBSb2xlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi52ZXJzaW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmVyc2lvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdmVyc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl92ZXJzaW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZlcnNpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NjcmlwdF9GaWxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRml4X1NjcmlwdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9UYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9UYWJsZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9UYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9UYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GbG93cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0Zsb3dzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fRmxvd3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmllbGRfTGFiZWxzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmllbGRfTGFiZWxzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9UeXBlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZlcnNpb24pIHJldCArPSAnXicgKyBzUGF0aCArICd2ZXJzaW9uJyArICh0aGlzLl92ZXJzaW9uX2Nvb3AgfHwgJz0nKSArIHRoaXMudmVyc2lvbigpO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVJvbGxiYWNrX0NvbnRleHQuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2NyaXB0X0ZpbGUuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGaXhfU2NyaXB0LmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVRhYmxlLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNhdmVfU3Vic2NyaXB0aW9uLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GbG93cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvdy5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGaWVsZF9MYWJlbC5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfTG9naWMuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5zdGFuY2UuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX1R5cGUuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X1NuYXBzaG90LmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUGlsbF9Db21wb3VuZC5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNlY3VyaXR5X0NvbnRyb2wuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTZWN1cml0eV9UeXBlLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTZWN1cml0eV9PcGVyYXRpb24uYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkFwcGxpY2F0aW9uXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHR2ZXJzaW9uOiBvYmouZ2V0VmFsdWUoXCJ2ZXJzaW9uXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAoLygoKFtBLVphLXpdezMsOX06KD86LyAvICkgPyApKCA/IDogWy07OiAmPSArJCwgd10gKyBAKSA/IFtBIC0gWmEgLSB6MCAtIDkuIC0gXSArIHwgKCA/IDogd3d3LiB8IFstOzogJj0gKyQsIHddICsgQClbQSAtIFphIC0gejAgLSA5LiAtIF0gKyApKCggPyA6IC9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykvZy50ZXN0KG9iaikpIHtcblx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai52ZXJzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMudmVyc2lvbihvYmoudmVyc2lvbik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fVGFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fVGFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1RhYmxlcykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GbG93cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmxvd3MpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQXBwbGljYXRpb25cIil7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl92ZXJzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQudmVyc2lvbiA9IHRoaXMudmVyc2lvbigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMgPSB0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzID0gdGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzID0gdGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fVGFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1RhYmxlcyA9IHRoaXMuYXBwbGljYXRpb25fVGFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zID0gdGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0Zsb3dzID0gdGhpcy5hcHBsaWNhdGlvbl9GbG93cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyA9IHRoaXMuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyA9IHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzID0gdGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzID0gdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzID0gdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzID0gdGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMgPSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyA9IHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzID0gdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zID0gdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2ZXJzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmVyc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52ZXJzaW9uKHRoaXMudmVyc2lvbigpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3Njb3BlJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdmVyc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl92ZXJzaW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl92ZXJzaW9uX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMudmVyc2lvbigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZlcnNpb24nKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2ZXJzaW9uJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZlcnNpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2ZXJzaW9uJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdH0pO1xuXG5cdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0fSBlbHNlIHtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zY29wZScpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMpKSB0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKSkgdGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cykpIHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1RhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fVGFibGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcyhvYmouYXBwbGljYXRpb25fVGFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKSkgdGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouYXBwbGljYXRpb25fRmxvd3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0Zsb3dzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93cykpIHRoaXMuYXBwbGljYXRpb25fRmxvd3Mob2JqLmFwcGxpY2F0aW9uX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpKSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyhvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKSkgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyhvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcykpIHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKSkgdGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cykpIHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpKSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9sczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSkgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyhvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcykpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogQXBwbGljYXRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY29wZScpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NvcGUnLCBbJyonXSlbJ3N5c19zY29wZSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1F1ZXVlIiwiX2FwaV9uYW1lIjoiLnNoc19hcmJmd19hcHBkX1F1ZXVlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1F1ZXVlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfUXVldWUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9RdWV1ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5jbHVzdGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2x1c3Rlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2x1c3RlciA9IHY7XG5cdFx0XHR0aGlzLl9jbHVzdGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NsdXN0ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUudG9waWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0b3BpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdG9waWMgPSB2O1xuXHRcdFx0dGhpcy5fdG9waWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdG9waWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucHJvY2Vzc2VkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvY2Vzc2VkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3NlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3Byb2Nlc3NlZCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9jZXNzZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvY2Vzc2VkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRpcmVjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRpcmVjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGlyZWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RpcmVjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fc3RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VuZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZW5kZXIgPSB2O1xuXHRcdFx0dGhpcy5fc2VuZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlbmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZWNpcGllbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWNpcGllbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlY2lwaWVudCA9IHY7XG5cdFx0XHR0aGlzLl9yZWNpcGllbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVjaXBpZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnJlc3BvbnNlVG8gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXNwb25zZVRvKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvID0gdjtcblx0XHRcdHRoaXMuX3Jlc3BvbnNlVG9fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUbztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZXNwb25zZVRvX1F1ZXVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlc3BvbnNlVG9fUXVldWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVzcG9uc2VUb19RdWV1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvX1F1ZXVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUb19RdWV1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fY2x1c3RlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NsdXN0ZXInICsgKHRoaXMuX2NsdXN0ZXJfY29vcCB8fCAnPScpICsgdGhpcy5jbHVzdGVyKCk7XG5cblx0XHRpZiAodGhpcy5fdG9waWMpIHJldCArPSAnXicgKyBzUGF0aCArICd0b3BpYycgKyAodGhpcy5fdG9waWNfY29vcCB8fCAnPScpICsgdGhpcy50b3BpYygpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2Nlc3NlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3Byb2Nlc3NlZCcgKyAodGhpcy5fcHJvY2Vzc2VkX2Nvb3AgfHwgJz0nKSArIHRoaXMucHJvY2Vzc2VkKCk7XG5cblx0XHRpZiAodGhpcy5fZGlyZWN0aW9uKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGlyZWN0aW9uJyArICh0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPScpICsgdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdGlmICh0aGlzLl9zdGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXRlJyArICh0aGlzLl9zdGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXRlKCk7XG5cblx0XHRpZiAodGhpcy5fc2VuZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc2VuZGVyJyArICh0aGlzLl9zZW5kZXJfY29vcCB8fCAnPScpICsgdGhpcy5zZW5kZXIoKTtcblxuXHRcdGlmICh0aGlzLl9yZWNpcGllbnQpIHJldCArPSAnXicgKyBzUGF0aCArICdyZWNpcGllbnQnICsgKHRoaXMuX3JlY2lwaWVudF9jb29wIHx8ICc9JykgKyB0aGlzLnJlY2lwaWVudCgpO1xuXG5cdFx0aWYgKHRoaXMuX3Jlc3BvbnNlVG8pIHJldCArPSAvKih0aGlzLl9yZXNwb25zZVRvX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVzcG9uc2VUbygpLl90b0VRdWVyeShzUGF0aCArICdyZXNwb25zZVRvLicpO1xuXG5cdFx0KHRoaXMucmVzcG9uc2VUb19RdWV1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVF1ZXVlLnJlc3BvbnNlVG8sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJwcm9jZXNzXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvY2VzcygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJRdWV1ZVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9RdWV1ZVwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0Y2x1c3Rlcjogb2JqLmdldFZhbHVlKFwiY2x1c3RlclwiKSxcblxuXHRcdFx0XHRcdHRvcGljOiBvYmouZ2V0VmFsdWUoXCJ0b3BpY1wiKSxcblxuXHRcdFx0XHRcdHByb2Nlc3NlZDogb2JqLmdldFZhbHVlKFwicHJvY2Vzc2VkXCIpLFxuXG5cdFx0XHRcdFx0ZGlyZWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJkaXJlY3Rpb25cIiksXG5cblx0XHRcdFx0XHRzdGF0ZTogb2JqLmdldFZhbHVlKFwic3RhdGVcIiksXG5cblx0XHRcdFx0XHRzZW5kZXI6IG9iai5nZXRWYWx1ZShcInNlbmRlclwiKSxcblxuXHRcdFx0XHRcdHJlY2lwaWVudDogb2JqLmdldFZhbHVlKFwicmVjaXBpZW50XCIpLFxuXG5cdFx0XHRcdFx0cmVzcG9uc2VUbzogb2JqLmdldFZhbHVlKFwicmVzcG9uc2VUb1wiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tR2xpZGVSZWNvcmQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0fVxuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY2x1c3RlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNsdXN0ZXIob2JqLmNsdXN0ZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoudG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy50b3BpYyhvYmoudG9waWMpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvY2Vzc2VkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucHJvY2Vzc2VkKG9iai5wcm9jZXNzZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGlyZWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGlyZWN0aW9uKG9iai5kaXJlY3Rpb24pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5zdGF0ZShvYmouc3RhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VuZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuc2VuZGVyKG9iai5zZW5kZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVjaXBpZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVjaXBpZW50KG9iai5yZWNpcGllbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVzcG9uc2VUbykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlc3BvbnNlVG8obmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVzcG9uc2VUbykpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVzcG9uc2VUb19RdWV1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZXNwb25zZVRvX1F1ZXVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fZnJvbURvY3VtZW50KG9iai5yZXNwb25zZVRvX1F1ZXVlcykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJRdWV1ZVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NsdXN0ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jbHVzdGVyID0gdGhpcy5jbHVzdGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fdG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC50b3BpYyA9IHRoaXMudG9waWMoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9wcm9jZXNzZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5wcm9jZXNzZWQgPSB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0aWYgKHJldC5wcm9jZXNzZWQgJiYgdHlwZW9mKHJldC5wcm9jZXNzZWQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQucHJvY2Vzc2VkID0gcmV0LnByb2Nlc3NlZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kaXJlY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N0YXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc3RhdGUgPSB0aGlzLnN0YXRlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fc2VuZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuc2VuZGVyID0gdGhpcy5zZW5kZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZWNpcGllbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZWNpcGllbnQgPSB0aGlzLnJlY2lwaWVudCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3Jlc3BvbnNlVG8pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZXNwb25zZVRvID0gdGhpcy5yZXNwb25zZVRvKCk7XG5cblx0XHRpZiAocmV0LnJlc3BvbnNlVG8pIHtcblx0XHRcdHJldC5yZXNwb25zZVRvID0gcmV0LnJlc3BvbnNlVG8uX3RvRG9jdW1lbnQoKTtcblx0XHRcdGlmICh0eXBlb2YocmV0LnJlc3BvbnNlVG8pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlc3BvbnNlVG8pLmxlbmd0aCkgcmV0LnJlc3BvbnNlVG8gPSBudWxsO1xuXHRcdH1cblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLnJlc3BvbnNlVG9fUXVldWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG9fUXVldWVzID0gdGhpcy5yZXNwb25zZVRvX1F1ZXVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCk7XG5cblx0dW5kZWZpbmVkXG5cblx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0aWYgKCFrZXlzKSB7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNsdXN0ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2x1c3Rlcih0aGlzLmNsdXN0ZXIoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudG9waWMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudG9waWModGhpcy50b3BpYygpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5kaXJlY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uKCkpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNlbmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZW5kZXIodGhpcy5zZW5kZXIoKSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVjaXBpZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlY2lwaWVudCh0aGlzLnJlY2lwaWVudCgpKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZXNwb25zZVRvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG8odGhpcy5yZXNwb25zZVRvKCkuX3VuaXF1ZSgpKTtcblxuXHR9IGVsc2Uge1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY2x1c3RlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNsdXN0ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2x1c3Rlcih0aGlzLmNsdXN0ZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwidG9waWNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50b3BpYygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50b3BpYyh0aGlzLnRvcGljKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInByb2Nlc3NlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2Nlc3NlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9jZXNzZWQodGhpcy5wcm9jZXNzZWQoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGlyZWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGlyZWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRpcmVjdGlvbih0aGlzLmRpcmVjdGlvbigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0YXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXRlKHRoaXMuc3RhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2VuZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VuZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlbmRlcih0aGlzLnNlbmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWNpcGllbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWNpcGllbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVjaXBpZW50KHRoaXMucmVjaXBpZW50KCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcInJlc3BvbnNlVG9cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXNwb25zZVRvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG8odGhpcy5yZXNwb25zZVRvKCkuX3VuaXF1ZSgpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnZWNjX3F1ZXVlJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY2x1c3RlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jbHVzdGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jbHVzdGVyX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY2x1c3RlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NsdXN0ZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjbHVzdGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NsdXN0ZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjbHVzdGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl90b3BpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl90b3BpY19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fdG9waWNfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy50b3BpYygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RvcGljJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndG9waWMnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndG9waWMnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0b3BpYycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcHJvY2Vzc2VkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2Nlc3NlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5wcm9jZXNzZWQoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2Nlc3NlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Byb2Nlc3NlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcm9jZXNzZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9jZXNzZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RpcmVjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2RpcmVjdGlvbl9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRpcmVjdGlvbigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RpcmVjdGlvbicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RpcmVjdGlvbicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkaXJlY3Rpb24nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkaXJlY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3N0YXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9zdGF0ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnN0YXRlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9zZW5kZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fc2VuZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9zZW5kZXJfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5zZW5kZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzZW5kZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzZW5kZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2VuZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2VuZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZWNpcGllbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVjaXBpZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZWNpcGllbnRfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZWNpcGllbnQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWNpcGllbnQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWNpcGllbnQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVjaXBpZW50Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVjaXBpZW50JywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZXNwb25zZVRvKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3Jlc3BvbnNlVG9fY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVzcG9uc2VUbygpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdC8qaWYoXCJRdWV1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJyZXNwb25zZVRvIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0diA9IC0xO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIgKyBcInJlc3BvbnNlVG9bcmVzcG9uc2VUb10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXNwb25zZVRvKCkpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVzcG9uc2V0bycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Jlc3BvbnNldG8nKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVzcG9uc2V0bycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Jlc3BvbnNldG8nLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9zYXZlKG8pXG5cdH0pO1xuXG5cdGxldCBfb2JqID0ge307XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignZWNjX3F1ZXVlJywgWycqJ10pWydlY2NfcXVldWUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnZWNjX3F1ZXVlJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignZWNjX3F1ZXVlJywgWycqJ10pWydlY2NfcXVldWUnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVzcG9uc2VUb19RdWV1ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlc3BvbnNlVG9fUXVldWVzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5yZXNwb25zZVRvX1F1ZXVlcykpIHRoaXMucmVzcG9uc2VUb19RdWV1ZXMob2JqLnJlc3BvbnNlVG9fUXVldWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBRdWV1ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogUXVldWUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kQWxsKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdlY2NfcXVldWUnLCBbJyonXSlbJ2VjY19xdWV1ZSddKSkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFF1ZXVlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBRdWV1ZS5wcm9jZXNzKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnByb2Nlc3MoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdHRoaXMuX25ldygpLmNvZGUodGhpcy5fX3Njb3BlICsgXCJfXCIpLnN0YXRlKFwicmVhZHlcIiwgXCI9XCIpLnR5cGUoXCJpbnB1dFwiLCBcIj1cIikucHJvY2Vzc2VkKG51bGwpIC8qLnByb2Nlc3NlZChuZXcgRGF0ZSgpLnRvSlNPTigpLnNsaWNlKDAsIDEwKSwgJzwnKSovIC5yZXNwb25zZVRvKG51bGwpLmZpbmRBbGwoKS5zbGljZSgwLCAxKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcblx0XHRcdGUuc3RhdGUoXCJwcm9jZXNzaW5nXCIpO1xuXHRcdFx0ZS5wcm9jZXNzZWQobmV3IERhdGUoKSk7XG5cdFx0XHRlLnJlc3BvbnNlVG8obnVsbCk7IC8vIGUgaGFzIGVtcHR5IG9iamVjdCBhcyByZXNwb25zZVRvISEhXG5cdFx0XHRlLnN0b3JlKCk7XG5cblx0XHRcdHZhciByID0gZS5fbmV3KCkudHlwZShcIm91dHB1dFwiKS5uYW1lKGUubmFtZSgpKS5jb2RlKGUuY29kZSgpKS5zdGF0ZShcInByb2Nlc3NlZFwiKS5wcm9jZXNzZWQobmV3IERhdGUoKSkucmVzcG9uc2VUbyhlLnN0YXRlKFwicHJvY2Vzc2VkXCIpLnByb2Nlc3NlZChuZXcgRGF0ZSgpKSk7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyLnJlbWFyayhlLl9uZXcoZS5jb2RlKCkpLl9pbnZva2UoZS5uYW1lKCksIGUucmVtYXJrKCkpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJFeGNlcHRpb246IFwiICsgZXgpO1xuXHRcdFx0XHRlLnN0YXRlKFwiZXJyb3JcIikucmVtYXJrKGV4LnRvU3RyaW5nKCkpO1xuXHRcdFx0fVxuXHRcdFx0ci5zdG9yZSgpO1xuXHRcdH0pO1xuXHRcdHJldHVybjtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNhdmVfU3Vic2NyaXB0aW9uLnByb2ZpbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tR2xpZGVSZWNvcmQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiBudWxsO1xuXHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQ29ubmVjdGlvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uXCIpIHtcblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0bGV0IHJldCA9IG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaikpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0fTtcblx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0b2JqID0gX29iajtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHR9XG5cdGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbUdsaWRlUmVjb3JkKG9iaik7XG5cdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJDb25uZWN0aW9uXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMgPSB0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ0Nvbm5lY3Rpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ0Nvbm5lY3Rpb24nKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucykpIHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBDb25uZWN0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBDb25uZWN0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25uZWN0aW9uJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBDb25uZWN0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24iLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb25fRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmRlZmluaXRpb25fRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfTG9naWMuZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJMb2dpY19EZWZpbml0aW9uXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb25cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb25fRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTG9naWNfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdHJldHVybiB0aGlzO1xufVxuXG5faW5zZXJ0QXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3VwZGF0ZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9zdG9yZUFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9maW5kQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX25ldyhjKSB7XG5cblx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QbGF0Zm9ybS5fbmV3KGMpO1xuXG59XG5cbl90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLmRlZmluaXRpb25fRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyA9IHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKTtcblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0fVxuXHR9KTtcblxuXHRsZXQgX3RoaXMgPSBudWxsO1xuXHRpZiAob2JqLl9fa2V5cykge1xuXHRcdGxldCBrT2JqID0ge307XG5cdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpKSk7XG5cdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0fSk7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcykpIHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyhvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicpO1xuXHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2siLCJfYXBpX25hbWUiOiIuc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2tcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRmxvd3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19GbG93cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0Zsb3dzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRWxlbWVudF9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrX0VsZW1lbnRfTWFwcGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19FbGVtZW50X01hcHBpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRWxlbWVudF9NYXBwaW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2tfRWxlbWVudF9NYXBwaW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmJsb2NrX0Zsb3dfU25hcHNob3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2tfRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93X1NuYXBzaG90cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfU25hcHNob3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9ja19GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJsb2NrX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93LmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19Mb2dpYy5ibG9jayw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRWxlbWVudF9NYXBwaW5nLmJsb2NrLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93X1NuYXBzaG90cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19TbmFwc2hvdC5ibG9jayw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJGbG93X0Jsb2NrXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcInNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2tcIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKSk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbUdsaWRlUmVjb3JkKCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdH1cblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19GbG93cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRmxvd3MpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19FbGVtZW50X01hcHBpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncyhuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5ibG9ja19GbG93X1NuYXBzaG90cykpO1xuXG5cdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0Jsb2NrXCIpe1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0cmV0dXJuIHRoaXM7XG59XG5cbl9pbnNlcnRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fdXBkYXRlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX3N0b3JlQXNzZXJ0KCkge1xuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuX2ZpbmRBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fbmV3KGMpIHtcblxuXHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuYmxvY2tfRmxvd3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2tfRmxvd3MgPSB0aGlzLmJsb2NrX0Zsb3dzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmICh0eXBlb2YodGhpcy5ibG9ja19GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19GbG93X0xvZ2ljcyA9IHRoaXMuYmxvY2tfRmxvd19Mb2dpY3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2tfRWxlbWVudF9NYXBwaW5ncyA9IHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2tfRmxvd19TbmFwc2hvdHMgPSB0aGlzLmJsb2NrX0Zsb3dfU25hcHNob3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfYmxvY2snKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfYmxvY2snKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19ibG9jaycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2Jsb2NrJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0Zsb3dzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19GbG93cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRmxvd3MpKSB0aGlzLmJsb2NrX0Zsb3dzKG9iai5ibG9ja19GbG93cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0Zsb3dfTG9naWNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRmxvd19Mb2dpY3MpKSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKG9iai5ibG9ja19GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MpKSB0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3Mob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19GbG93X1NuYXBzaG90cywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRmxvd19TbmFwc2hvdHMpKSB0aGlzLmJsb2NrX0Zsb3dfU25hcHNob3RzKG9iai5ibG9ja19GbG93X1NuYXBzaG90cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0Jsb2NrLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbnN0b3JlKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfYmxvY2snKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVBpbGxfQ29tcG91bmQudHJhbnNmb3JtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnRyYW5zZm9ybSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlRyYW5zZm9ybVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRyYW5zZm9ybVwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzID0gdGhpcy50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zID0gdGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdH0pO1xuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRkZWxldGUgcmV0W2tdO1xuXHR9KTtcblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fdW5pcXVlKGtleXMsIHJldCkge1xuXHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpO1xuXG5cdHVuZGVmaW5lZFxuXG5cdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdGlmICgha2V5cykge1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5fcXVlcnkoZ3EpIHtcblx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nXSk7XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblxuXHR1bmRlZmluZWRcblxuXHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdJZCc7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmV0O1xuXHR9KSh0aGlzKSk7XG5cdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHYpIHtcblx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHR9XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG59XG5cbl9zYXZlKG9iaikge1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdH0gZWxzZSB7XG5cdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdH1cblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0dHJ5IHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSk7XG5cblx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJyk7XG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHR9XG5cdFx0bGV0IF9mT2JqID0ge307XG5cdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShvYmopKSkpO1xuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJ10pKSkpO1xuXHR9IGNhdGNoIChleCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwib2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMpKSB0aGlzLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyhvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIm9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKSkgdGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyhvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBUcmFuc2Zvcm0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFRyYW5zZm9ybS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogVHJhbnNmb3JtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbiIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmRlZmluaXRpb25fRmxvd19EYXRhcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb25fRmxvd19EYXRhcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19EYXRhcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19EYXRhc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbl9GbG93X0RhdGFzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVmaW5pdGlvbl9GbG93X0RhdGFzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0RhdGEuZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbUdsaWRlUmVjb3JkKG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gbnVsbDtcblx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkRhdGFfRGVmaW5pdGlvblwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb25cIikge1xuXHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKC8oKChbQS1aYS16XXszLDl9Oig/Oi8gLyApID8gKSggPyA6IFstOzogJj0gKyQsIHddICsgQCkgPyBbQSAtIFphIC0gejAgLSA5LiAtIF0gKyB8ICggPyA6IHd3dy4gfCBbLTs6ICY9ICskLCB3XSArIEApW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgKSgoID8gOiAvWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pL2cudGVzdChvYmopKSB7XG5cdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdH07XG5cdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopO1xuXHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRhdGFfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGxhdGZvcm0uX25ldyhjKTtcblxufVxuXG5fdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVmaW5pdGlvbl9GbG93X0RhdGFzID0gdGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHR9KTtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0ZGVsZXRlIHJldFtrXTtcblx0fSk7XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3VuaXF1ZShrZXlzLCByZXQpIHtcblx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKTtcblxuXHR1bmRlZmluZWRcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJyk7XG5cblx0dW5kZWZpbmVkXG5cblx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnSWQnO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHR9XG5cdFx0cmV0dXJuIHJldDtcblx0fSkodGhpcykpO1xuXHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh2KSB7XG5cdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdHJldHVybiB0aGlzLl9xdWVyeUdRO1xufVxuXG5fc2F2ZShvYmopIHtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX3NhdmUobylcblx0fSk7XG5cblx0bGV0IF9vYmogPSB7fTtcblxuXHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0fSk7XG5cblx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBfdGhpcyA9IG51bGw7XG5cdGlmIChvYmouX19rZXlzKSB7XG5cdFx0bGV0IGtPYmogPSB7fTtcblx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSkpKTtcblx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHR9KTtcblx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdHRyeSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicpO1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0fVxuXHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkob2JqKSkpKTtcblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbiddKSkpKTtcblx0fSBjYXRjaCAoZXgpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzKSkgdGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cbi8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5zdG9yZShfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZEFsbChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nXSkpKTtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG4vKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5maW5kKF9fZXZlbnQpIHtcblx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRsZXQgbm9kZSA9IG51bGw7XG5cblx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdGxldCBldkpTT04gPSBudWxsO1xuXHRpZiAoX19ldmVudCkge1xuXHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbiIsIl9hcGlfbmFtZSI6Ii5zaHNfYXJiZndfU29sdXRpb25fRGVzaWduIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduIGV4dGVuZHMgc2hzX2FyYmZ3X1Rhc2sge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1ZlcnNpb25fSGlzdG9yeXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9WZXJzaW9uX0hpc3RvcnlzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fU29sdXRpb25fU2VjdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gLypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3RvRVF1ZXJ5LmNhbGwodGhpcywgKi8gc3VwZXIuX3RvRVF1ZXJ5KHNQYXRoKSB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZlcnNpb25fSGlzdG9yeS5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU2VjdGlvbi5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNvbHV0aW9uX0FwcGVuZGl4LmRlc2lnbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21HbGlkZVJlY29yZChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIG51bGw7XG5cdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJTb2x1dGlvbl9EZXNpZ25cIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnblwiKSB7XG5cdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdGxldCByZXQgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21HbGlkZVJlY29yZChvYmopKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21HbGlkZVJlY29yZCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdHJldHVybiBnclJldDtcblx0XHR9XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl9mcm9tRG9jdW1lbnQuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyLl9mcm9tRG9jdW1lbnQob2JqKVxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICgvKCgoW0EtWmEtel17Myw5fTooPzovIC8gKSA/ICkoID8gOiBbLTs6ICY9ICskLCB3XSArIEApID8gW0EgLSBaYSAtIHowIC0gOS4gLSBdICsgfCAoID8gOiB3d3cuIHwgWy07OiAmPSArJCwgd10gKyBAKVtBIC0gWmEgLSB6MCAtIDkuIC0gXSArICkoKCA/IDogL1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KS9nLnRlc3Qob2JqKSkge1xuXHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHR9O1xuXHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRvYmogPSBfb2JqO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdH1cblx0ZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tR2xpZGVSZWNvcmQob2JqKTtcblx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyhuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKSk7XG5cblx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX0Rlc2lnblwiKXtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHR9XG5cblx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRyZXR1cm4gdGhpcztcbn1cblxuX2luc2VydEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl91cGRhdGVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fc3RvcmVBc3NlcnQoKSB7XG5cdHJldHVybiB0cnVlO1xufVxuXG5fZmluZEFzc2VydCgpIHtcblx0cmV0dXJuIHRydWU7XG59XG5cbl9uZXcoYykge1xuXG5cdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtLl9uZXcoYyk7XG5cbn1cblxuX3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRsZXQgcmV0ID0gLypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3RvRG9jdW1lbnQuY2FsbCh0aGlzLCAqLyBzdXBlci5fdG9Eb2N1bWVudChhckZpZWxkcykgfHwge307XG5cblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0fVxuXG5cdGlmICh0eXBlb2YodGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyA9IHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0fSk7XG5cblx0aWYgKHR5cGVvZih0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMgPSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHR9KTtcblxuXHRpZiAodHlwZW9mKHRoaXMuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzID0gdGhpcy5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdH0pO1xuXG5cdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0fSk7XG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdGRlbGV0ZSByZXRba107XG5cdH0pO1xuXG5cdHJldHVybiByZXQ7XG59XG5cbl91bmlxdWUoa2V5cywgcmV0KSB7XG5cdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpO1xuXG5cdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl91bmlxdWUuY2FsbCh0aGlzLCAqL1xuXHRzdXBlci5fdW5pcXVlKGtleXMsIHJldClcblxuXHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRpZiAoIWtleXMpIHtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdH0gZWxzZSB7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuX3F1ZXJ5KGdxKSB7XG5cdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pO1xuXG5cdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgndW5kZWZpbmVkJyk7XG5cblx0LypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3F1ZXJ5LmNhbGwodGhpcywgKi9cblx0c3VwZXIuX3F1ZXJ5KGdxKVxuXG5cdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ0lkJztcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0fVxuXHRcdHJldHVybiByZXQ7XG5cdH0pKHRoaXMpKTtcblx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodikge1xuXHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdH1cblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcbn1cblxuX3NhdmUob2JqKSB7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fc2F2ZShvKVxuXHR9KTtcblxuXHRsZXQgX29iaiA9IHt9O1xuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd1bmRlZmluZWQnLCBbJyonXSlbJ3VuZGVmaW5lZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHR9KTtcblxuXHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdH1cblx0fSk7XG5cblx0bGV0IF90aGlzID0gbnVsbDtcblx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRsZXQga09iaiA9IHt9O1xuXHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKF9vYmopKSkpO1xuXHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdH0pO1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHR9IGVsc2Uge1xuXHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0fVxuXG5cdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHR0cnkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHR9KTtcblxuXHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd1bmRlZmluZWQnKTtcblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdH1cblx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKG9iaikpKSk7XG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndW5kZWZpbmVkJywgWycqJ10pWyd1bmRlZmluZWQnXSkpKSk7XG5cdH0gY2F0Y2ggKGV4KSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdGlmIChBcnJheS5pc0FycmF5KG9iai5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cykpIHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKHRhKVxuXHR9KSk7XG5cblx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIm9iai5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucywgbnVsbCwgNCkpO1xuXHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKSkgdGhpcy5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUodGEpXG5cdH0pKTtcblxuXHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMsIG51bGwsIDQpKTtcblx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fc2F2ZSh0YSlcblx0fSkpO1xuXG5cdHJldHVybiB0aGlzO1xufVxuXG4vKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuc3RvcmUoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdH1cblxuXHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0fVxuXG5cdHJldHVybiBhbnN3ZXI7XG59XG5cbi8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cbmZpbmRBbGwoX19ldmVudCkge1xuXHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdGxldCBub2RlID0gbnVsbDtcblxuXHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdGlmIChfX2V2ZW50KSB7XG5cdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndW5kZWZpbmVkJyk7XG5cdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3VuZGVmaW5lZCcsIFsnKiddKVsndW5kZWZpbmVkJ10pKSk7XG5cblx0fVxuXG5cdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fSBlbHNlIHtcblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHR9XG5cblx0cmV0dXJuIGFuc3dlcjtcbn1cblxuLyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuZmluZChfX2V2ZW50KSB7XG5cdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRsZXQgZXZKU09OID0gbnVsbDtcblx0aWYgKF9fZXZlbnQpIHtcblx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHR9XG5cblx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdH1cblxuXHRyZXR1cm4gYW5zd2VyO1xufVxuXG59In1d",
	"cluster": "APISERVER",
	"topic": "apiserver.shs_arbfw",
	"direction": "input",
	"state": "ready",
	"recipient": "instance_name",
	"__keys": ["code", "name", "cluster", "topic", "direction", "sender", "recipient", "responseTo"],
	"active": true,
	"enabled": true,
	"sender": null,
	"__trMap": []
}